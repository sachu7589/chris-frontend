import{j as t,A as qe,m as le}from"./ui-C4-mWmQN.js";import{a as ro,r as v,c as no,g as ao,b as oo}from"./vendor-Q3K9tvtn.js";import{L as wn,u as lr,B as lo,R as co,a as Xt,N as Qt}from"./router-DPv0OpXE.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))c(d);new MutationObserver(d=>{for(const m of d)if(m.type==="childList")for(const u of m.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&c(u)}).observe(document,{childList:!0,subtree:!0});function o(d){const m={};return d.integrity&&(m.integrity=d.integrity),d.referrerPolicy&&(m.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?m.credentials="include":d.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function c(d){if(d.ep)return;d.ep=!0;const m=o(d);fetch(d.href,m)}})();var Yi={},rn=ro;Yi.createRoot=rn.createRoot,Yi.hydrateRoot=rn.hydrateRoot;let uo={data:""},ho=n=>{if(typeof window=="object"){let a=(n?n.querySelector("#_goober"):window._goober)||Object.assign(document.createElement("style"),{innerHTML:" ",id:"_goober"});return a.nonce=window.__nonce__,a.parentNode||(n||document.head).appendChild(a),a.firstChild}return n||uo},mo=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,fo=/\/\*[^]*?\*\/|  +/g,nn=/\n+/g,St=(n,a)=>{let o="",c="",d="";for(let m in n){let u=n[m];m[0]=="@"?m[1]=="i"?o=m+" "+u+";":c+=m[1]=="f"?St(u,m):m+"{"+St(u,m[1]=="k"?"":a)+"}":typeof u=="object"?c+=St(u,a?a.replace(/([^,])+/g,p=>m.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,f=>/&/.test(f)?f.replace(/&/g,p):p?p+" "+f:f)):m):u!=null&&(m=/^--/.test(m)?m:m.replace(/[A-Z]/g,"-$&").toLowerCase(),d+=St.p?St.p(m,u):m+":"+u+";")}return o+(a&&d?a+"{"+d+"}":d)+c},Nt={},jn=n=>{if(typeof n=="object"){let a="";for(let o in n)a+=o+jn(n[o]);return a}return n},po=(n,a,o,c,d)=>{let m=jn(n),u=Nt[m]||(Nt[m]=(f=>{let y=0,g=11;for(;y<f.length;)g=101*g+f.charCodeAt(y++)>>>0;return"go"+g})(m));if(!Nt[u]){let f=m!==n?n:(y=>{let g,N,C=[{}];for(;g=mo.exec(y.replace(fo,""));)g[4]?C.shift():g[3]?(N=g[3].replace(nn," ").trim(),C.unshift(C[0][N]=C[0][N]||{})):C[0][g[1]]=g[2].replace(nn," ").trim();return C[0]})(n);Nt[u]=St(d?{["@keyframes "+u]:f}:f,o?"":"."+u)}let p=o&&Nt.g?Nt.g:null;return o&&(Nt.g=Nt[u]),((f,y,g,N)=>{N?y.data=y.data.replace(N,f):y.data.indexOf(f)===-1&&(y.data=g?f+y.data:y.data+f)})(Nt[u],a,c,p),u},go=(n,a,o)=>n.reduce((c,d,m)=>{let u=a[m];if(u&&u.call){let p=u(o),f=p&&p.props&&p.props.className||/^go/.test(p)&&p;u=f?"."+f:p&&typeof p=="object"?p.props?"":St(p,""):p===!1?"":p}return c+d+(u??"")},"");function ci(n){let a=this||{},o=n.call?n(a.p):n;return po(o.unshift?o.raw?go(o,[].slice.call(arguments,1),a.p):o.reduce((c,d)=>Object.assign(c,d&&d.call?d(a.p):d),{}):o,ho(a.target),a.g,a.o,a.k)}let Nn,Xi,Qi;ci.bind({g:1});let kt=ci.bind({k:1});function xo(n,a,o,c){St.p=a,Nn=n,Xi=o,Qi=c}function Tt(n,a){let o=this||{};return function(){let c=arguments;function d(m,u){let p=Object.assign({},m),f=p.className||d.className;o.p=Object.assign({theme:Xi&&Xi()},p),o.o=/ *go\d+/.test(f),p.className=ci.apply(o,c)+(f?" "+f:"");let y=n;return n[0]&&(y=p.as||n,delete p.as),Qi&&y[0]&&Qi(p),Nn(y,p)}return d}}var yo=n=>typeof n=="function",oi=(n,a)=>yo(n)?n(a):n,vo=(()=>{let n=0;return()=>(++n).toString()})(),kn=(()=>{let n;return()=>{if(n===void 0&&typeof window<"u"){let a=matchMedia("(prefers-reduced-motion: reduce)");n=!a||a.matches}return n}})(),bo=20,cr="default",Cn=(n,a)=>{let{toastLimit:o}=n.settings;switch(a.type){case 0:return{...n,toasts:[a.toast,...n.toasts].slice(0,o)};case 1:return{...n,toasts:n.toasts.map(u=>u.id===a.toast.id?{...u,...a.toast}:u)};case 2:let{toast:c}=a;return Cn(n,{type:n.toasts.find(u=>u.id===c.id)?1:0,toast:c});case 3:let{toastId:d}=a;return{...n,toasts:n.toasts.map(u=>u.id===d||d===void 0?{...u,dismissed:!0,visible:!1}:u)};case 4:return a.toastId===void 0?{...n,toasts:[]}:{...n,toasts:n.toasts.filter(u=>u.id!==a.toastId)};case 5:return{...n,pausedAt:a.time};case 6:let m=a.time-(n.pausedAt||0);return{...n,pausedAt:void 0,toasts:n.toasts.map(u=>({...u,pauseDuration:u.pauseDuration+m}))}}},ii=[],Ln={toasts:[],pausedAt:void 0,settings:{toastLimit:bo}},yt={},Pn=(n,a=cr)=>{yt[a]=Cn(yt[a]||Ln,n),ii.forEach(([o,c])=>{o===a&&c(yt[a])})},Sn=n=>Object.keys(yt).forEach(a=>Pn(n,a)),_o=n=>Object.keys(yt).find(a=>yt[a].toasts.some(o=>o.id===n)),di=(n=cr)=>a=>{Pn(a,n)},wo={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},jo=(n={},a=cr)=>{let[o,c]=v.useState(yt[a]||Ln),d=v.useRef(yt[a]);v.useEffect(()=>(d.current!==yt[a]&&c(yt[a]),ii.push([a,c]),()=>{let u=ii.findIndex(([p])=>p===a);u>-1&&ii.splice(u,1)}),[a]);let m=o.toasts.map(u=>{var p,f,y;return{...n,...n[u.type],...u,removeDelay:u.removeDelay||((p=n[u.type])==null?void 0:p.removeDelay)||(n==null?void 0:n.removeDelay),duration:u.duration||((f=n[u.type])==null?void 0:f.duration)||(n==null?void 0:n.duration)||wo[u.type],style:{...n.style,...(y=n[u.type])==null?void 0:y.style,...u.style}}});return{...o,toasts:m}},No=(n,a="blank",o)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:a,ariaProps:{role:"status","aria-live":"polite"},message:n,pauseDuration:0,...o,id:(o==null?void 0:o.id)||vo()}),js=n=>(a,o)=>{let c=No(a,n,o);return di(c.toasterId||_o(c.id))({type:2,toast:c}),c.id},$e=(n,a)=>js("blank")(n,a);$e.error=js("error");$e.success=js("success");$e.loading=js("loading");$e.custom=js("custom");$e.dismiss=(n,a)=>{let o={type:3,toastId:n};a?di(a)(o):Sn(o)};$e.dismissAll=n=>$e.dismiss(void 0,n);$e.remove=(n,a)=>{let o={type:4,toastId:n};a?di(a)(o):Sn(o)};$e.removeAll=n=>$e.remove(void 0,n);$e.promise=(n,a,o)=>{let c=$e.loading(a.loading,{...o,...o==null?void 0:o.loading});return typeof n=="function"&&(n=n()),n.then(d=>{let m=a.success?oi(a.success,d):void 0;return m?$e.success(m,{id:c,...o,...o==null?void 0:o.success}):$e.dismiss(c),d}).catch(d=>{let m=a.error?oi(a.error,d):void 0;m?$e.error(m,{id:c,...o,...o==null?void 0:o.error}):$e.dismiss(c)}),n};var ko=1e3,Co=(n,a="default")=>{let{toasts:o,pausedAt:c}=jo(n,a),d=v.useRef(new Map).current,m=v.useCallback((N,C=ko)=>{if(d.has(N))return;let Z=setTimeout(()=>{d.delete(N),u({type:4,toastId:N})},C);d.set(N,Z)},[]);v.useEffect(()=>{if(c)return;let N=Date.now(),C=o.map(Z=>{if(Z.duration===1/0)return;let w=(Z.duration||0)+Z.pauseDuration-(N-Z.createdAt);if(w<0){Z.visible&&$e.dismiss(Z.id);return}return setTimeout(()=>$e.dismiss(Z.id,a),w)});return()=>{C.forEach(Z=>Z&&clearTimeout(Z))}},[o,c,a]);let u=v.useCallback(di(a),[a]),p=v.useCallback(()=>{u({type:5,time:Date.now()})},[u]),f=v.useCallback((N,C)=>{u({type:1,toast:{id:N,height:C}})},[u]),y=v.useCallback(()=>{c&&u({type:6,time:Date.now()})},[c,u]),g=v.useCallback((N,C)=>{let{reverseOrder:Z=!1,gutter:w=8,defaultPosition:P}=C||{},M=o.filter($=>($.position||P)===(N.position||P)&&$.height),W=M.findIndex($=>$.id===N.id),K=M.filter(($,z)=>z<W&&$.visible).length;return M.filter($=>$.visible).slice(...Z?[K+1]:[0,K]).reduce(($,z)=>$+(z.height||0)+w,0)},[o]);return v.useEffect(()=>{o.forEach(N=>{if(N.dismissed)m(N.id,N.removeDelay);else{let C=d.get(N.id);C&&(clearTimeout(C),d.delete(N.id))}})},[o,m]),{toasts:o,handlers:{updateHeight:f,startPause:p,endPause:y,calculateOffset:g}}},Lo=kt`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,Po=kt`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,So=kt`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,To=Tt("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${n=>n.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Lo} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${Po} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${n=>n.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${So} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,Eo=kt`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Ao=Tt("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${n=>n.secondary||"#e0e0e0"};
  border-right-color: ${n=>n.primary||"#616161"};
  animation: ${Eo} 1s linear infinite;
`,Mo=kt`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,Do=kt`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Oo=Tt("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${n=>n.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Mo} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${Do} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${n=>n.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,Ro=Tt("div")`
  position: absolute;
`,Io=Tt("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,zo=kt`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Bo=Tt("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${zo} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,Fo=({toast:n})=>{let{icon:a,type:o,iconTheme:c}=n;return a!==void 0?typeof a=="string"?v.createElement(Bo,null,a):a:o==="blank"?null:v.createElement(Io,null,v.createElement(Ao,{...c}),o!=="loading"&&v.createElement(Ro,null,o==="error"?v.createElement(To,{...c}):v.createElement(Oo,{...c})))},Vo=n=>`
0% {transform: translate3d(0,${n*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,Zo=n=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${n*-150}%,-1px) scale(.6); opacity:0;}
`,Ho="0%{opacity:0;} 100%{opacity:1;}",$o="0%{opacity:1;} 100%{opacity:0;}",Uo=Tt("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,Wo=Tt("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,qo=(n,a)=>{let o=n.includes("top")?1:-1,[c,d]=kn()?[Ho,$o]:[Vo(o),Zo(o)];return{animation:a?`${kt(c)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${kt(d)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},Go=v.memo(({toast:n,position:a,style:o,children:c})=>{let d=n.height?qo(n.position||a||"top-center",n.visible):{opacity:0},m=v.createElement(Fo,{toast:n}),u=v.createElement(Wo,{...n.ariaProps},oi(n.message,n));return v.createElement(Uo,{className:n.className,style:{...d,...o,...n.style}},typeof c=="function"?c({icon:m,message:u}):v.createElement(v.Fragment,null,m,u))});xo(v.createElement);var Ko=({id:n,className:a,style:o,onHeightUpdate:c,children:d})=>{let m=v.useCallback(u=>{if(u){let p=()=>{let f=u.getBoundingClientRect().height;c(n,f)};p(),new MutationObserver(p).observe(u,{subtree:!0,childList:!0,characterData:!0})}},[n,c]);return v.createElement("div",{ref:m,className:a,style:o},d)},Jo=(n,a)=>{let o=n.includes("top"),c=o?{top:0}:{bottom:0},d=n.includes("center")?{justifyContent:"center"}:n.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:kn()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${a*(o?1:-1)}px)`,...c,...d}},Yo=ci`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,ti=16,dr=({reverseOrder:n,position:a="top-center",toastOptions:o,gutter:c,children:d,toasterId:m,containerStyle:u,containerClassName:p})=>{let{toasts:f,handlers:y}=Co(o,m);return v.createElement("div",{"data-rht-toaster":m||"",style:{position:"fixed",zIndex:9999,top:ti,left:ti,right:ti,bottom:ti,pointerEvents:"none",...u},className:p,onMouseEnter:y.startPause,onMouseLeave:y.endPause},f.map(g=>{let N=g.position||a,C=y.calculateOffset(g,{reverseOrder:n,gutter:c,defaultPosition:a}),Z=Jo(N,C);return v.createElement(Ko,{id:g.id,key:g.id,onHeightUpdate:y.updateHeight,className:g.visible?Yo:"",style:Z},g.type==="custom"?oi(g.message,g):d?d(g):v.createElement(Go,{toast:g,position:N}))}))},D=$e;function Tn(n,a){return function(){return n.apply(a,arguments)}}const{toString:Xo}=Object.prototype,{getPrototypeOf:ur}=Object,{iterator:ui,toStringTag:En}=Symbol,hi=(n=>a=>{const o=Xo.call(a);return n[o]||(n[o]=o.slice(8,-1).toLowerCase())})(Object.create(null)),mt=n=>(n=n.toLowerCase(),a=>hi(a)===n),mi=n=>a=>typeof a===n,{isArray:ts}=Array,es=mi("undefined");function Ns(n){return n!==null&&!es(n)&&n.constructor!==null&&!es(n.constructor)&&st(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const An=mt("ArrayBuffer");function Qo(n){let a;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?a=ArrayBuffer.isView(n):a=n&&n.buffer&&An(n.buffer),a}const el=mi("string"),st=mi("function"),Mn=mi("number"),ks=n=>n!==null&&typeof n=="object",tl=n=>n===!0||n===!1,ri=n=>{if(hi(n)!=="object")return!1;const a=ur(n);return(a===null||a===Object.prototype||Object.getPrototypeOf(a)===null)&&!(En in n)&&!(ui in n)},sl=n=>{if(!ks(n)||Ns(n))return!1;try{return Object.keys(n).length===0&&Object.getPrototypeOf(n)===Object.prototype}catch{return!1}},il=mt("Date"),rl=mt("File"),nl=mt("Blob"),al=mt("FileList"),ol=n=>ks(n)&&st(n.pipe),ll=n=>{let a;return n&&(typeof FormData=="function"&&n instanceof FormData||st(n.append)&&((a=hi(n))==="formdata"||a==="object"&&st(n.toString)&&n.toString()==="[object FormData]"))},cl=mt("URLSearchParams"),[dl,ul,hl,ml]=["ReadableStream","Request","Response","Headers"].map(mt),fl=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Cs(n,a,{allOwnKeys:o=!1}={}){if(n===null||typeof n>"u")return;let c,d;if(typeof n!="object"&&(n=[n]),ts(n))for(c=0,d=n.length;c<d;c++)a.call(null,n[c],c,n);else{if(Ns(n))return;const m=o?Object.getOwnPropertyNames(n):Object.keys(n),u=m.length;let p;for(c=0;c<u;c++)p=m[c],a.call(null,n[p],p,n)}}function Dn(n,a){if(Ns(n))return null;a=a.toLowerCase();const o=Object.keys(n);let c=o.length,d;for(;c-- >0;)if(d=o[c],a===d.toLowerCase())return d;return null}const Bt=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,On=n=>!es(n)&&n!==Bt;function er(){const{caseless:n,skipUndefined:a}=On(this)&&this||{},o={},c=(d,m)=>{const u=n&&Dn(o,m)||m;ri(o[u])&&ri(d)?o[u]=er(o[u],d):ri(d)?o[u]=er({},d):ts(d)?o[u]=d.slice():(!a||!es(d))&&(o[u]=d)};for(let d=0,m=arguments.length;d<m;d++)arguments[d]&&Cs(arguments[d],c);return o}const pl=(n,a,o,{allOwnKeys:c}={})=>(Cs(a,(d,m)=>{o&&st(d)?n[m]=Tn(d,o):n[m]=d},{allOwnKeys:c}),n),gl=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),xl=(n,a,o,c)=>{n.prototype=Object.create(a.prototype,c),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:a.prototype}),o&&Object.assign(n.prototype,o)},yl=(n,a,o,c)=>{let d,m,u;const p={};if(a=a||{},n==null)return a;do{for(d=Object.getOwnPropertyNames(n),m=d.length;m-- >0;)u=d[m],(!c||c(u,n,a))&&!p[u]&&(a[u]=n[u],p[u]=!0);n=o!==!1&&ur(n)}while(n&&(!o||o(n,a))&&n!==Object.prototype);return a},vl=(n,a,o)=>{n=String(n),(o===void 0||o>n.length)&&(o=n.length),o-=a.length;const c=n.indexOf(a,o);return c!==-1&&c===o},bl=n=>{if(!n)return null;if(ts(n))return n;let a=n.length;if(!Mn(a))return null;const o=new Array(a);for(;a-- >0;)o[a]=n[a];return o},_l=(n=>a=>n&&a instanceof n)(typeof Uint8Array<"u"&&ur(Uint8Array)),wl=(n,a)=>{const c=(n&&n[ui]).call(n);let d;for(;(d=c.next())&&!d.done;){const m=d.value;a.call(n,m[0],m[1])}},jl=(n,a)=>{let o;const c=[];for(;(o=n.exec(a))!==null;)c.push(o);return c},Nl=mt("HTMLFormElement"),kl=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(o,c,d){return c.toUpperCase()+d}),an=(({hasOwnProperty:n})=>(a,o)=>n.call(a,o))(Object.prototype),Cl=mt("RegExp"),Rn=(n,a)=>{const o=Object.getOwnPropertyDescriptors(n),c={};Cs(o,(d,m)=>{let u;(u=a(d,m,n))!==!1&&(c[m]=u||d)}),Object.defineProperties(n,c)},Ll=n=>{Rn(n,(a,o)=>{if(st(n)&&["arguments","caller","callee"].indexOf(o)!==-1)return!1;const c=n[o];if(st(c)){if(a.enumerable=!1,"writable"in a){a.writable=!1;return}a.set||(a.set=()=>{throw Error("Can not rewrite read-only method '"+o+"'")})}})},Pl=(n,a)=>{const o={},c=d=>{d.forEach(m=>{o[m]=!0})};return ts(n)?c(n):c(String(n).split(a)),o},Sl=()=>{},Tl=(n,a)=>n!=null&&Number.isFinite(n=+n)?n:a;function El(n){return!!(n&&st(n.append)&&n[En]==="FormData"&&n[ui])}const Al=n=>{const a=new Array(10),o=(c,d)=>{if(ks(c)){if(a.indexOf(c)>=0)return;if(Ns(c))return c;if(!("toJSON"in c)){a[d]=c;const m=ts(c)?[]:{};return Cs(c,(u,p)=>{const f=o(u,d+1);!es(f)&&(m[p]=f)}),a[d]=void 0,m}}return c};return o(n,0)},Ml=mt("AsyncFunction"),Dl=n=>n&&(ks(n)||st(n))&&st(n.then)&&st(n.catch),In=((n,a)=>n?setImmediate:a?((o,c)=>(Bt.addEventListener("message",({source:d,data:m})=>{d===Bt&&m===o&&c.length&&c.shift()()},!1),d=>{c.push(d),Bt.postMessage(o,"*")}))(`axios@${Math.random()}`,[]):o=>setTimeout(o))(typeof setImmediate=="function",st(Bt.postMessage)),Ol=typeof queueMicrotask<"u"?queueMicrotask.bind(Bt):typeof process<"u"&&process.nextTick||In,Rl=n=>n!=null&&st(n[ui]),R={isArray:ts,isArrayBuffer:An,isBuffer:Ns,isFormData:ll,isArrayBufferView:Qo,isString:el,isNumber:Mn,isBoolean:tl,isObject:ks,isPlainObject:ri,isEmptyObject:sl,isReadableStream:dl,isRequest:ul,isResponse:hl,isHeaders:ml,isUndefined:es,isDate:il,isFile:rl,isBlob:nl,isRegExp:Cl,isFunction:st,isStream:ol,isURLSearchParams:cl,isTypedArray:_l,isFileList:al,forEach:Cs,merge:er,extend:pl,trim:fl,stripBOM:gl,inherits:xl,toFlatObject:yl,kindOf:hi,kindOfTest:mt,endsWith:vl,toArray:bl,forEachEntry:wl,matchAll:jl,isHTMLForm:Nl,hasOwnProperty:an,hasOwnProp:an,reduceDescriptors:Rn,freezeMethods:Ll,toObjectSet:Pl,toCamelCase:kl,noop:Sl,toFiniteNumber:Tl,findKey:Dn,global:Bt,isContextDefined:On,isSpecCompliantForm:El,toJSONObject:Al,isAsyncFn:Ml,isThenable:Dl,setImmediate:In,asap:Ol,isIterable:Rl};function we(n,a,o,c,d){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",a&&(this.code=a),o&&(this.config=o),c&&(this.request=c),d&&(this.response=d,this.status=d.status?d.status:null)}R.inherits(we,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:R.toJSONObject(this.config),code:this.code,status:this.status}}});const zn=we.prototype,Bn={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{Bn[n]={value:n}});Object.defineProperties(we,Bn);Object.defineProperty(zn,"isAxiosError",{value:!0});we.from=(n,a,o,c,d,m)=>{const u=Object.create(zn);R.toFlatObject(n,u,function(g){return g!==Error.prototype},y=>y!=="isAxiosError");const p=n&&n.message?n.message:"Error",f=a==null&&n?n.code:a;return we.call(u,p,f,o,c,d),n&&u.cause==null&&Object.defineProperty(u,"cause",{value:n,configurable:!0}),u.name=n&&n.name||"Error",m&&Object.assign(u,m),u};const Il=null;function tr(n){return R.isPlainObject(n)||R.isArray(n)}function Fn(n){return R.endsWith(n,"[]")?n.slice(0,-2):n}function on(n,a,o){return n?n.concat(a).map(function(d,m){return d=Fn(d),!o&&m?"["+d+"]":d}).join(o?".":""):a}function zl(n){return R.isArray(n)&&!n.some(tr)}const Bl=R.toFlatObject(R,{},null,function(a){return/^is[A-Z]/.test(a)});function fi(n,a,o){if(!R.isObject(n))throw new TypeError("target must be an object");a=a||new FormData,o=R.toFlatObject(o,{metaTokens:!0,dots:!1,indexes:!1},!1,function(P,M){return!R.isUndefined(M[P])});const c=o.metaTokens,d=o.visitor||g,m=o.dots,u=o.indexes,f=(o.Blob||typeof Blob<"u"&&Blob)&&R.isSpecCompliantForm(a);if(!R.isFunction(d))throw new TypeError("visitor must be a function");function y(w){if(w===null)return"";if(R.isDate(w))return w.toISOString();if(R.isBoolean(w))return w.toString();if(!f&&R.isBlob(w))throw new we("Blob is not supported. Use a Buffer instead.");return R.isArrayBuffer(w)||R.isTypedArray(w)?f&&typeof Blob=="function"?new Blob([w]):Buffer.from(w):w}function g(w,P,M){let W=w;if(w&&!M&&typeof w=="object"){if(R.endsWith(P,"{}"))P=c?P:P.slice(0,-2),w=JSON.stringify(w);else if(R.isArray(w)&&zl(w)||(R.isFileList(w)||R.endsWith(P,"[]"))&&(W=R.toArray(w)))return P=Fn(P),W.forEach(function($,z){!(R.isUndefined($)||$===null)&&a.append(u===!0?on([P],z,m):u===null?P:P+"[]",y($))}),!1}return tr(w)?!0:(a.append(on(M,P,m),y(w)),!1)}const N=[],C=Object.assign(Bl,{defaultVisitor:g,convertValue:y,isVisitable:tr});function Z(w,P){if(!R.isUndefined(w)){if(N.indexOf(w)!==-1)throw Error("Circular reference detected in "+P.join("."));N.push(w),R.forEach(w,function(W,K){(!(R.isUndefined(W)||W===null)&&d.call(a,W,R.isString(K)?K.trim():K,P,C))===!0&&Z(W,P?P.concat(K):[K])}),N.pop()}}if(!R.isObject(n))throw new TypeError("data must be an object");return Z(n),a}function ln(n){const a={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(c){return a[c]})}function hr(n,a){this._pairs=[],n&&fi(n,this,a)}const Vn=hr.prototype;Vn.append=function(a,o){this._pairs.push([a,o])};Vn.toString=function(a){const o=a?function(c){return a.call(this,c,ln)}:ln;return this._pairs.map(function(d){return o(d[0])+"="+o(d[1])},"").join("&")};function Fl(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Zn(n,a,o){if(!a)return n;const c=o&&o.encode||Fl;R.isFunction(o)&&(o={serialize:o});const d=o&&o.serialize;let m;if(d?m=d(a,o):m=R.isURLSearchParams(a)?a.toString():new hr(a,o).toString(c),m){const u=n.indexOf("#");u!==-1&&(n=n.slice(0,u)),n+=(n.indexOf("?")===-1?"?":"&")+m}return n}class cn{constructor(){this.handlers=[]}use(a,o,c){return this.handlers.push({fulfilled:a,rejected:o,synchronous:c?c.synchronous:!1,runWhen:c?c.runWhen:null}),this.handlers.length-1}eject(a){this.handlers[a]&&(this.handlers[a]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(a){R.forEach(this.handlers,function(c){c!==null&&a(c)})}}const Hn={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Vl=typeof URLSearchParams<"u"?URLSearchParams:hr,Zl=typeof FormData<"u"?FormData:null,Hl=typeof Blob<"u"?Blob:null,$l={isBrowser:!0,classes:{URLSearchParams:Vl,FormData:Zl,Blob:Hl},protocols:["http","https","file","blob","url","data"]},mr=typeof window<"u"&&typeof document<"u",sr=typeof navigator=="object"&&navigator||void 0,Ul=mr&&(!sr||["ReactNative","NativeScript","NS"].indexOf(sr.product)<0),Wl=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",ql=mr&&window.location.href||"http://localhost",Gl=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:mr,hasStandardBrowserEnv:Ul,hasStandardBrowserWebWorkerEnv:Wl,navigator:sr,origin:ql},Symbol.toStringTag,{value:"Module"})),Je={...Gl,...$l};function Kl(n,a){return fi(n,new Je.classes.URLSearchParams,{visitor:function(o,c,d,m){return Je.isNode&&R.isBuffer(o)?(this.append(c,o.toString("base64")),!1):m.defaultVisitor.apply(this,arguments)},...a})}function Jl(n){return R.matchAll(/\w+|\[(\w*)]/g,n).map(a=>a[0]==="[]"?"":a[1]||a[0])}function Yl(n){const a={},o=Object.keys(n);let c;const d=o.length;let m;for(c=0;c<d;c++)m=o[c],a[m]=n[m];return a}function $n(n){function a(o,c,d,m){let u=o[m++];if(u==="__proto__")return!0;const p=Number.isFinite(+u),f=m>=o.length;return u=!u&&R.isArray(d)?d.length:u,f?(R.hasOwnProp(d,u)?d[u]=[d[u],c]:d[u]=c,!p):((!d[u]||!R.isObject(d[u]))&&(d[u]=[]),a(o,c,d[u],m)&&R.isArray(d[u])&&(d[u]=Yl(d[u])),!p)}if(R.isFormData(n)&&R.isFunction(n.entries)){const o={};return R.forEachEntry(n,(c,d)=>{a(Jl(c),d,o,0)}),o}return null}function Xl(n,a,o){if(R.isString(n))try{return(a||JSON.parse)(n),R.trim(n)}catch(c){if(c.name!=="SyntaxError")throw c}return(o||JSON.stringify)(n)}const Ls={transitional:Hn,adapter:["xhr","http","fetch"],transformRequest:[function(a,o){const c=o.getContentType()||"",d=c.indexOf("application/json")>-1,m=R.isObject(a);if(m&&R.isHTMLForm(a)&&(a=new FormData(a)),R.isFormData(a))return d?JSON.stringify($n(a)):a;if(R.isArrayBuffer(a)||R.isBuffer(a)||R.isStream(a)||R.isFile(a)||R.isBlob(a)||R.isReadableStream(a))return a;if(R.isArrayBufferView(a))return a.buffer;if(R.isURLSearchParams(a))return o.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),a.toString();let p;if(m){if(c.indexOf("application/x-www-form-urlencoded")>-1)return Kl(a,this.formSerializer).toString();if((p=R.isFileList(a))||c.indexOf("multipart/form-data")>-1){const f=this.env&&this.env.FormData;return fi(p?{"files[]":a}:a,f&&new f,this.formSerializer)}}return m||d?(o.setContentType("application/json",!1),Xl(a)):a}],transformResponse:[function(a){const o=this.transitional||Ls.transitional,c=o&&o.forcedJSONParsing,d=this.responseType==="json";if(R.isResponse(a)||R.isReadableStream(a))return a;if(a&&R.isString(a)&&(c&&!this.responseType||d)){const u=!(o&&o.silentJSONParsing)&&d;try{return JSON.parse(a,this.parseReviver)}catch(p){if(u)throw p.name==="SyntaxError"?we.from(p,we.ERR_BAD_RESPONSE,this,null,this.response):p}}return a}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Je.classes.FormData,Blob:Je.classes.Blob},validateStatus:function(a){return a>=200&&a<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};R.forEach(["delete","get","head","post","put","patch"],n=>{Ls.headers[n]={}});const Ql=R.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ec=n=>{const a={};let o,c,d;return n&&n.split(`
`).forEach(function(u){d=u.indexOf(":"),o=u.substring(0,d).trim().toLowerCase(),c=u.substring(d+1).trim(),!(!o||a[o]&&Ql[o])&&(o==="set-cookie"?a[o]?a[o].push(c):a[o]=[c]:a[o]=a[o]?a[o]+", "+c:c)}),a},dn=Symbol("internals");function ws(n){return n&&String(n).trim().toLowerCase()}function ni(n){return n===!1||n==null?n:R.isArray(n)?n.map(ni):String(n)}function tc(n){const a=Object.create(null),o=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let c;for(;c=o.exec(n);)a[c[1]]=c[2];return a}const sc=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function Gi(n,a,o,c,d){if(R.isFunction(c))return c.call(this,a,o);if(d&&(a=o),!!R.isString(a)){if(R.isString(c))return a.indexOf(c)!==-1;if(R.isRegExp(c))return c.test(a)}}function ic(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(a,o,c)=>o.toUpperCase()+c)}function rc(n,a){const o=R.toCamelCase(" "+a);["get","set","has"].forEach(c=>{Object.defineProperty(n,c+o,{value:function(d,m,u){return this[c].call(this,a,d,m,u)},configurable:!0})})}let it=class{constructor(a){a&&this.set(a)}set(a,o,c){const d=this;function m(p,f,y){const g=ws(f);if(!g)throw new Error("header name must be a non-empty string");const N=R.findKey(d,g);(!N||d[N]===void 0||y===!0||y===void 0&&d[N]!==!1)&&(d[N||f]=ni(p))}const u=(p,f)=>R.forEach(p,(y,g)=>m(y,g,f));if(R.isPlainObject(a)||a instanceof this.constructor)u(a,o);else if(R.isString(a)&&(a=a.trim())&&!sc(a))u(ec(a),o);else if(R.isObject(a)&&R.isIterable(a)){let p={},f,y;for(const g of a){if(!R.isArray(g))throw TypeError("Object iterator must return a key-value pair");p[y=g[0]]=(f=p[y])?R.isArray(f)?[...f,g[1]]:[f,g[1]]:g[1]}u(p,o)}else a!=null&&m(o,a,c);return this}get(a,o){if(a=ws(a),a){const c=R.findKey(this,a);if(c){const d=this[c];if(!o)return d;if(o===!0)return tc(d);if(R.isFunction(o))return o.call(this,d,c);if(R.isRegExp(o))return o.exec(d);throw new TypeError("parser must be boolean|regexp|function")}}}has(a,o){if(a=ws(a),a){const c=R.findKey(this,a);return!!(c&&this[c]!==void 0&&(!o||Gi(this,this[c],c,o)))}return!1}delete(a,o){const c=this;let d=!1;function m(u){if(u=ws(u),u){const p=R.findKey(c,u);p&&(!o||Gi(c,c[p],p,o))&&(delete c[p],d=!0)}}return R.isArray(a)?a.forEach(m):m(a),d}clear(a){const o=Object.keys(this);let c=o.length,d=!1;for(;c--;){const m=o[c];(!a||Gi(this,this[m],m,a,!0))&&(delete this[m],d=!0)}return d}normalize(a){const o=this,c={};return R.forEach(this,(d,m)=>{const u=R.findKey(c,m);if(u){o[u]=ni(d),delete o[m];return}const p=a?ic(m):String(m).trim();p!==m&&delete o[m],o[p]=ni(d),c[p]=!0}),this}concat(...a){return this.constructor.concat(this,...a)}toJSON(a){const o=Object.create(null);return R.forEach(this,(c,d)=>{c!=null&&c!==!1&&(o[d]=a&&R.isArray(c)?c.join(", "):c)}),o}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([a,o])=>a+": "+o).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(a){return a instanceof this?a:new this(a)}static concat(a,...o){const c=new this(a);return o.forEach(d=>c.set(d)),c}static accessor(a){const c=(this[dn]=this[dn]={accessors:{}}).accessors,d=this.prototype;function m(u){const p=ws(u);c[p]||(rc(d,u),c[p]=!0)}return R.isArray(a)?a.forEach(m):m(a),this}};it.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);R.reduceDescriptors(it.prototype,({value:n},a)=>{let o=a[0].toUpperCase()+a.slice(1);return{get:()=>n,set(c){this[o]=c}}});R.freezeMethods(it);function Ki(n,a){const o=this||Ls,c=a||o,d=it.from(c.headers);let m=c.data;return R.forEach(n,function(p){m=p.call(o,m,d.normalize(),a?a.status:void 0)}),d.normalize(),m}function Un(n){return!!(n&&n.__CANCEL__)}function ss(n,a,o){we.call(this,n??"canceled",we.ERR_CANCELED,a,o),this.name="CanceledError"}R.inherits(ss,we,{__CANCEL__:!0});function Wn(n,a,o){const c=o.config.validateStatus;!o.status||!c||c(o.status)?n(o):a(new we("Request failed with status code "+o.status,[we.ERR_BAD_REQUEST,we.ERR_BAD_RESPONSE][Math.floor(o.status/100)-4],o.config,o.request,o))}function nc(n){const a=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return a&&a[1]||""}function ac(n,a){n=n||10;const o=new Array(n),c=new Array(n);let d=0,m=0,u;return a=a!==void 0?a:1e3,function(f){const y=Date.now(),g=c[m];u||(u=y),o[d]=f,c[d]=y;let N=m,C=0;for(;N!==d;)C+=o[N++],N=N%n;if(d=(d+1)%n,d===m&&(m=(m+1)%n),y-u<a)return;const Z=g&&y-g;return Z?Math.round(C*1e3/Z):void 0}}function oc(n,a){let o=0,c=1e3/a,d,m;const u=(y,g=Date.now())=>{o=g,d=null,m&&(clearTimeout(m),m=null),n(...y)};return[(...y)=>{const g=Date.now(),N=g-o;N>=c?u(y,g):(d=y,m||(m=setTimeout(()=>{m=null,u(d)},c-N)))},()=>d&&u(d)]}const li=(n,a,o=3)=>{let c=0;const d=ac(50,250);return oc(m=>{const u=m.loaded,p=m.lengthComputable?m.total:void 0,f=u-c,y=d(f),g=u<=p;c=u;const N={loaded:u,total:p,progress:p?u/p:void 0,bytes:f,rate:y||void 0,estimated:y&&p&&g?(p-u)/y:void 0,event:m,lengthComputable:p!=null,[a?"download":"upload"]:!0};n(N)},o)},un=(n,a)=>{const o=n!=null;return[c=>a[0]({lengthComputable:o,total:n,loaded:c}),a[1]]},hn=n=>(...a)=>R.asap(()=>n(...a)),lc=Je.hasStandardBrowserEnv?((n,a)=>o=>(o=new URL(o,Je.origin),n.protocol===o.protocol&&n.host===o.host&&(a||n.port===o.port)))(new URL(Je.origin),Je.navigator&&/(msie|trident)/i.test(Je.navigator.userAgent)):()=>!0,cc=Je.hasStandardBrowserEnv?{write(n,a,o,c,d,m){const u=[n+"="+encodeURIComponent(a)];R.isNumber(o)&&u.push("expires="+new Date(o).toGMTString()),R.isString(c)&&u.push("path="+c),R.isString(d)&&u.push("domain="+d),m===!0&&u.push("secure"),document.cookie=u.join("; ")},read(n){const a=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return a?decodeURIComponent(a[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function dc(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function uc(n,a){return a?n.replace(/\/?\/$/,"")+"/"+a.replace(/^\/+/,""):n}function qn(n,a,o){let c=!dc(a);return n&&(c||o==!1)?uc(n,a):a}const mn=n=>n instanceof it?{...n}:n;function Vt(n,a){a=a||{};const o={};function c(y,g,N,C){return R.isPlainObject(y)&&R.isPlainObject(g)?R.merge.call({caseless:C},y,g):R.isPlainObject(g)?R.merge({},g):R.isArray(g)?g.slice():g}function d(y,g,N,C){if(R.isUndefined(g)){if(!R.isUndefined(y))return c(void 0,y,N,C)}else return c(y,g,N,C)}function m(y,g){if(!R.isUndefined(g))return c(void 0,g)}function u(y,g){if(R.isUndefined(g)){if(!R.isUndefined(y))return c(void 0,y)}else return c(void 0,g)}function p(y,g,N){if(N in a)return c(y,g);if(N in n)return c(void 0,y)}const f={url:m,method:m,data:m,baseURL:u,transformRequest:u,transformResponse:u,paramsSerializer:u,timeout:u,timeoutMessage:u,withCredentials:u,withXSRFToken:u,adapter:u,responseType:u,xsrfCookieName:u,xsrfHeaderName:u,onUploadProgress:u,onDownloadProgress:u,decompress:u,maxContentLength:u,maxBodyLength:u,beforeRedirect:u,transport:u,httpAgent:u,httpsAgent:u,cancelToken:u,socketPath:u,responseEncoding:u,validateStatus:p,headers:(y,g,N)=>d(mn(y),mn(g),N,!0)};return R.forEach(Object.keys({...n,...a}),function(g){const N=f[g]||d,C=N(n[g],a[g],g);R.isUndefined(C)&&N!==p||(o[g]=C)}),o}const Gn=n=>{const a=Vt({},n);let{data:o,withXSRFToken:c,xsrfHeaderName:d,xsrfCookieName:m,headers:u,auth:p}=a;if(a.headers=u=it.from(u),a.url=Zn(qn(a.baseURL,a.url,a.allowAbsoluteUrls),n.params,n.paramsSerializer),p&&u.set("Authorization","Basic "+btoa((p.username||"")+":"+(p.password?unescape(encodeURIComponent(p.password)):""))),R.isFormData(o)){if(Je.hasStandardBrowserEnv||Je.hasStandardBrowserWebWorkerEnv)u.setContentType(void 0);else if(R.isFunction(o.getHeaders)){const f=o.getHeaders(),y=["content-type","content-length"];Object.entries(f).forEach(([g,N])=>{y.includes(g.toLowerCase())&&u.set(g,N)})}}if(Je.hasStandardBrowserEnv&&(c&&R.isFunction(c)&&(c=c(a)),c||c!==!1&&lc(a.url))){const f=d&&m&&cc.read(m);f&&u.set(d,f)}return a},hc=typeof XMLHttpRequest<"u",mc=hc&&function(n){return new Promise(function(o,c){const d=Gn(n);let m=d.data;const u=it.from(d.headers).normalize();let{responseType:p,onUploadProgress:f,onDownloadProgress:y}=d,g,N,C,Z,w;function P(){Z&&Z(),w&&w(),d.cancelToken&&d.cancelToken.unsubscribe(g),d.signal&&d.signal.removeEventListener("abort",g)}let M=new XMLHttpRequest;M.open(d.method.toUpperCase(),d.url,!0),M.timeout=d.timeout;function W(){if(!M)return;const $=it.from("getAllResponseHeaders"in M&&M.getAllResponseHeaders()),G={data:!p||p==="text"||p==="json"?M.responseText:M.response,status:M.status,statusText:M.statusText,headers:$,config:n,request:M};Wn(function(Y){o(Y),P()},function(Y){c(Y),P()},G),M=null}"onloadend"in M?M.onloadend=W:M.onreadystatechange=function(){!M||M.readyState!==4||M.status===0&&!(M.responseURL&&M.responseURL.indexOf("file:")===0)||setTimeout(W)},M.onabort=function(){M&&(c(new we("Request aborted",we.ECONNABORTED,n,M)),M=null)},M.onerror=function(z){const G=z&&z.message?z.message:"Network Error",Q=new we(G,we.ERR_NETWORK,n,M);Q.event=z||null,c(Q),M=null},M.ontimeout=function(){let z=d.timeout?"timeout of "+d.timeout+"ms exceeded":"timeout exceeded";const G=d.transitional||Hn;d.timeoutErrorMessage&&(z=d.timeoutErrorMessage),c(new we(z,G.clarifyTimeoutError?we.ETIMEDOUT:we.ECONNABORTED,n,M)),M=null},m===void 0&&u.setContentType(null),"setRequestHeader"in M&&R.forEach(u.toJSON(),function(z,G){M.setRequestHeader(G,z)}),R.isUndefined(d.withCredentials)||(M.withCredentials=!!d.withCredentials),p&&p!=="json"&&(M.responseType=d.responseType),y&&([C,w]=li(y,!0),M.addEventListener("progress",C)),f&&M.upload&&([N,Z]=li(f),M.upload.addEventListener("progress",N),M.upload.addEventListener("loadend",Z)),(d.cancelToken||d.signal)&&(g=$=>{M&&(c(!$||$.type?new ss(null,n,M):$),M.abort(),M=null)},d.cancelToken&&d.cancelToken.subscribe(g),d.signal&&(d.signal.aborted?g():d.signal.addEventListener("abort",g)));const K=nc(d.url);if(K&&Je.protocols.indexOf(K)===-1){c(new we("Unsupported protocol "+K+":",we.ERR_BAD_REQUEST,n));return}M.send(m||null)})},fc=(n,a)=>{const{length:o}=n=n?n.filter(Boolean):[];if(a||o){let c=new AbortController,d;const m=function(y){if(!d){d=!0,p();const g=y instanceof Error?y:this.reason;c.abort(g instanceof we?g:new ss(g instanceof Error?g.message:g))}};let u=a&&setTimeout(()=>{u=null,m(new we(`timeout ${a} of ms exceeded`,we.ETIMEDOUT))},a);const p=()=>{n&&(u&&clearTimeout(u),u=null,n.forEach(y=>{y.unsubscribe?y.unsubscribe(m):y.removeEventListener("abort",m)}),n=null)};n.forEach(y=>y.addEventListener("abort",m));const{signal:f}=c;return f.unsubscribe=()=>R.asap(p),f}},pc=function*(n,a){let o=n.byteLength;if(o<a){yield n;return}let c=0,d;for(;c<o;)d=c+a,yield n.slice(c,d),c=d},gc=async function*(n,a){for await(const o of xc(n))yield*pc(o,a)},xc=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const a=n.getReader();try{for(;;){const{done:o,value:c}=await a.read();if(o)break;yield c}}finally{await a.cancel()}},fn=(n,a,o,c)=>{const d=gc(n,a);let m=0,u,p=f=>{u||(u=!0,c&&c(f))};return new ReadableStream({async pull(f){try{const{done:y,value:g}=await d.next();if(y){p(),f.close();return}let N=g.byteLength;if(o){let C=m+=N;o(C)}f.enqueue(new Uint8Array(g))}catch(y){throw p(y),y}},cancel(f){return p(f),d.return()}},{highWaterMark:2})},pn=64*1024,{isFunction:si}=R,yc=(({Request:n,Response:a})=>({Request:n,Response:a}))(R.global),{ReadableStream:gn,TextEncoder:xn}=R.global,yn=(n,...a)=>{try{return!!n(...a)}catch{return!1}},vc=n=>{n=R.merge.call({skipUndefined:!0},yc,n);const{fetch:a,Request:o,Response:c}=n,d=a?si(a):typeof fetch=="function",m=si(o),u=si(c);if(!d)return!1;const p=d&&si(gn),f=d&&(typeof xn=="function"?(w=>P=>w.encode(P))(new xn):async w=>new Uint8Array(await new o(w).arrayBuffer())),y=m&&p&&yn(()=>{let w=!1;const P=new o(Je.origin,{body:new gn,method:"POST",get duplex(){return w=!0,"half"}}).headers.has("Content-Type");return w&&!P}),g=u&&p&&yn(()=>R.isReadableStream(new c("").body)),N={stream:g&&(w=>w.body)};d&&["text","arrayBuffer","blob","formData","stream"].forEach(w=>{!N[w]&&(N[w]=(P,M)=>{let W=P&&P[w];if(W)return W.call(P);throw new we(`Response type '${w}' is not supported`,we.ERR_NOT_SUPPORT,M)})});const C=async w=>{if(w==null)return 0;if(R.isBlob(w))return w.size;if(R.isSpecCompliantForm(w))return(await new o(Je.origin,{method:"POST",body:w}).arrayBuffer()).byteLength;if(R.isArrayBufferView(w)||R.isArrayBuffer(w))return w.byteLength;if(R.isURLSearchParams(w)&&(w=w+""),R.isString(w))return(await f(w)).byteLength},Z=async(w,P)=>{const M=R.toFiniteNumber(w.getContentLength());return M??C(P)};return async w=>{let{url:P,method:M,data:W,signal:K,cancelToken:$,timeout:z,onDownloadProgress:G,onUploadProgress:Q,responseType:Y,headers:X,withCredentials:ce="same-origin",fetchOptions:ye}=Gn(w),V=a||fetch;Y=Y?(Y+"").toLowerCase():"text";let J=fc([K,$&&$.toAbortSignal()],z),k=null;const E=J&&J.unsubscribe&&(()=>{J.unsubscribe()});let S;try{if(Q&&y&&M!=="get"&&M!=="head"&&(S=await Z(X,W))!==0){let ee=new o(P,{method:"POST",body:W,duplex:"half"}),de;if(R.isFormData(W)&&(de=ee.headers.get("content-type"))&&X.setContentType(de),ee.body){const[ve,be]=un(S,li(hn(Q)));W=fn(ee.body,pn,ve,be)}}R.isString(ce)||(ce=ce?"include":"omit");const j=m&&"credentials"in o.prototype,A={...ye,signal:J,method:M.toUpperCase(),headers:X.normalize().toJSON(),body:W,duplex:"half",credentials:j?ce:void 0};k=m&&new o(P,A);let x=await(m?V(k,ye):V(P,A));const b=g&&(Y==="stream"||Y==="response");if(g&&(G||b&&E)){const ee={};["status","statusText","headers"].forEach(ge=>{ee[ge]=x[ge]});const de=R.toFiniteNumber(x.headers.get("content-length")),[ve,be]=G&&un(de,li(hn(G),!0))||[];x=new c(fn(x.body,pn,ve,()=>{be&&be(),E&&E()}),ee)}Y=Y||"text";let F=await N[R.findKey(N,Y)||"text"](x,w);return!b&&E&&E(),await new Promise((ee,de)=>{Wn(ee,de,{data:F,headers:it.from(x.headers),status:x.status,statusText:x.statusText,config:w,request:k})})}catch(j){throw E&&E(),j&&j.name==="TypeError"&&/Load failed|fetch/i.test(j.message)?Object.assign(new we("Network Error",we.ERR_NETWORK,w,k),{cause:j.cause||j}):we.from(j,j&&j.code,w,k)}}},bc=new Map,Kn=n=>{let a=n?n.env:{};const{fetch:o,Request:c,Response:d}=a,m=[c,d,o];let u=m.length,p=u,f,y,g=bc;for(;p--;)f=m[p],y=g.get(f),y===void 0&&g.set(f,y=p?new Map:vc(a)),g=y;return y};Kn();const ir={http:Il,xhr:mc,fetch:{get:Kn}};R.forEach(ir,(n,a)=>{if(n){try{Object.defineProperty(n,"name",{value:a})}catch{}Object.defineProperty(n,"adapterName",{value:a})}});const vn=n=>`- ${n}`,_c=n=>R.isFunction(n)||n===null||n===!1,Jn={getAdapter:(n,a)=>{n=R.isArray(n)?n:[n];const{length:o}=n;let c,d;const m={};for(let u=0;u<o;u++){c=n[u];let p;if(d=c,!_c(c)&&(d=ir[(p=String(c)).toLowerCase()],d===void 0))throw new we(`Unknown adapter '${p}'`);if(d&&(R.isFunction(d)||(d=d.get(a))))break;m[p||"#"+u]=d}if(!d){const u=Object.entries(m).map(([f,y])=>`adapter ${f} `+(y===!1?"is not supported by the environment":"is not available in the build"));let p=o?u.length>1?`since :
`+u.map(vn).join(`
`):" "+vn(u[0]):"as no adapter specified";throw new we("There is no suitable adapter to dispatch the request "+p,"ERR_NOT_SUPPORT")}return d},adapters:ir};function Ji(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new ss(null,n)}function bn(n){return Ji(n),n.headers=it.from(n.headers),n.data=Ki.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),Jn.getAdapter(n.adapter||Ls.adapter,n)(n).then(function(c){return Ji(n),c.data=Ki.call(n,n.transformResponse,c),c.headers=it.from(c.headers),c},function(c){return Un(c)||(Ji(n),c&&c.response&&(c.response.data=Ki.call(n,n.transformResponse,c.response),c.response.headers=it.from(c.response.headers))),Promise.reject(c)})}const Yn="1.12.2",pi={};["object","boolean","number","function","string","symbol"].forEach((n,a)=>{pi[n]=function(c){return typeof c===n||"a"+(a<1?"n ":" ")+n}});const _n={};pi.transitional=function(a,o,c){function d(m,u){return"[Axios v"+Yn+"] Transitional option '"+m+"'"+u+(c?". "+c:"")}return(m,u,p)=>{if(a===!1)throw new we(d(u," has been removed"+(o?" in "+o:"")),we.ERR_DEPRECATED);return o&&!_n[u]&&(_n[u]=!0,console.warn(d(u," has been deprecated since v"+o+" and will be removed in the near future"))),a?a(m,u,p):!0}};pi.spelling=function(a){return(o,c)=>(console.warn(`${c} is likely a misspelling of ${a}`),!0)};function wc(n,a,o){if(typeof n!="object")throw new we("options must be an object",we.ERR_BAD_OPTION_VALUE);const c=Object.keys(n);let d=c.length;for(;d-- >0;){const m=c[d],u=a[m];if(u){const p=n[m],f=p===void 0||u(p,m,n);if(f!==!0)throw new we("option "+m+" must be "+f,we.ERR_BAD_OPTION_VALUE);continue}if(o!==!0)throw new we("Unknown option "+m,we.ERR_BAD_OPTION)}}const ai={assertOptions:wc,validators:pi},xt=ai.validators;let Ft=class{constructor(a){this.defaults=a||{},this.interceptors={request:new cn,response:new cn}}async request(a,o){try{return await this._request(a,o)}catch(c){if(c instanceof Error){let d={};Error.captureStackTrace?Error.captureStackTrace(d):d=new Error;const m=d.stack?d.stack.replace(/^.+\n/,""):"";try{c.stack?m&&!String(c.stack).endsWith(m.replace(/^.+\n.+\n/,""))&&(c.stack+=`
`+m):c.stack=m}catch{}}throw c}}_request(a,o){typeof a=="string"?(o=o||{},o.url=a):o=a||{},o=Vt(this.defaults,o);const{transitional:c,paramsSerializer:d,headers:m}=o;c!==void 0&&ai.assertOptions(c,{silentJSONParsing:xt.transitional(xt.boolean),forcedJSONParsing:xt.transitional(xt.boolean),clarifyTimeoutError:xt.transitional(xt.boolean)},!1),d!=null&&(R.isFunction(d)?o.paramsSerializer={serialize:d}:ai.assertOptions(d,{encode:xt.function,serialize:xt.function},!0)),o.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?o.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:o.allowAbsoluteUrls=!0),ai.assertOptions(o,{baseUrl:xt.spelling("baseURL"),withXsrfToken:xt.spelling("withXSRFToken")},!0),o.method=(o.method||this.defaults.method||"get").toLowerCase();let u=m&&R.merge(m.common,m[o.method]);m&&R.forEach(["delete","get","head","post","put","patch","common"],w=>{delete m[w]}),o.headers=it.concat(u,m);const p=[];let f=!0;this.interceptors.request.forEach(function(P){typeof P.runWhen=="function"&&P.runWhen(o)===!1||(f=f&&P.synchronous,p.unshift(P.fulfilled,P.rejected))});const y=[];this.interceptors.response.forEach(function(P){y.push(P.fulfilled,P.rejected)});let g,N=0,C;if(!f){const w=[bn.bind(this),void 0];for(w.unshift(...p),w.push(...y),C=w.length,g=Promise.resolve(o);N<C;)g=g.then(w[N++],w[N++]);return g}C=p.length;let Z=o;for(;N<C;){const w=p[N++],P=p[N++];try{Z=w(Z)}catch(M){P.call(this,M);break}}try{g=bn.call(this,Z)}catch(w){return Promise.reject(w)}for(N=0,C=y.length;N<C;)g=g.then(y[N++],y[N++]);return g}getUri(a){a=Vt(this.defaults,a);const o=qn(a.baseURL,a.url,a.allowAbsoluteUrls);return Zn(o,a.params,a.paramsSerializer)}};R.forEach(["delete","get","head","options"],function(a){Ft.prototype[a]=function(o,c){return this.request(Vt(c||{},{method:a,url:o,data:(c||{}).data}))}});R.forEach(["post","put","patch"],function(a){function o(c){return function(m,u,p){return this.request(Vt(p||{},{method:a,headers:c?{"Content-Type":"multipart/form-data"}:{},url:m,data:u}))}}Ft.prototype[a]=o(),Ft.prototype[a+"Form"]=o(!0)});let jc=class Xn{constructor(a){if(typeof a!="function")throw new TypeError("executor must be a function.");let o;this.promise=new Promise(function(m){o=m});const c=this;this.promise.then(d=>{if(!c._listeners)return;let m=c._listeners.length;for(;m-- >0;)c._listeners[m](d);c._listeners=null}),this.promise.then=d=>{let m;const u=new Promise(p=>{c.subscribe(p),m=p}).then(d);return u.cancel=function(){c.unsubscribe(m)},u},a(function(m,u,p){c.reason||(c.reason=new ss(m,u,p),o(c.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(a){if(this.reason){a(this.reason);return}this._listeners?this._listeners.push(a):this._listeners=[a]}unsubscribe(a){if(!this._listeners)return;const o=this._listeners.indexOf(a);o!==-1&&this._listeners.splice(o,1)}toAbortSignal(){const a=new AbortController,o=c=>{a.abort(c)};return this.subscribe(o),a.signal.unsubscribe=()=>this.unsubscribe(o),a.signal}static source(){let a;return{token:new Xn(function(d){a=d}),cancel:a}}};function Nc(n){return function(o){return n.apply(null,o)}}function kc(n){return R.isObject(n)&&n.isAxiosError===!0}const rr={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(rr).forEach(([n,a])=>{rr[a]=n});function Qn(n){const a=new Ft(n),o=Tn(Ft.prototype.request,a);return R.extend(o,Ft.prototype,a,{allOwnKeys:!0}),R.extend(o,a,null,{allOwnKeys:!0}),o.create=function(d){return Qn(Vt(n,d))},o}const Te=Qn(Ls);Te.Axios=Ft;Te.CanceledError=ss;Te.CancelToken=jc;Te.isCancel=Un;Te.VERSION=Yn;Te.toFormData=fi;Te.AxiosError=we;Te.Cancel=Te.CanceledError;Te.all=function(a){return Promise.all(a)};Te.spread=Nc;Te.isAxiosError=kc;Te.mergeConfig=Vt;Te.AxiosHeaders=it;Te.formToJSON=n=>$n(R.isHTMLForm(n)?new FormData(n):n);Te.getAdapter=Jn.getAdapter;Te.HttpStatusCode=rr;Te.default=Te;const{Axios:rd,AxiosError:nd,CanceledError:ad,isCancel:od,CancelToken:ld,VERSION:cd,all:dd,Cancel:ud,isAxiosError:hd,spread:md,toFormData:fd,AxiosHeaders:pd,HttpStatusCode:gd,formToJSON:xd,getAdapter:yd,mergeConfig:vd}=Te,fr=n=>{const a=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return{isValid:a.test(n),message:a.test(n)?"":"Please enter a valid email address"}},ea=n=>{const o=/[A-Z]/.test(n),c=/[a-z]/.test(n),d=/\d/.test(n),m=/[!@#$%^&*(),.?":{}|<>]/.test(n),u={score:0,feedback:[],level:"weak"};return n.length>=8?u.score+=1:u.feedback.push("At least 8 characters"),o?u.score+=1:u.feedback.push("One uppercase letter"),c?u.score+=1:u.feedback.push("One lowercase letter"),d?u.score+=1:u.feedback.push("One number"),m?u.score+=1:u.feedback.push("One special character"),u.score<=2?u.level="weak":u.score<=3?u.level="fair":u.score<=4?u.level="good":u.level="strong",{isValid:u.score>=3,strength:u,message:u.score>=3?"":"Password must meet minimum requirements"}},nr=(n,a)=>({isValid:n===a,message:n===a?"":"Passwords do not match"}),Cc=n=>{const a=["business","customer","driver"];return{isValid:a.includes(n),message:a.includes(n)?"":"Please select a valid role"}},ar=n=>{switch(n){case"weak":return"bg-red-500";case"fair":return"bg-yellow-500";case"good":return"bg-blue-500";case"strong":return"bg-green-500";default:return"bg-gray-300"}},ta=n=>{switch(n){case"weak":return"Weak";case"fair":return"Fair";case"good":return"Good";case"strong":return"Strong";default:return""}},Lc=({isOpen:n,onClose:a})=>{const[o,c]=v.useState(1),[d,m]=v.useState({email:"",resetCode:"",newPassword:"",confirmPassword:""}),[u,p]=v.useState(!1),[f,y]=v.useState(""),[g,N]=v.useState({email:"",resetCode:"",newPassword:"",confirmPassword:""}),[C,Z]=v.useState(!1),[w,P]=v.useState(!1),[M,W]=v.useState(null);v.useEffect(()=>{n&&(c(1),m({email:"",resetCode:"",newPassword:"",confirmPassword:""}),y(""),N({email:"",resetCode:"",newPassword:"",confirmPassword:""}),W(null))},[n]),v.useEffect(()=>()=>{D.dismiss()},[]);const K=V=>{const{name:J,value:k}=V.target;if(m({...d,[J]:k}),J==="email"){const E=fr(k);N(S=>({...S,email:E.message}))}else if(J==="newPassword"){const E=ea(k);W(E.strength),N(S=>({...S,newPassword:E.message}))}else if(J==="confirmPassword"){const E=nr(d.newPassword,k);N(S=>({...S,confirmPassword:E.message}))}},$=()=>d.email&&!g.email,z=()=>d.resetCode&&d.resetCode.length===6,G=()=>d.newPassword&&d.confirmPassword&&!g.newPassword&&!g.confirmPassword,Q=async()=>{var V,J,k,E;if(!$()){y("Please enter a valid email address");return}p(!0),y(""),D.dismiss();try{const S=await Te.post("/api/auth/forgot-password",{email:d.email});D.success("Reset code sent to your email!",{duration:3e3,id:"reset-code-sent"}),c(2)}catch(S){console.error("Send code error:",S);let j="Failed to send reset code";((V=S.response)==null?void 0:V.status)===404?j="No account found with this email address. Please check your email or create a new account.":((J=S.response)==null?void 0:J.status)===500?j="Server error. Please try again later.":(E=(k=S.response)==null?void 0:k.data)!=null&&E.message?j=S.response.data.message:S.message==="Network Error"&&(j="Unable to connect to server. Please check your internet connection."),y(j),D.error(j)}finally{p(!1)}},Y=async()=>{var V,J;if(!z()){y("Please enter the 6-digit verification code");return}p(!0),y(""),D.dismiss();try{c(3),D.success("Code verified! Please enter your new password.",{duration:2e3,id:"code-verified"})}catch(k){const E=((J=(V=k.response)==null?void 0:V.data)==null?void 0:J.message)||"Failed to verify code";y(E),D.error(E)}finally{p(!1)}},X=async()=>{var V,J,k,E,S;if(!G()){y("Please fix the validation errors");return}p(!0),y(""),D.dismiss();try{const j=await Te.post("/api/auth/reset-password",{email:d.email,resetCode:d.resetCode,newPassword:d.newPassword});D.success("Password reset successfully! You can now log in.",{duration:3e3,id:"password-reset-success"}),setTimeout(()=>{a()},1500)}catch(j){console.error("Reset password error:",j);let A="Failed to reset password";((V=j.response)==null?void 0:V.status)===400?j.response.data.message.includes("Invalid reset code")?A="Invalid or expired reset code. Please request a new one.":j.response.data.message.includes("No active reset code")?A="Reset code has expired. Please request a new one.":A=j.response.data.message:((J=j.response)==null?void 0:J.status)===404?A="User not found. Please try again.":((k=j.response)==null?void 0:k.status)===500?A="Server error. Please try again later.":(S=(E=j.response)==null?void 0:E.data)!=null&&S.message?A=j.response.data.message:j.message==="Network Error"&&(A="Unable to connect to server. Please check your internet connection."),y(A),D.error(A)}finally{p(!1)}},ce=()=>{o>1&&(c(o-1),y(""))},ye=async()=>{var V,J,k,E;p(!0),y(""),D.dismiss();try{const S=await Te.post("/api/auth/forgot-password",{email:d.email});D.success("New reset code sent!",{duration:2e3,id:"resend-code-success"})}catch(S){console.error("Resend code error:",S);let j="Failed to resend code";((V=S.response)==null?void 0:V.status)===404?j="No account found with this email address.":((J=S.response)==null?void 0:J.status)===500?j="Server error. Please try again later.":(E=(k=S.response)==null?void 0:k.data)!=null&&E.message?j=S.response.data.message:S.message==="Network Error"&&(j="Unable to connect to server. Please check your internet connection."),y(j),D.error(j)}finally{p(!1)}};return n?t.jsx(qe,{children:t.jsx(le.div,{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:a,children:t.jsxs(le.div,{className:"bg-white rounded-xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:V=>V.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"h-8 w-8 bg-primary-400 rounded-lg flex items-center justify-center mr-3",children:t.jsx("svg",{className:"h-5 w-5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z",clipRule:"evenodd"})})}),t.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Reset Password"})]}),t.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors",children:t.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("div",{className:"p-6",children:[t.jsx("div",{className:"flex items-center justify-center mb-6",children:t.jsx("div",{className:"flex items-center space-x-4",children:[1,2,3].map(V=>t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${o>=V?"bg-primary-500 text-white":"bg-gray-200 text-gray-500"}`,children:V}),V<3&&t.jsx("div",{className:`w-8 h-0.5 mx-2 ${o>V?"bg-primary-500":"bg-gray-200"}`})]},V))})}),o===1&&t.jsxs(le.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Enter your email address"}),t.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"We'll send you a verification code to reset your password."})]}),t.jsx(qe,{children:f&&t.jsx(le.div,{className:"p-3 bg-red-50 border border-red-200 rounded-md",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:t.jsx("p",{className:"text-sm text-red-600",children:f})})}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"})})}),t.jsx("input",{id:"email",name:"email",type:"text",value:d.email,onChange:K,autoComplete:"email",noValidate:!0,className:`block w-full pl-10 pr-3 py-2 border rounded-lg text-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors ${g.email?"border-red-300 focus:ring-red-500":d.email&&!g.email?"border-green-300 focus:ring-green-500":"border-gray-300"}`,placeholder:"Enter your email"}),d.email&&!g.email&&t.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:t.jsx("svg",{className:"h-4 w-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]}),t.jsx(qe,{children:g.email&&t.jsx(le.p,{className:"mt-1 text-sm text-red-600",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:g.email})})]}),t.jsx("button",{onClick:Q,disabled:u||!$(),className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-lg text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",children:u?t.jsxs("div",{className:"flex items-center",children:[t.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Sending..."]}):"Send Reset Code"})]}),o===2&&t.jsxs(le.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Enter verification code"}),t.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["We've sent a 6-digit code to ",t.jsx("strong",{children:d.email})]})]}),t.jsx(qe,{children:f&&t.jsx(le.div,{className:"p-3 bg-red-50 border border-red-200 rounded-md",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:t.jsx("p",{className:"text-sm text-red-600",children:f})})}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"resetCode",className:"block text-sm font-medium text-gray-700 mb-1",children:"Verification Code"}),t.jsx("input",{id:"resetCode",name:"resetCode",type:"text",maxLength:"6",value:d.resetCode,onChange:K,className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent text-center text-lg tracking-widest",placeholder:"000000"})]}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("button",{onClick:ce,className:"flex-1 py-2 px-4 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-200",children:"Back"}),t.jsx("button",{onClick:Y,disabled:u||!z(),className:"flex-1 py-2 px-4 border border-transparent rounded-lg text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",children:u?"Verifying...":"Verify Code"})]}),t.jsx("div",{className:"text-center",children:t.jsx("button",{onClick:ye,disabled:u,className:"text-sm text-primary-600 hover:text-primary-500 disabled:opacity-50",children:"Didn't receive the code? Resend"})})]}),o===3&&t.jsxs(le.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Set new password"}),t.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Create a strong password for your account."})]}),t.jsx(qe,{children:f&&t.jsx(le.div,{className:"p-3 bg-red-50 border border-red-200 rounded-md",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:t.jsx("p",{className:"text-sm text-red-600",children:f})})}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"New Password"}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),t.jsx("input",{id:"newPassword",name:"newPassword",type:C?"text":"password",value:d.newPassword,onChange:K,className:`block w-full pl-10 pr-10 py-2 border rounded-lg text-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors ${g.newPassword?"border-red-300 focus:ring-red-500":d.newPassword&&!g.newPassword?"border-green-300 focus:ring-green-500":"border-gray-300"}`,placeholder:"Enter new password"}),t.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:t.jsx("button",{type:"button",onClick:()=>Z(!C),className:"text-gray-400 hover:text-gray-600 focus:outline-none transition-colors",children:C?t.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"})}):t.jsxs("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})})]}),d.newPassword&&M&&t.jsxs("div",{className:"mt-2",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("span",{className:"text-xs text-gray-600",children:"Password strength:"}),t.jsx("span",{className:`text-xs font-medium ${M.level==="weak"?"text-red-600":M.level==="fair"?"text-yellow-600":M.level==="good"?"text-blue-600":"text-green-600"}`,children:ta(M.level)})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${ar(M.level)}`,style:{width:`${M.score/5*100}%`}})}),M.feedback.length>0&&t.jsxs("div",{className:"mt-1",children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Requirements:"}),t.jsx("ul",{className:"text-xs text-gray-500 mt-1",children:M.feedback.map((V,J)=>t.jsxs("li",{className:"flex items-center",children:[t.jsx("span",{className:"mr-1",children:""}),V]},J))})]})]}),t.jsx(qe,{children:g.newPassword&&t.jsx(le.p,{className:"mt-1 text-sm text-red-600",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:g.newPassword})})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm New Password"}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),t.jsx("input",{id:"confirmPassword",name:"confirmPassword",type:w?"text":"password",value:d.confirmPassword,onChange:K,className:`block w-full pl-10 pr-10 py-2 border rounded-lg text-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors ${g.confirmPassword?"border-red-300 focus:ring-red-500":d.confirmPassword&&!g.confirmPassword?"border-green-300 focus:ring-green-500":"border-gray-300"}`,placeholder:"Confirm new password"}),t.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:t.jsx("button",{type:"button",onClick:()=>P(!w),className:"text-gray-400 hover:text-gray-600 focus:outline-none transition-colors",children:w?t.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"})}):t.jsxs("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})})]}),t.jsx(qe,{children:g.confirmPassword&&t.jsx(le.p,{className:"mt-1 text-sm text-red-600",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:g.confirmPassword})})]}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("button",{onClick:ce,className:"flex-1 py-2 px-4 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-200",children:"Back"}),t.jsx("button",{onClick:X,disabled:u||!G(),className:"flex-1 py-2 px-4 border border-transparent rounded-lg text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",children:u?"Resetting...":"Reset Password"})]})]})]})]})})}):null},Pc=({onLogin:n})=>{const[a,o]=v.useState({email:"",password:""}),[c,d]=v.useState(!1),[m,u]=v.useState(""),[p,f]=v.useState({email:"",password:""}),[y,g]=v.useState(!1),[N,C]=v.useState(!1),[Z,w]=v.useState(!1);v.useEffect(()=>()=>{D.dismiss()},[]),v.useEffect(()=>{const z=document.createElement("script");return z.src="https://accounts.google.com/gsi/client",z.async=!0,z.defer=!0,document.body.appendChild(z),()=>{const G=document.querySelector('script[src="https://accounts.google.com/gsi/client"]');G&&document.body.removeChild(G)}},[]);const P=async z=>{var G,Q;w(!0),u(""),D.dismiss();try{console.log("Google callback received:",z);const Y=await Te.post("/api/auth/google-login",{idToken:z.credential});console.log("Backend response:",Y.data),D.success("Google login successful! Welcome back!",{duration:2e3,id:"google-login-success"}),setTimeout(()=>{n(Y.data.user,Y.data.token)},1e3)}catch(Y){console.error("Google login error:",Y);const X=((Q=(G=Y.response)==null?void 0:G.data)==null?void 0:Q.message)||"Google login failed";u(X),D.error(X)}finally{w(!1)}},M=z=>{const{name:G,value:Q}=z.target;if(o({...a,[G]:Q}),G==="email"){const Y=fr(Q);f(X=>({...X,email:Y.message}))}else G==="password"&&f(Y=>({...Y,password:Q.length<6?"Password must be at least 6 characters":""}))},W=()=>a.email&&a.password&&!p.email&&!p.password,K=async z=>{var G,Q;if(z.preventDefault(),d(!0),u(""),D.dismiss(),!W()){u("Please fix the validation errors"),d(!1);return}try{const Y=await Te.post("/api/auth/login",a);D.success("Login successful! Welcome back!",{duration:2e3,id:"login-success"}),setTimeout(()=>{n(Y.data.user,Y.data.token)},1e3)}catch(Y){const X=((Q=(G=Y.response)==null?void 0:G.data)==null?void 0:Q.message)||"Login failed";u(X),D.error(X)}finally{d(!1)}},$=async()=>{w(!0),u(""),D.dismiss();try{if(typeof window.google>"u"||!window.google.accounts)throw new Error("Google Identity Services not loaded. Please refresh the page.");window.google.accounts.id.initialize({client_id:"853562883351-ij20a2tg5a3p99bcjrn97je00sebbce7.apps.googleusercontent.com",callback:P,auto_select:!1,cancel_on_tap_outside:!0}),window.google.accounts.id.prompt(z=>{console.log("Google prompt notification:",z),(z.isNotDisplayed()||z.isSkippedMoment())&&(u("Google OAuth is not configured for this domain. Please configure Google OAuth client to allow localhost origins."),D.error("Google OAuth is not configured for this domain. Please configure Google OAuth client to allow localhost origins."),w(!1))})}catch(z){console.error("Google login error:",z);const G=z.message||"Google login failed. Please configure Google OAuth for localhost.";u(G),D.error(G),w(!1)}};return t.jsxs("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:[t.jsxs(le.div,{className:"max-w-md w-full space-y-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:[t.jsxs(le.div,{className:"text-center",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.2},children:[t.jsx("div",{className:"mx-auto h-12 w-12 bg-primary-400 rounded-lg flex items-center justify-center",children:t.jsxs("svg",{className:"h-8 w-8 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:[t.jsx("path",{d:"M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"}),t.jsx("path",{d:"M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1V5a1 1 0 00-1-1H3zM14 7a1 1 0 00-1 1v6.05A2.5 2.5 0 0115.95 14H17a1 1 0 001-1V8a1 1 0 00-1-1h-3z"})]})}),t.jsx("h2",{className:"mt-4 text-2xl font-bold text-gray-900",children:"MobiTrak"}),t.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Manage your fleet with ease"})]}),t.jsxs(le.div,{className:"bg-white rounded-xl shadow-sm p-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3},children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Welcome Back"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Sign in to your account"})]}),t.jsx(qe,{children:m&&t.jsx(le.div,{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},children:t.jsx("p",{className:"text-sm text-red-600",children:m})})}),t.jsxs("form",{onSubmit:K,className:"space-y-4",children:[t.jsxs(le.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.4},children:[t.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"})})}),t.jsx("input",{id:"email",name:"email",type:"email",required:!0,autoComplete:"username",value:a.email,onChange:M,className:`block w-full pl-10 pr-3 py-2 border rounded-lg text-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors ${p.email?"border-red-300 focus:ring-red-500":a.email&&!p.email?"border-green-300 focus:ring-green-500":"border-gray-300"}`,placeholder:"Enter your email"}),a.email&&!p.email&&t.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:t.jsx("svg",{className:"h-4 w-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]}),t.jsx(qe,{children:p.email&&t.jsx(le.p,{className:"mt-1 text-sm text-red-600",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},children:p.email})})]}),t.jsxs(le.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.5},children:[t.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),t.jsx("input",{id:"password",name:"password",type:y?"text":"password",required:!0,autoComplete:"current-password",value:a.password,onChange:M,className:`block w-full pl-10 pr-10 py-2 border rounded-lg text-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors ${p.password?"border-red-300 focus:ring-red-500":a.password&&!p.password?"border-green-300 focus:ring-green-500":"border-gray-300"}`,placeholder:"Enter your password"}),t.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:t.jsx("button",{type:"button",onClick:()=>g(!y),className:"text-gray-400 hover:text-gray-600 focus:outline-none transition-colors",children:y?t.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"})}):t.jsxs("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})})]}),t.jsx(qe,{children:p.password&&t.jsx(le.p,{className:"mt-1 text-sm text-red-600",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},children:p.password})})]}),t.jsx(le.div,{className:"flex items-center justify-between",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.6},children:t.jsx("div",{className:"text-sm",children:t.jsx("button",{onClick:()=>C(!0),className:"font-medium text-primary-600 hover:text-primary-500 transition-colors",children:"Forgot Password?"})})}),t.jsx(le.button,{type:"submit",disabled:c||!W(),className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-lg text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.7},whileHover:{scale:1.02},whileTap:{scale:.98},children:c?t.jsxs(le.div,{className:"flex items-center",initial:{opacity:0},animate:{opacity:1},children:[t.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Signing In..."]}):"Sign In"}),t.jsxs(le.div,{className:"relative",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.8},children:[t.jsx("div",{className:"absolute inset-0 flex items-center",children:t.jsx("div",{className:"w-full border-t border-gray-300"})}),t.jsx("div",{className:"relative flex justify-center text-sm",children:t.jsx("span",{className:"px-2 bg-white text-gray-500",children:"or"})})]}),t.jsx(le.button,{type:"button",onClick:$,disabled:Z,className:"w-full flex justify-center items-center py-2 px-4 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.9},whileHover:{scale:1.02},whileTap:{scale:.98},children:Z?t.jsxs(le.div,{className:"flex items-center",initial:{opacity:0},animate:{opacity:1},children:[t.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-gray-600",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Signing in with Google..."]}):t.jsxs(t.Fragment,{children:[t.jsxs("svg",{className:"h-4 w-4 mr-2",viewBox:"0 0 24 24",children:[t.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),t.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),t.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),t.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})})]})]}),t.jsx(le.div,{className:"text-center",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:1},children:t.jsxs("p",{className:"text-sm text-gray-600",children:["Don't have an account?"," ",t.jsx(wn,{to:"/register",className:"font-medium text-primary-600 hover:text-primary-500 transition-colors",children:"Sign Up"})]})}),t.jsx(le.div,{className:"fixed bottom-4 right-4",initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},transition:{duration:.5,delay:1.2},children:t.jsx(le.button,{className:"bg-purple-500 hover:bg-purple-600 text-white rounded-full p-3 shadow-lg transition-colors",whileHover:{scale:1.1},whileTap:{scale:.9},children:t.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})})]}),t.jsx(Lc,{isOpen:N,onClose:()=>C(!1)})]})},Sc=({onLogin:n})=>{const[a,o]=v.useState({email:"",password:"",confirmPassword:"",role:"",phone:"",verificationCode:""}),[c,d]=v.useState(!1),[m,u]=v.useState(""),[p,f]=v.useState({email:"",password:"",confirmPassword:"",role:"",phone:"",verificationCode:""}),[y,g]=v.useState(!1),[N,C]=v.useState(!1),[Z,w]=v.useState({score:0,level:"weak",feedback:[]}),[P,M]=v.useState("email"),[W,K]=v.useState(!1),[$,z]=v.useState(!1),[G,Q]=v.useState(!1);v.useEffect(()=>()=>{D.dismiss()},[]);const Y=k=>{const{name:E,value:S}=k.target;if(o({...a,[E]:S}),E==="email"){const j=fr(S);f(A=>({...A,email:j.message}))}else if(E==="password"){const j=ea(S);if(w(j.strength),f(A=>({...A,password:j.message})),a.confirmPassword){const A=nr(S,a.confirmPassword);f(x=>({...x,confirmPassword:A.message}))}}else if(E==="confirmPassword"){const j=nr(a.password,S);f(A=>({...A,confirmPassword:j.message}))}else if(E==="role"){const j=Cc(S);f(A=>({...A,role:j.message}))}else if(E==="phone"){const j=/^[\+]?[1-9][\d]{0,15}$/;f(A=>({...A,phone:S&&!j.test(S)?"Please enter a valid phone number":""}))}},X=()=>a.email&&a.password&&a.confirmPassword&&a.role&&!p.email&&!p.password&&!p.confirmPassword&&!p.role,ce=async()=>{var k,E;z(!0),u(""),D.dismiss();try{const S=await Te.post("/api/auth/send-verification-code",{email:a.email});D.success("Verification code sent to your email!",{duration:3e3,id:"code-sent"}),K(!0),Q(!0)}catch(S){const j=((E=(k=S.response)==null?void 0:k.data)==null?void 0:E.message)||"Failed to send verification code";u(j),D.error(j)}finally{z(!1)}},ye=async()=>{var k,E;d(!0),u(""),D.dismiss();try{const S=await Te.post("/api/auth/verify-and-register",{email:a.email,verificationCode:a.verificationCode,password:a.password,role:a.role,phone:a.phone});D.success("Registration successful! Welcome to MobiTrak!",{duration:2e3,id:"register-success"}),Q(!1),M("complete"),setTimeout(()=>{n(S.data.user,S.data.token)},1e3)}catch(S){const j=((E=(k=S.response)==null?void 0:k.data)==null?void 0:E.message)||"Verification failed";u(j),D.error(j)}finally{d(!1)}},V=async k=>{k.preventDefault(),X()&&await ce()},J=async()=>{await ce()};return t.jsx("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:t.jsxs(le.div,{className:"max-w-md w-full space-y-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:[t.jsxs(le.div,{className:"text-center",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.2},children:[t.jsx("div",{className:"mx-auto h-12 w-12 bg-primary-400 rounded-lg flex items-center justify-center",children:t.jsxs("svg",{className:"h-8 w-8 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:[t.jsx("path",{d:"M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"}),t.jsx("path",{d:"M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1V5a1 1 0 00-1-1H3zM14 7a1 1 0 00-1 1v6.05A2.5 2.5 0 0115.95 14H17a1 1 0 001-1V8a1 1 0 00-1-1h-3z"})]})}),t.jsx("h2",{className:"mt-4 text-2xl font-bold text-gray-900",children:"MobiTrak"}),t.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Join our fleet management platform"})]}),t.jsxs(le.div,{className:"bg-white rounded-xl shadow-sm p-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3},children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Create Account"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Sign up to get started"})]}),t.jsx(qe,{children:m&&t.jsx(le.div,{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},children:t.jsx("p",{className:"text-sm text-red-600",children:m})})}),t.jsxs("form",{onSubmit:V,className:"space-y-4",children:[t.jsxs(le.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.4},children:[t.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"})})}),t.jsx("input",{id:"email",name:"email",type:"email",required:!0,autoComplete:"username",value:a.email,onChange:Y,className:`block w-full pl-10 pr-3 py-2 border rounded-lg text-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors ${p.email?"border-red-300 focus:ring-red-500":a.email&&!p.email?"border-green-300 focus:ring-green-500":"border-gray-300"}`,placeholder:"Enter your email"}),a.email&&!p.email&&t.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:t.jsx("svg",{className:"h-4 w-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]}),t.jsx("button",{type:"button",onClick:ce,disabled:$||!a.email||p.email,className:"px-4 py-2 bg-primary-500 text-white text-sm font-medium rounded-lg hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:$?"Sending...":"Send Code"})]}),t.jsx(qe,{children:p.email&&t.jsx(le.p,{className:"mt-1 text-sm text-red-600",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},children:p.email})})]}),t.jsxs(le.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.5},children:[t.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number (Optional)"}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})}),t.jsx("input",{id:"phone",name:"phone",type:"tel",autoComplete:"tel",value:a.phone,onChange:Y,className:`block w-full pl-10 pr-3 py-2 border rounded-lg text-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors ${p.phone?"border-red-300 focus:ring-red-500":a.phone&&!p.phone?"border-green-300 focus:ring-green-500":"border-gray-300"}`,placeholder:"Enter your phone number"}),a.phone&&!p.phone&&t.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:t.jsx("svg",{className:"h-4 w-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]}),t.jsx(qe,{children:p.phone&&t.jsx(le.p,{className:"mt-1 text-sm text-red-600",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},children:p.phone})})]}),t.jsxs(le.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.6},children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Account Type"}),t.jsx("div",{className:"grid grid-cols-1 gap-3",children:[{id:"business",title:"Business Owner",description:"Manage your fleet and hire drivers",icon:t.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),color:"blue"},{id:"customer",title:"Customer",description:"Track shipments and place orders",icon:t.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),color:"green"},{id:"driver",title:"Driver",description:"Find job opportunities and manage trips",icon:t.jsxs("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1V5a1 1 0 00-1-1H3zM14 7a1 1 0 00-1 1v6.05A2.5 2.5 0 0115.95 14H17a1 1 0 001-1V8a1 1 0 00-1-1h-3z"})]}),color:"purple"}].map((k,E)=>t.jsx(le.button,{type:"button",onClick:()=>{o(S=>({...S,role:k.id})),f(S=>({...S,role:""}))},className:`relative p-4 rounded-lg border-2 transition-all duration-200 text-left ${a.role===k.id?`border-${k.color}-500 bg-${k.color}-50 ring-2 ring-${k.color}-200`:"border-gray-200 bg-white hover:border-gray-300 hover:bg-gray-50"}`,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.1*E},whileHover:{scale:1.02},whileTap:{scale:.98},children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:`flex-shrink-0 p-2 rounded-lg ${a.role===k.id?`bg-${k.color}-100 text-${k.color}-600`:"bg-gray-100 text-gray-600"}`,children:k.icon}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:`text-sm font-medium ${a.role===k.id?`text-${k.color}-900`:"text-gray-900"}`,children:k.title}),t.jsx("p",{className:`text-xs ${a.role===k.id?`text-${k.color}-700`:"text-gray-500"}`,children:k.description})]}),a.role===k.id&&t.jsx("div",{className:"flex-shrink-0",children:t.jsx("svg",{className:`h-5 w-5 text-${k.color}-600`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]})},k.id))}),t.jsx(qe,{children:p.role&&t.jsx(le.p,{className:"mt-2 text-sm text-red-600",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},children:p.role})})]}),t.jsxs(le.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.7},children:[t.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),t.jsx("input",{id:"password",name:"password",type:y?"text":"password",required:!0,autoComplete:"new-password",value:a.password,onChange:Y,className:`block w-full pl-10 pr-10 py-2 border rounded-lg text-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors ${p.password?"border-red-300 focus:ring-red-500":a.password&&!p.password?"border-green-300 focus:ring-green-500":"border-gray-300"}`,placeholder:"Create a strong password"}),t.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:t.jsx("button",{type:"button",onClick:()=>g(!y),className:"text-gray-400 hover:text-gray-600 focus:outline-none transition-colors",children:y?t.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"})}):t.jsxs("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})})]}),a.password&&t.jsxs("div",{className:"mt-2",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("span",{className:"text-xs text-gray-600",children:"Password strength:"}),t.jsx("span",{className:`text-xs font-medium ${ar(Z.level).replace("bg-","text-")}`,children:ta(Z.level)})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${ar(Z.level)}`,style:{width:`${Z.score/5*100}%`}})}),Z.feedback.length>0&&t.jsxs("div",{className:"mt-1 text-xs text-gray-600",children:[t.jsx("p",{children:"Requirements:"}),t.jsx("ul",{className:"list-disc list-inside ml-2",children:Z.feedback.map((k,E)=>t.jsx("li",{children:k},E))})]})]}),t.jsx(qe,{children:p.password&&t.jsx(le.p,{className:"mt-1 text-sm text-red-600",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},children:p.password})})]}),t.jsxs(le.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.8},children:[t.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password"}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),t.jsx("input",{id:"confirmPassword",name:"confirmPassword",type:N?"text":"password",required:!0,autoComplete:"new-password",value:a.confirmPassword,onChange:Y,className:`block w-full pl-10 pr-10 py-2 border rounded-lg text-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors ${p.confirmPassword?"border-red-300 focus:ring-red-500":a.confirmPassword&&!p.confirmPassword?"border-green-300 focus:ring-green-500":"border-gray-300"}`,placeholder:"Confirm your password"}),t.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:t.jsx("button",{type:"button",onClick:()=>C(!N),className:"text-gray-400 hover:text-gray-600 focus:outline-none transition-colors",children:N?t.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"})}):t.jsxs("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})}),a.confirmPassword&&!p.confirmPassword&&t.jsx("div",{className:"absolute inset-y-0 right-0 pr-10 flex items-center",children:t.jsx("svg",{className:"h-4 w-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]}),t.jsx(qe,{children:p.confirmPassword&&t.jsx(le.p,{className:"mt-1 text-sm text-red-600",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},children:p.confirmPassword})})]}),t.jsx(le.button,{type:"submit",disabled:c||!X(),className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-lg text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.9},whileHover:{scale:1.02},whileTap:{scale:.98},children:c?t.jsxs(le.div,{className:"flex items-center",initial:{opacity:0},animate:{opacity:1},children:[t.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Creating Account..."]}):"Create Account"}),t.jsxs(le.div,{className:"relative",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:1},children:[t.jsx("div",{className:"absolute inset-0 flex items-center",children:t.jsx("div",{className:"w-full border-t border-gray-300"})}),t.jsx("div",{className:"relative flex justify-center text-sm",children:t.jsx("span",{className:"px-2 bg-white text-gray-500",children:"or"})})]}),t.jsxs(le.button,{type:"button",className:"w-full flex justify-center items-center py-2 px-4 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-200",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:1.1},whileHover:{scale:1.02},whileTap:{scale:.98},children:[t.jsxs("svg",{className:"h-4 w-4 mr-2",viewBox:"0 0 24 24",children:[t.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),t.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),t.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),t.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})]})]}),t.jsx(le.div,{className:"text-center",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:1.2},children:t.jsxs("p",{className:"text-sm text-gray-600",children:["Already have an account?"," ",t.jsx(wn,{to:"/login",className:"font-medium text-primary-600 hover:text-primary-500 transition-colors",children:"Sign In"})]})}),t.jsx(le.div,{className:"fixed bottom-4 right-4",initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},transition:{duration:.5,delay:1.4},children:t.jsx(le.button,{className:"bg-purple-500 hover:bg-purple-600 text-white rounded-full p-3 shadow-lg transition-colors",whileHover:{scale:1.1},whileTap:{scale:.9},children:t.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})}),t.jsx(qe,{children:G&&t.jsx(le.div,{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:t.jsxs(le.div,{className:"bg-white rounded-xl shadow-xl max-w-md w-full p-6",initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{duration:.3},children:[t.jsxs("div",{className:"text-center mb-6",children:[t.jsx("div",{className:"mx-auto h-12 w-12 bg-primary-400 rounded-lg flex items-center justify-center mb-4",children:t.jsx("svg",{className:"h-6 w-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Verify Your Email"}),t.jsxs("p",{className:"text-sm text-gray-600",children:["Enter the 6-digit code sent to ",t.jsx("span",{className:"font-medium",children:a.email})]})]}),t.jsxs("form",{onSubmit:k=>{k.preventDefault(),ye()},className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"modalVerificationCode",className:"block text-sm font-medium text-gray-700 mb-2",children:"Verification Code"}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),t.jsx("input",{id:"modalVerificationCode",name:"verificationCode",type:"text",required:!0,maxLength:"6",autoComplete:"one-time-code",value:a.verificationCode,onChange:Y,className:`block w-full pl-10 pr-3 py-3 border rounded-lg text-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors text-center text-lg tracking-widest ${p.verificationCode?"border-red-300 focus:ring-red-500":a.verificationCode&&!p.verificationCode?"border-green-300 focus:ring-green-500":"border-gray-300"}`,placeholder:"000000",autoFocus:!0}),a.verificationCode&&!p.verificationCode&&t.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:t.jsx("svg",{className:"h-4 w-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]}),t.jsx(qe,{children:p.verificationCode&&t.jsx(le.p,{className:"mt-1 text-sm text-red-600",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},children:p.verificationCode})})]}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("button",{type:"button",onClick:()=>Q(!1),className:"flex-1 py-2 px-4 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:c||!a.verificationCode||a.verificationCode.length!==6,className:"flex-1 py-2 px-4 border border-transparent rounded-lg text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:c?"Verifying...":"Verify & Create Account"})]}),t.jsx("div",{className:"text-center",children:t.jsx("button",{type:"button",onClick:J,disabled:$,className:"text-sm text-primary-600 hover:text-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",children:$?"Sending...":"Didn't receive the code? Resend"})})]})]})})})]})})};var or={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(n,a){(function(o,c){c(a)})(no,function(o){var c="1.9.4";function d(e){var s,i,r,l;for(i=1,r=arguments.length;i<r;i++){l=arguments[i];for(s in l)e[s]=l[s]}return e}var m=Object.create||function(){function e(){}return function(s){return e.prototype=s,new e}}();function u(e,s){var i=Array.prototype.slice;if(e.bind)return e.bind.apply(e,i.call(arguments,1));var r=i.call(arguments,2);return function(){return e.apply(s,r.length?r.concat(i.call(arguments)):arguments)}}var p=0;function f(e){return"_leaflet_id"in e||(e._leaflet_id=++p),e._leaflet_id}function y(e,s,i){var r,l,h,_;return _=function(){r=!1,l&&(h.apply(i,l),l=!1)},h=function(){r?l=arguments:(e.apply(i,arguments),setTimeout(_,s),r=!0)},h}function g(e,s,i){var r=s[1],l=s[0],h=r-l;return e===r&&i?e:((e-l)%h+h)%h+l}function N(){return!1}function C(e,s){if(s===!1)return e;var i=Math.pow(10,s===void 0?6:s);return Math.round(e*i)/i}function Z(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function w(e){return Z(e).split(/\s+/)}function P(e,s){Object.prototype.hasOwnProperty.call(e,"options")||(e.options=e.options?m(e.options):{});for(var i in s)e.options[i]=s[i];return e.options}function M(e,s,i){var r=[];for(var l in e)r.push(encodeURIComponent(i?l.toUpperCase():l)+"="+encodeURIComponent(e[l]));return(!s||s.indexOf("?")===-1?"?":"&")+r.join("&")}var W=/\{ *([\w_ -]+) *\}/g;function K(e,s){return e.replace(W,function(i,r){var l=s[r];if(l===void 0)throw new Error("No value provided for variable "+i);return typeof l=="function"&&(l=l(s)),l})}var $=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};function z(e,s){for(var i=0;i<e.length;i++)if(e[i]===s)return i;return-1}var G="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function Q(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}var Y=0;function X(e){var s=+new Date,i=Math.max(0,16-(s-Y));return Y=s+i,window.setTimeout(e,i)}var ce=window.requestAnimationFrame||Q("RequestAnimationFrame")||X,ye=window.cancelAnimationFrame||Q("CancelAnimationFrame")||Q("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)};function V(e,s,i){if(i&&ce===X)e.call(s);else return ce.call(window,u(e,s))}function J(e){e&&ye.call(window,e)}var k={__proto__:null,extend:d,create:m,bind:u,get lastId(){return p},stamp:f,throttle:y,wrapNum:g,falseFn:N,formatNum:C,trim:Z,splitWords:w,setOptions:P,getParamString:M,template:K,isArray:$,indexOf:z,emptyImageUrl:G,requestFn:ce,cancelFn:ye,requestAnimFrame:V,cancelAnimFrame:J};function E(){}E.extend=function(e){var s=function(){P(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},i=s.__super__=this.prototype,r=m(i);r.constructor=s,s.prototype=r;for(var l in this)Object.prototype.hasOwnProperty.call(this,l)&&l!=="prototype"&&l!=="__super__"&&(s[l]=this[l]);return e.statics&&d(s,e.statics),e.includes&&(S(e.includes),d.apply(null,[r].concat(e.includes))),d(r,e),delete r.statics,delete r.includes,r.options&&(r.options=i.options?m(i.options):{},d(r.options,e.options)),r._initHooks=[],r.callInitHooks=function(){if(!this._initHooksCalled){i.callInitHooks&&i.callInitHooks.call(this),this._initHooksCalled=!0;for(var h=0,_=r._initHooks.length;h<_;h++)r._initHooks[h].call(this)}},s},E.include=function(e){var s=this.prototype.options;return d(this.prototype,e),e.options&&(this.prototype.options=s,this.mergeOptions(e.options)),this},E.mergeOptions=function(e){return d(this.prototype.options,e),this},E.addInitHook=function(e){var s=Array.prototype.slice.call(arguments,1),i=typeof e=="function"?e:function(){this[e].apply(this,s)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i),this};function S(e){if(!(typeof L>"u"||!L||!L.Mixin)){e=$(e)?e:[e];for(var s=0;s<e.length;s++)e[s]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var j={on:function(e,s,i){if(typeof e=="object")for(var r in e)this._on(r,e[r],s);else{e=w(e);for(var l=0,h=e.length;l<h;l++)this._on(e[l],s,i)}return this},off:function(e,s,i){if(!arguments.length)delete this._events;else if(typeof e=="object")for(var r in e)this._off(r,e[r],s);else{e=w(e);for(var l=arguments.length===1,h=0,_=e.length;h<_;h++)l?this._off(e[h]):this._off(e[h],s,i)}return this},_on:function(e,s,i,r){if(typeof s!="function"){console.warn("wrong listener type: "+typeof s);return}if(this._listens(e,s,i)===!1){i===this&&(i=void 0);var l={fn:s,ctx:i};r&&(l.once=!0),this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(l)}},_off:function(e,s,i){var r,l,h;if(this._events&&(r=this._events[e],!!r)){if(arguments.length===1){if(this._firingCount)for(l=0,h=r.length;l<h;l++)r[l].fn=N;delete this._events[e];return}if(typeof s!="function"){console.warn("wrong listener type: "+typeof s);return}var _=this._listens(e,s,i);if(_!==!1){var T=r[_];this._firingCount&&(T.fn=N,this._events[e]=r=r.slice()),r.splice(_,1)}}},fire:function(e,s,i){if(!this.listens(e,i))return this;var r=d({},s,{type:e,target:this,sourceTarget:s&&s.sourceTarget||this});if(this._events){var l=this._events[e];if(l){this._firingCount=this._firingCount+1||1;for(var h=0,_=l.length;h<_;h++){var T=l[h],O=T.fn;T.once&&this.off(e,O,T.ctx),O.call(T.ctx||this,r)}this._firingCount--}}return i&&this._propagateEvent(r),this},listens:function(e,s,i,r){typeof e!="string"&&console.warn('"string" type argument expected');var l=s;typeof s!="function"&&(r=!!s,l=void 0,i=void 0);var h=this._events&&this._events[e];if(h&&h.length&&this._listens(e,l,i)!==!1)return!0;if(r){for(var _ in this._eventParents)if(this._eventParents[_].listens(e,s,i,r))return!0}return!1},_listens:function(e,s,i){if(!this._events)return!1;var r=this._events[e]||[];if(!s)return!!r.length;i===this&&(i=void 0);for(var l=0,h=r.length;l<h;l++)if(r[l].fn===s&&r[l].ctx===i)return l;return!1},once:function(e,s,i){if(typeof e=="object")for(var r in e)this._on(r,e[r],s,!0);else{e=w(e);for(var l=0,h=e.length;l<h;l++)this._on(e[l],s,i,!0)}return this},addEventParent:function(e){return this._eventParents=this._eventParents||{},this._eventParents[f(e)]=e,this},removeEventParent:function(e){return this._eventParents&&delete this._eventParents[f(e)],this},_propagateEvent:function(e){for(var s in this._eventParents)this._eventParents[s].fire(e.type,d({layer:e.target,propagatedFrom:e.target},e),!0)}};j.addEventListener=j.on,j.removeEventListener=j.clearAllEventListeners=j.off,j.addOneTimeEventListener=j.once,j.fireEvent=j.fire,j.hasEventListeners=j.listens;var A=E.extend(j);function x(e,s,i){this.x=i?Math.round(e):e,this.y=i?Math.round(s):s}var b=Math.trunc||function(e){return e>0?Math.floor(e):Math.ceil(e)};x.prototype={clone:function(){return new x(this.x,this.y)},add:function(e){return this.clone()._add(F(e))},_add:function(e){return this.x+=e.x,this.y+=e.y,this},subtract:function(e){return this.clone()._subtract(F(e))},_subtract:function(e){return this.x-=e.x,this.y-=e.y,this},divideBy:function(e){return this.clone()._divideBy(e)},_divideBy:function(e){return this.x/=e,this.y/=e,this},multiplyBy:function(e){return this.clone()._multiplyBy(e)},_multiplyBy:function(e){return this.x*=e,this.y*=e,this},scaleBy:function(e){return new x(this.x*e.x,this.y*e.y)},unscaleBy:function(e){return new x(this.x/e.x,this.y/e.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=b(this.x),this.y=b(this.y),this},distanceTo:function(e){e=F(e);var s=e.x-this.x,i=e.y-this.y;return Math.sqrt(s*s+i*i)},equals:function(e){return e=F(e),e.x===this.x&&e.y===this.y},contains:function(e){return e=F(e),Math.abs(e.x)<=Math.abs(this.x)&&Math.abs(e.y)<=Math.abs(this.y)},toString:function(){return"Point("+C(this.x)+", "+C(this.y)+")"}};function F(e,s,i){return e instanceof x?e:$(e)?new x(e[0],e[1]):e==null?e:typeof e=="object"&&"x"in e&&"y"in e?new x(e.x,e.y):new x(e,s,i)}function ee(e,s){if(e)for(var i=s?[e,s]:e,r=0,l=i.length;r<l;r++)this.extend(i[r])}ee.prototype={extend:function(e){var s,i;if(!e)return this;if(e instanceof x||typeof e[0]=="number"||"x"in e)s=i=F(e);else if(e=de(e),s=e.min,i=e.max,!s||!i)return this;return!this.min&&!this.max?(this.min=s.clone(),this.max=i.clone()):(this.min.x=Math.min(s.x,this.min.x),this.max.x=Math.max(i.x,this.max.x),this.min.y=Math.min(s.y,this.min.y),this.max.y=Math.max(i.y,this.max.y)),this},getCenter:function(e){return F((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,e)},getBottomLeft:function(){return F(this.min.x,this.max.y)},getTopRight:function(){return F(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(e){var s,i;return typeof e[0]=="number"||e instanceof x?e=F(e):e=de(e),e instanceof ee?(s=e.min,i=e.max):s=i=e,s.x>=this.min.x&&i.x<=this.max.x&&s.y>=this.min.y&&i.y<=this.max.y},intersects:function(e){e=de(e);var s=this.min,i=this.max,r=e.min,l=e.max,h=l.x>=s.x&&r.x<=i.x,_=l.y>=s.y&&r.y<=i.y;return h&&_},overlaps:function(e){e=de(e);var s=this.min,i=this.max,r=e.min,l=e.max,h=l.x>s.x&&r.x<i.x,_=l.y>s.y&&r.y<i.y;return h&&_},isValid:function(){return!!(this.min&&this.max)},pad:function(e){var s=this.min,i=this.max,r=Math.abs(s.x-i.x)*e,l=Math.abs(s.y-i.y)*e;return de(F(s.x-r,s.y-l),F(i.x+r,i.y+l))},equals:function(e){return e?(e=de(e),this.min.equals(e.getTopLeft())&&this.max.equals(e.getBottomRight())):!1}};function de(e,s){return!e||e instanceof ee?e:new ee(e,s)}function ve(e,s){if(e)for(var i=s?[e,s]:e,r=0,l=i.length;r<l;r++)this.extend(i[r])}ve.prototype={extend:function(e){var s=this._southWest,i=this._northEast,r,l;if(e instanceof ge)r=e,l=e;else if(e instanceof ve){if(r=e._southWest,l=e._northEast,!r||!l)return this}else return e?this.extend(fe(e)||be(e)):this;return!s&&!i?(this._southWest=new ge(r.lat,r.lng),this._northEast=new ge(l.lat,l.lng)):(s.lat=Math.min(r.lat,s.lat),s.lng=Math.min(r.lng,s.lng),i.lat=Math.max(l.lat,i.lat),i.lng=Math.max(l.lng,i.lng)),this},pad:function(e){var s=this._southWest,i=this._northEast,r=Math.abs(s.lat-i.lat)*e,l=Math.abs(s.lng-i.lng)*e;return new ve(new ge(s.lat-r,s.lng-l),new ge(i.lat+r,i.lng+l))},getCenter:function(){return new ge((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new ge(this.getNorth(),this.getWest())},getSouthEast:function(){return new ge(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(e){typeof e[0]=="number"||e instanceof ge||"lat"in e?e=fe(e):e=be(e);var s=this._southWest,i=this._northEast,r,l;return e instanceof ve?(r=e.getSouthWest(),l=e.getNorthEast()):r=l=e,r.lat>=s.lat&&l.lat<=i.lat&&r.lng>=s.lng&&l.lng<=i.lng},intersects:function(e){e=be(e);var s=this._southWest,i=this._northEast,r=e.getSouthWest(),l=e.getNorthEast(),h=l.lat>=s.lat&&r.lat<=i.lat,_=l.lng>=s.lng&&r.lng<=i.lng;return h&&_},overlaps:function(e){e=be(e);var s=this._southWest,i=this._northEast,r=e.getSouthWest(),l=e.getNorthEast(),h=l.lat>s.lat&&r.lat<i.lat,_=l.lng>s.lng&&r.lng<i.lng;return h&&_},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(e,s){return e?(e=be(e),this._southWest.equals(e.getSouthWest(),s)&&this._northEast.equals(e.getNorthEast(),s)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function be(e,s){return e instanceof ve?e:new ve(e,s)}function ge(e,s,i){if(isNaN(e)||isNaN(s))throw new Error("Invalid LatLng object: ("+e+", "+s+")");this.lat=+e,this.lng=+s,i!==void 0&&(this.alt=+i)}ge.prototype={equals:function(e,s){if(!e)return!1;e=fe(e);var i=Math.max(Math.abs(this.lat-e.lat),Math.abs(this.lng-e.lng));return i<=(s===void 0?1e-9:s)},toString:function(e){return"LatLng("+C(this.lat,e)+", "+C(this.lng,e)+")"},distanceTo:function(e){return Ue.distance(this,fe(e))},wrap:function(){return Ue.wrapLatLng(this)},toBounds:function(e){var s=180*e/40075017,i=s/Math.cos(Math.PI/180*this.lat);return be([this.lat-s,this.lng-i],[this.lat+s,this.lng+i])},clone:function(){return new ge(this.lat,this.lng,this.alt)}};function fe(e,s,i){return e instanceof ge?e:$(e)&&typeof e[0]!="object"?e.length===3?new ge(e[0],e[1],e[2]):e.length===2?new ge(e[0],e[1]):null:e==null?e:typeof e=="object"&&"lat"in e?new ge(e.lat,"lng"in e?e.lng:e.lon,e.alt):s===void 0?null:new ge(e,s,i)}var Ve={latLngToPoint:function(e,s){var i=this.projection.project(e),r=this.scale(s);return this.transformation._transform(i,r)},pointToLatLng:function(e,s){var i=this.scale(s),r=this.transformation.untransform(e,i);return this.projection.unproject(r)},project:function(e){return this.projection.project(e)},unproject:function(e){return this.projection.unproject(e)},scale:function(e){return 256*Math.pow(2,e)},zoom:function(e){return Math.log(e/256)/Math.LN2},getProjectedBounds:function(e){if(this.infinite)return null;var s=this.projection.bounds,i=this.scale(e),r=this.transformation.transform(s.min,i),l=this.transformation.transform(s.max,i);return new ee(r,l)},infinite:!1,wrapLatLng:function(e){var s=this.wrapLng?g(e.lng,this.wrapLng,!0):e.lng,i=this.wrapLat?g(e.lat,this.wrapLat,!0):e.lat,r=e.alt;return new ge(i,s,r)},wrapLatLngBounds:function(e){var s=e.getCenter(),i=this.wrapLatLng(s),r=s.lat-i.lat,l=s.lng-i.lng;if(r===0&&l===0)return e;var h=e.getSouthWest(),_=e.getNorthEast(),T=new ge(h.lat-r,h.lng-l),O=new ge(_.lat-r,_.lng-l);return new ve(T,O)}},Ue=d({},Ve,{wrapLng:[-180,180],R:6371e3,distance:function(e,s){var i=Math.PI/180,r=e.lat*i,l=s.lat*i,h=Math.sin((s.lat-e.lat)*i/2),_=Math.sin((s.lng-e.lng)*i/2),T=h*h+Math.cos(r)*Math.cos(l)*_*_,O=2*Math.atan2(Math.sqrt(T),Math.sqrt(1-T));return this.R*O}}),ue=6378137,ne={R:ue,MAX_LATITUDE:85.0511287798,project:function(e){var s=Math.PI/180,i=this.MAX_LATITUDE,r=Math.max(Math.min(i,e.lat),-i),l=Math.sin(r*s);return new x(this.R*e.lng*s,this.R*Math.log((1+l)/(1-l))/2)},unproject:function(e){var s=180/Math.PI;return new ge((2*Math.atan(Math.exp(e.y/this.R))-Math.PI/2)*s,e.x*s/this.R)},bounds:function(){var e=ue*Math.PI;return new ee([-e,-e],[e,e])}()};function oe(e,s,i,r){if($(e)){this._a=e[0],this._b=e[1],this._c=e[2],this._d=e[3];return}this._a=e,this._b=s,this._c=i,this._d=r}oe.prototype={transform:function(e,s){return this._transform(e.clone(),s)},_transform:function(e,s){return s=s||1,e.x=s*(this._a*e.x+this._b),e.y=s*(this._c*e.y+this._d),e},untransform:function(e,s){return s=s||1,new x((e.x/s-this._b)/this._a,(e.y/s-this._d)/this._c)}};function he(e,s,i,r){return new oe(e,s,i,r)}var Le=d({},Ue,{code:"EPSG:3857",projection:ne,transformation:function(){var e=.5/(Math.PI*ne.R);return he(e,.5,-e,.5)}()}),Re=d({},Le,{code:"EPSG:900913"});function I(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function q(e,s){var i="",r,l,h,_,T,O;for(r=0,h=e.length;r<h;r++){for(T=e[r],l=0,_=T.length;l<_;l++)O=T[l],i+=(l?"L":"M")+O.x+" "+O.y;i+=s?ae.svg?"z":"x":""}return i||"M0 0"}var te=document.documentElement.style,se="ActiveXObject"in window,Ee=se&&!document.addEventListener,Ce="msLaunchUri"in navigator&&!("documentMode"in document),Ie=at("webkit"),Ae=at("android"),Xe=at("android 2")||at("android 3"),nt=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Et=Ae&&at("Google")&&nt<537&&!("AudioNode"in window),At=!!window.opera,Ps=!Ce&&at("chrome"),Ss=at("gecko")&&!Ie&&!At&&!se,Ge=!Ps&&at("safari"),is=at("phantom"),gi="OTransition"in te,Ts=navigator.platform.indexOf("Win")===0,Es=se&&"transition"in te,rs="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Xe,ns="MozPerspective"in te,As=!window.L_DISABLE_3D&&(Es||rs||ns)&&!gi&&!is,Ct=typeof orientation<"u"||at("mobile"),Mt=Ct&&Ie,xi=Ct&&rs,Ms=!window.PointerEvent&&window.MSPointerEvent,as=!!(window.PointerEvent||Ms),Ds="ontouchstart"in window||!!window.TouchEvent,Zt=!window.L_NO_TOUCH&&(Ds||as),yi=Ct&&At,dt=Ct&&Ss,Os=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,vi=function(){var e=!1;try{var s=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("testPassiveEventSupport",N,s),window.removeEventListener("testPassiveEventSupport",N,s)}catch{}return e}(),vt=function(){return!!document.createElement("canvas").getContext}(),os=!!(document.createElementNS&&I("svg").createSVGRect),bi=!!os&&function(){var e=document.createElement("div");return e.innerHTML="<svg/>",(e.firstChild&&e.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),_i=!os&&function(){try{var e=document.createElement("div");e.innerHTML='<v:shape adj="1"/>';var s=e.firstChild;return s.style.behavior="url(#default#VML)",s&&typeof s.adj=="object"}catch{return!1}}(),Rs=navigator.platform.indexOf("Mac")===0,wi=navigator.platform.indexOf("Linux")===0;function at(e){return navigator.userAgent.toLowerCase().indexOf(e)>=0}var ae={ie:se,ielt9:Ee,edge:Ce,webkit:Ie,android:Ae,android23:Xe,androidStock:Et,opera:At,chrome:Ps,gecko:Ss,safari:Ge,phantom:is,opera12:gi,win:Ts,ie3d:Es,webkit3d:rs,gecko3d:ns,any3d:As,mobile:Ct,mobileWebkit:Mt,mobileWebkit3d:xi,msPointer:Ms,pointer:as,touch:Zt,touchNative:Ds,mobileOpera:yi,mobileGecko:dt,retina:Os,passiveEvents:vi,canvas:vt,svg:os,vml:_i,inlineSvg:bi,mac:Rs,linux:wi},ls=ae.msPointer?"MSPointerDown":"pointerdown",cs=ae.msPointer?"MSPointerMove":"pointermove",B=ae.msPointer?"MSPointerUp":"pointerup",H=ae.msPointer?"MSPointerCancel":"pointercancel",xe={touchstart:ls,touchmove:cs,touchend:B,touchcancel:H},ie={touchstart:ra,touchmove:Is,touchend:Is,touchcancel:Is},Ne={},ze=!1;function pe(e,s,i){return s==="touchstart"&&Ht(),ie[s]?(i=ie[s].bind(this,i),e.addEventListener(xe[s],i,!1),i):(console.warn("wrong event specified:",s),N)}function Oe(e,s,i){if(!xe[s]){console.warn("wrong event specified:",s);return}e.removeEventListener(xe[s],i,!1)}function Be(e){Ne[e.pointerId]=e}function rt(e){Ne[e.pointerId]&&(Ne[e.pointerId]=e)}function Qe(e){delete Ne[e.pointerId]}function Ht(){ze||(document.addEventListener(ls,Be,!0),document.addEventListener(cs,rt,!0),document.addEventListener(B,Qe,!0),document.addEventListener(H,Qe,!0),ze=!0)}function Is(e,s){if(s.pointerType!==(s.MSPOINTER_TYPE_MOUSE||"mouse")){s.touches=[];for(var i in Ne)s.touches.push(Ne[i]);s.changedTouches=[s],e(s)}}function ra(e,s){s.MSPOINTER_TYPE_TOUCH&&s.pointerType===s.MSPOINTER_TYPE_TOUCH&&Ke(s),Is(e,s)}function na(e){var s={},i,r;for(r in e)i=e[r],s[r]=i&&i.bind?i.bind(e):i;return e=s,s.type="dblclick",s.detail=2,s.isTrusted=!1,s._simulated=!0,s}var aa=200;function oa(e,s){e.addEventListener("dblclick",s);var i=0,r;function l(h){if(h.detail!==1){r=h.detail;return}if(!(h.pointerType==="mouse"||h.sourceCapabilities&&!h.sourceCapabilities.firesTouchEvents)){var _=vr(h);if(!(_.some(function(O){return O instanceof HTMLLabelElement&&O.attributes.for})&&!_.some(function(O){return O instanceof HTMLInputElement||O instanceof HTMLSelectElement}))){var T=Date.now();T-i<=aa?(r++,r===2&&s(na(h))):r=1,i=T}}}return e.addEventListener("click",l),{dblclick:s,simDblclick:l}}function la(e,s){e.removeEventListener("dblclick",s.dblclick),e.removeEventListener("click",s.simDblclick)}var ji=Fs(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ds=Fs(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),pr=ds==="webkitTransition"||ds==="OTransition"?ds+"End":"transitionend";function gr(e){return typeof e=="string"?document.getElementById(e):e}function us(e,s){var i=e.style[s]||e.currentStyle&&e.currentStyle[s];if((!i||i==="auto")&&document.defaultView){var r=document.defaultView.getComputedStyle(e,null);i=r?r[s]:null}return i==="auto"?null:i}function Se(e,s,i){var r=document.createElement(e);return r.className=s||"",i&&i.appendChild(r),r}function De(e){var s=e.parentNode;s&&s.removeChild(e)}function zs(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function $t(e){var s=e.parentNode;s&&s.lastChild!==e&&s.appendChild(e)}function Ut(e){var s=e.parentNode;s&&s.firstChild!==e&&s.insertBefore(e,s.firstChild)}function Ni(e,s){if(e.classList!==void 0)return e.classList.contains(s);var i=Bs(e);return i.length>0&&new RegExp("(^|\\s)"+s+"(\\s|$)").test(i)}function je(e,s){if(e.classList!==void 0)for(var i=w(s),r=0,l=i.length;r<l;r++)e.classList.add(i[r]);else if(!Ni(e,s)){var h=Bs(e);ki(e,(h?h+" ":"")+s)}}function Fe(e,s){e.classList!==void 0?e.classList.remove(s):ki(e,Z((" "+Bs(e)+" ").replace(" "+s+" "," ")))}function ki(e,s){e.className.baseVal===void 0?e.className=s:e.className.baseVal=s}function Bs(e){return e.correspondingElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function ot(e,s){"opacity"in e.style?e.style.opacity=s:"filter"in e.style&&ca(e,s)}function ca(e,s){var i=!1,r="DXImageTransform.Microsoft.Alpha";try{i=e.filters.item(r)}catch{if(s===1)return}s=Math.round(s*100),i?(i.Enabled=s!==100,i.Opacity=s):e.style.filter+=" progid:"+r+"(opacity="+s+")"}function Fs(e){for(var s=document.documentElement.style,i=0;i<e.length;i++)if(e[i]in s)return e[i];return!1}function Dt(e,s,i){var r=s||new x(0,0);e.style[ji]=(ae.ie3d?"translate("+r.x+"px,"+r.y+"px)":"translate3d("+r.x+"px,"+r.y+"px,0)")+(i?" scale("+i+")":"")}function Ze(e,s){e._leaflet_pos=s,ae.any3d?Dt(e,s):(e.style.left=s.x+"px",e.style.top=s.y+"px")}function Ot(e){return e._leaflet_pos||new x(0,0)}var hs,ms,Ci;if("onselectstart"in document)hs=function(){_e(window,"selectstart",Ke)},ms=function(){Me(window,"selectstart",Ke)};else{var fs=Fs(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);hs=function(){if(fs){var e=document.documentElement.style;Ci=e[fs],e[fs]="none"}},ms=function(){fs&&(document.documentElement.style[fs]=Ci,Ci=void 0)}}function Li(){_e(window,"dragstart",Ke)}function Pi(){Me(window,"dragstart",Ke)}var Vs,Si;function Ti(e){for(;e.tabIndex===-1;)e=e.parentNode;e.style&&(Zs(),Vs=e,Si=e.style.outlineStyle,e.style.outlineStyle="none",_e(window,"keydown",Zs))}function Zs(){Vs&&(Vs.style.outlineStyle=Si,Vs=void 0,Si=void 0,Me(window,"keydown",Zs))}function xr(e){do e=e.parentNode;while((!e.offsetWidth||!e.offsetHeight)&&e!==document.body);return e}function Ei(e){var s=e.getBoundingClientRect();return{x:s.width/e.offsetWidth||1,y:s.height/e.offsetHeight||1,boundingClientRect:s}}var da={__proto__:null,TRANSFORM:ji,TRANSITION:ds,TRANSITION_END:pr,get:gr,getStyle:us,create:Se,remove:De,empty:zs,toFront:$t,toBack:Ut,hasClass:Ni,addClass:je,removeClass:Fe,setClass:ki,getClass:Bs,setOpacity:ot,testProp:Fs,setTransform:Dt,setPosition:Ze,getPosition:Ot,get disableTextSelection(){return hs},get enableTextSelection(){return ms},disableImageDrag:Li,enableImageDrag:Pi,preventOutline:Ti,restoreOutline:Zs,getSizedParentNode:xr,getScale:Ei};function _e(e,s,i,r){if(s&&typeof s=="object")for(var l in s)Mi(e,l,s[l],i);else{s=w(s);for(var h=0,_=s.length;h<_;h++)Mi(e,s[h],i,r)}return this}var ft="_leaflet_events";function Me(e,s,i,r){if(arguments.length===1)yr(e),delete e[ft];else if(s&&typeof s=="object")for(var l in s)Di(e,l,s[l],i);else if(s=w(s),arguments.length===2)yr(e,function(T){return z(s,T)!==-1});else for(var h=0,_=s.length;h<_;h++)Di(e,s[h],i,r);return this}function yr(e,s){for(var i in e[ft]){var r=i.split(/\d/)[0];(!s||s(r))&&Di(e,r,null,null,i)}}var Ai={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Mi(e,s,i,r){var l=s+f(i)+(r?"_"+f(r):"");if(e[ft]&&e[ft][l])return this;var h=function(T){return i.call(r||e,T||window.event)},_=h;!ae.touchNative&&ae.pointer&&s.indexOf("touch")===0?h=pe(e,s,h):ae.touch&&s==="dblclick"?h=oa(e,h):"addEventListener"in e?s==="touchstart"||s==="touchmove"||s==="wheel"||s==="mousewheel"?e.addEventListener(Ai[s]||s,h,ae.passiveEvents?{passive:!1}:!1):s==="mouseenter"||s==="mouseleave"?(h=function(T){T=T||window.event,Ri(e,T)&&_(T)},e.addEventListener(Ai[s],h,!1)):e.addEventListener(s,_,!1):e.attachEvent("on"+s,h),e[ft]=e[ft]||{},e[ft][l]=h}function Di(e,s,i,r,l){l=l||s+f(i)+(r?"_"+f(r):"");var h=e[ft]&&e[ft][l];if(!h)return this;!ae.touchNative&&ae.pointer&&s.indexOf("touch")===0?Oe(e,s,h):ae.touch&&s==="dblclick"?la(e,h):"removeEventListener"in e?e.removeEventListener(Ai[s]||s,h,!1):e.detachEvent("on"+s,h),e[ft][l]=null}function Rt(e){return e.stopPropagation?e.stopPropagation():e.originalEvent?e.originalEvent._stopped=!0:e.cancelBubble=!0,this}function Oi(e){return Mi(e,"wheel",Rt),this}function ps(e){return _e(e,"mousedown touchstart dblclick contextmenu",Rt),e._leaflet_disable_click=!0,this}function Ke(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this}function It(e){return Ke(e),Rt(e),this}function vr(e){if(e.composedPath)return e.composedPath();for(var s=[],i=e.target;i;)s.push(i),i=i.parentNode;return s}function br(e,s){if(!s)return new x(e.clientX,e.clientY);var i=Ei(s),r=i.boundingClientRect;return new x((e.clientX-r.left)/i.x-s.clientLeft,(e.clientY-r.top)/i.y-s.clientTop)}var ua=ae.linux&&ae.chrome?window.devicePixelRatio:ae.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function _r(e){return ae.edge?e.wheelDeltaY/2:e.deltaY&&e.deltaMode===0?-e.deltaY/ua:e.deltaY&&e.deltaMode===1?-e.deltaY*20:e.deltaY&&e.deltaMode===2?-e.deltaY*60:e.deltaX||e.deltaZ?0:e.wheelDelta?(e.wheelDeltaY||e.wheelDelta)/2:e.detail&&Math.abs(e.detail)<32765?-e.detail*20:e.detail?e.detail/-32765*60:0}function Ri(e,s){var i=s.relatedTarget;if(!i)return!0;try{for(;i&&i!==e;)i=i.parentNode}catch{return!1}return i!==e}var ha={__proto__:null,on:_e,off:Me,stopPropagation:Rt,disableScrollPropagation:Oi,disableClickPropagation:ps,preventDefault:Ke,stop:It,getPropagationPath:vr,getMousePosition:br,getWheelDelta:_r,isExternalTarget:Ri,addListener:_e,removeListener:Me},wr=A.extend({run:function(e,s,i,r){this.stop(),this._el=e,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(r||.5,.2),this._startPos=Ot(e),this._offset=s.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=V(this._animate,this),this._step()},_step:function(e){var s=+new Date-this._startTime,i=this._duration*1e3;s<i?this._runFrame(this._easeOut(s/i),e):(this._runFrame(1),this._complete())},_runFrame:function(e,s){var i=this._startPos.add(this._offset.multiplyBy(e));s&&i._round(),Ze(this._el,i),this.fire("step")},_complete:function(){J(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(e){return 1-Math.pow(1-e,this._easeOutPower)}}),Pe=A.extend({options:{crs:Le,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(e,s){s=P(this,s),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(e),this._initLayout(),this._onResize=u(this._onResize,this),this._initEvents(),s.maxBounds&&this.setMaxBounds(s.maxBounds),s.zoom!==void 0&&(this._zoom=this._limitZoom(s.zoom)),s.center&&s.zoom!==void 0&&this.setView(fe(s.center),s.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=ds&&ae.any3d&&!ae.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),_e(this._proxy,pr,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(e,s,i){if(s=s===void 0?this._zoom:this._limitZoom(s),e=this._limitCenter(fe(e),s,this.options.maxBounds),i=i||{},this._stop(),this._loaded&&!i.reset&&i!==!0){i.animate!==void 0&&(i.zoom=d({animate:i.animate},i.zoom),i.pan=d({animate:i.animate,duration:i.duration},i.pan));var r=this._zoom!==s?this._tryAnimatedZoom&&this._tryAnimatedZoom(e,s,i.zoom):this._tryAnimatedPan(e,i.pan);if(r)return clearTimeout(this._sizeTimer),this}return this._resetView(e,s,i.pan&&i.pan.noMoveStart),this},setZoom:function(e,s){return this._loaded?this.setView(this.getCenter(),e,{zoom:s}):(this._zoom=e,this)},zoomIn:function(e,s){return e=e||(ae.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+e,s)},zoomOut:function(e,s){return e=e||(ae.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-e,s)},setZoomAround:function(e,s,i){var r=this.getZoomScale(s),l=this.getSize().divideBy(2),h=e instanceof x?e:this.latLngToContainerPoint(e),_=h.subtract(l).multiplyBy(1-1/r),T=this.containerPointToLatLng(l.add(_));return this.setView(T,s,{zoom:i})},_getBoundsCenterZoom:function(e,s){s=s||{},e=e.getBounds?e.getBounds():be(e);var i=F(s.paddingTopLeft||s.padding||[0,0]),r=F(s.paddingBottomRight||s.padding||[0,0]),l=this.getBoundsZoom(e,!1,i.add(r));if(l=typeof s.maxZoom=="number"?Math.min(s.maxZoom,l):l,l===1/0)return{center:e.getCenter(),zoom:l};var h=r.subtract(i).divideBy(2),_=this.project(e.getSouthWest(),l),T=this.project(e.getNorthEast(),l),O=this.unproject(_.add(T).divideBy(2).add(h),l);return{center:O,zoom:l}},fitBounds:function(e,s){if(e=be(e),!e.isValid())throw new Error("Bounds are not valid.");var i=this._getBoundsCenterZoom(e,s);return this.setView(i.center,i.zoom,s)},fitWorld:function(e){return this.fitBounds([[-90,-180],[90,180]],e)},panTo:function(e,s){return this.setView(e,this._zoom,{pan:s})},panBy:function(e,s){if(e=F(e).round(),s=s||{},!e.x&&!e.y)return this.fire("moveend");if(s.animate!==!0&&!this.getSize().contains(e))return this._resetView(this.unproject(this.project(this.getCenter()).add(e)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new wr,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),s.noMoveStart||this.fire("movestart"),s.animate!==!1){je(this._mapPane,"leaflet-pan-anim");var i=this._getMapPanePos().subtract(e).round();this._panAnim.run(this._mapPane,i,s.duration||.25,s.easeLinearity)}else this._rawPanBy(e),this.fire("move").fire("moveend");return this},flyTo:function(e,s,i){if(i=i||{},i.animate===!1||!ae.any3d)return this.setView(e,s,i);this._stop();var r=this.project(this.getCenter()),l=this.project(e),h=this.getSize(),_=this._zoom;e=fe(e),s=s===void 0?_:s;var T=Math.max(h.x,h.y),O=T*this.getZoomScale(_,s),U=l.distanceTo(r)||1,re=1.42,me=re*re;function ke(He){var ei=He?-1:1,eo=He?O:T,to=O*O-T*T+ei*me*me*U*U,so=2*eo*me*U,qi=to/so,sn=Math.sqrt(qi*qi+1)-qi,io=sn<1e-9?-18:Math.log(sn);return io}function et(He){return(Math.exp(He)-Math.exp(-He))/2}function We(He){return(Math.exp(He)+Math.exp(-He))/2}function ct(He){return et(He)/We(He)}var tt=ke(0);function Yt(He){return T*(We(tt)/We(tt+re*He))}function Ja(He){return T*(We(tt)*ct(tt+re*He)-et(tt))/me}function Ya(He){return 1-Math.pow(1-He,1.5)}var Xa=Date.now(),en=(ke(1)-tt)/re,Qa=i.duration?1e3*i.duration:1e3*en*.8;function tn(){var He=(Date.now()-Xa)/Qa,ei=Ya(He)*en;He<=1?(this._flyToFrame=V(tn,this),this._move(this.unproject(r.add(l.subtract(r).multiplyBy(Ja(ei)/U)),_),this.getScaleZoom(T/Yt(ei),_),{flyTo:!0})):this._move(e,s)._moveEnd(!0)}return this._moveStart(!0,i.noMoveStart),tn.call(this),this},flyToBounds:function(e,s){var i=this._getBoundsCenterZoom(e,s);return this.flyTo(i.center,i.zoom,s)},setMaxBounds:function(e){return e=be(e),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),e.isValid()?(this.options.maxBounds=e,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(e){var s=this.options.minZoom;return this.options.minZoom=e,this._loaded&&s!==e&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(e):this},setMaxZoom:function(e){var s=this.options.maxZoom;return this.options.maxZoom=e,this._loaded&&s!==e&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(e):this},panInsideBounds:function(e,s){this._enforcingBounds=!0;var i=this.getCenter(),r=this._limitCenter(i,this._zoom,be(e));return i.equals(r)||this.panTo(r,s),this._enforcingBounds=!1,this},panInside:function(e,s){s=s||{};var i=F(s.paddingTopLeft||s.padding||[0,0]),r=F(s.paddingBottomRight||s.padding||[0,0]),l=this.project(this.getCenter()),h=this.project(e),_=this.getPixelBounds(),T=de([_.min.add(i),_.max.subtract(r)]),O=T.getSize();if(!T.contains(h)){this._enforcingBounds=!0;var U=h.subtract(T.getCenter()),re=T.extend(h).getSize().subtract(O);l.x+=U.x<0?-re.x:re.x,l.y+=U.y<0?-re.y:re.y,this.panTo(this.unproject(l),s),this._enforcingBounds=!1}return this},invalidateSize:function(e){if(!this._loaded)return this;e=d({animate:!1,pan:!0},e===!0?{animate:!0}:e);var s=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var i=this.getSize(),r=s.divideBy(2).round(),l=i.divideBy(2).round(),h=r.subtract(l);return!h.x&&!h.y?this:(e.animate&&e.pan?this.panBy(h):(e.pan&&this._rawPanBy(h),this.fire("move"),e.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(u(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:s,newSize:i}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(e){if(e=this._locateOptions=d({timeout:1e4,watch:!1},e),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var s=u(this._handleGeolocationResponse,this),i=u(this._handleGeolocationError,this);return e.watch?this._locationWatchId=navigator.geolocation.watchPosition(s,i,e):navigator.geolocation.getCurrentPosition(s,i,e),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(e){if(this._container._leaflet_id){var s=e.code,i=e.message||(s===1?"permission denied":s===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:s,message:"Geolocation error: "+i+"."})}},_handleGeolocationResponse:function(e){if(this._container._leaflet_id){var s=e.coords.latitude,i=e.coords.longitude,r=new ge(s,i),l=r.toBounds(e.coords.accuracy*2),h=this._locateOptions;if(h.setView){var _=this.getBoundsZoom(l);this.setView(r,h.maxZoom?Math.min(_,h.maxZoom):_)}var T={latlng:r,bounds:l,timestamp:e.timestamp};for(var O in e.coords)typeof e.coords[O]=="number"&&(T[O]=e.coords[O]);this.fire("locationfound",T)}},addHandler:function(e,s){if(!s)return this;var i=this[e]=new s(this);return this._handlers.push(i),this.options[e]&&i.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),De(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(J(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var e;for(e in this._layers)this._layers[e].remove();for(e in this._panes)De(this._panes[e]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(e,s){var i="leaflet-pane"+(e?" leaflet-"+e.replace("Pane","")+"-pane":""),r=Se("div",i,s||this._mapPane);return e&&(this._panes[e]=r),r},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var e=this.getPixelBounds(),s=this.unproject(e.getBottomLeft()),i=this.unproject(e.getTopRight());return new ve(s,i)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(e,s,i){e=be(e),i=F(i||[0,0]);var r=this.getZoom()||0,l=this.getMinZoom(),h=this.getMaxZoom(),_=e.getNorthWest(),T=e.getSouthEast(),O=this.getSize().subtract(i),U=de(this.project(T,r),this.project(_,r)).getSize(),re=ae.any3d?this.options.zoomSnap:1,me=O.x/U.x,ke=O.y/U.y,et=s?Math.max(me,ke):Math.min(me,ke);return r=this.getScaleZoom(et,r),re&&(r=Math.round(r/(re/100))*(re/100),r=s?Math.ceil(r/re)*re:Math.floor(r/re)*re),Math.max(l,Math.min(h,r))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new x(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(e,s){var i=this._getTopLeftPoint(e,s);return new ee(i,i.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(e){return this.options.crs.getProjectedBounds(e===void 0?this.getZoom():e)},getPane:function(e){return typeof e=="string"?this._panes[e]:e},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(e,s){var i=this.options.crs;return s=s===void 0?this._zoom:s,i.scale(e)/i.scale(s)},getScaleZoom:function(e,s){var i=this.options.crs;s=s===void 0?this._zoom:s;var r=i.zoom(e*i.scale(s));return isNaN(r)?1/0:r},project:function(e,s){return s=s===void 0?this._zoom:s,this.options.crs.latLngToPoint(fe(e),s)},unproject:function(e,s){return s=s===void 0?this._zoom:s,this.options.crs.pointToLatLng(F(e),s)},layerPointToLatLng:function(e){var s=F(e).add(this.getPixelOrigin());return this.unproject(s)},latLngToLayerPoint:function(e){var s=this.project(fe(e))._round();return s._subtract(this.getPixelOrigin())},wrapLatLng:function(e){return this.options.crs.wrapLatLng(fe(e))},wrapLatLngBounds:function(e){return this.options.crs.wrapLatLngBounds(be(e))},distance:function(e,s){return this.options.crs.distance(fe(e),fe(s))},containerPointToLayerPoint:function(e){return F(e).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(e){return F(e).add(this._getMapPanePos())},containerPointToLatLng:function(e){var s=this.containerPointToLayerPoint(F(e));return this.layerPointToLatLng(s)},latLngToContainerPoint:function(e){return this.layerPointToContainerPoint(this.latLngToLayerPoint(fe(e)))},mouseEventToContainerPoint:function(e){return br(e,this._container)},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e))},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e))},_initContainer:function(e){var s=this._container=gr(e);if(s){if(s._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");_e(s,"scroll",this._onScroll,this),this._containerId=f(s)},_initLayout:function(){var e=this._container;this._fadeAnimated=this.options.fadeAnimation&&ae.any3d,je(e,"leaflet-container"+(ae.touch?" leaflet-touch":"")+(ae.retina?" leaflet-retina":"")+(ae.ielt9?" leaflet-oldie":"")+(ae.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var s=us(e,"position");s!=="absolute"&&s!=="relative"&&s!=="fixed"&&s!=="sticky"&&(e.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var e=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Ze(this._mapPane,new x(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(je(e.markerPane,"leaflet-zoom-hide"),je(e.shadowPane,"leaflet-zoom-hide"))},_resetView:function(e,s,i){Ze(this._mapPane,new x(0,0));var r=!this._loaded;this._loaded=!0,s=this._limitZoom(s),this.fire("viewprereset");var l=this._zoom!==s;this._moveStart(l,i)._move(e,s)._moveEnd(l),this.fire("viewreset"),r&&this.fire("load")},_moveStart:function(e,s){return e&&this.fire("zoomstart"),s||this.fire("movestart"),this},_move:function(e,s,i,r){s===void 0&&(s=this._zoom);var l=this._zoom!==s;return this._zoom=s,this._lastCenter=e,this._pixelOrigin=this._getNewPixelOrigin(e),r?i&&i.pinch&&this.fire("zoom",i):((l||i&&i.pinch)&&this.fire("zoom",i),this.fire("move",i)),this},_moveEnd:function(e){return e&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return J(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(e){Ze(this._mapPane,this._getMapPanePos().subtract(e))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){this._targets={},this._targets[f(this._container)]=this;var s=e?Me:_e;s(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&s(window,"resize",this._onResize,this),ae.any3d&&this.options.transform3DLimit&&(e?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){J(this._resizeRequest),this._resizeRequest=V(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var e=this._getMapPanePos();Math.max(Math.abs(e.x),Math.abs(e.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(e,s){for(var i=[],r,l=s==="mouseout"||s==="mouseover",h=e.target||e.srcElement,_=!1;h;){if(r=this._targets[f(h)],r&&(s==="click"||s==="preclick")&&this._draggableMoved(r)){_=!0;break}if(r&&r.listens(s,!0)&&(l&&!Ri(h,e)||(i.push(r),l))||h===this._container)break;h=h.parentNode}return!i.length&&!_&&!l&&this.listens(s,!0)&&(i=[this]),i},_isClickDisabled:function(e){for(;e&&e!==this._container;){if(e._leaflet_disable_click)return!0;e=e.parentNode}},_handleDOMEvent:function(e){var s=e.target||e.srcElement;if(!(!this._loaded||s._leaflet_disable_events||e.type==="click"&&this._isClickDisabled(s))){var i=e.type;i==="mousedown"&&Ti(s),this._fireDOMEvent(e,i)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(e,s,i){if(e.type==="click"){var r=d({},e);r.type="preclick",this._fireDOMEvent(r,r.type,i)}var l=this._findEventTargets(e,s);if(i){for(var h=[],_=0;_<i.length;_++)i[_].listens(s,!0)&&h.push(i[_]);l=h.concat(l)}if(l.length){s==="contextmenu"&&Ke(e);var T=l[0],O={originalEvent:e};if(e.type!=="keypress"&&e.type!=="keydown"&&e.type!=="keyup"){var U=T.getLatLng&&(!T._radius||T._radius<=10);O.containerPoint=U?this.latLngToContainerPoint(T.getLatLng()):this.mouseEventToContainerPoint(e),O.layerPoint=this.containerPointToLayerPoint(O.containerPoint),O.latlng=U?T.getLatLng():this.layerPointToLatLng(O.layerPoint)}for(_=0;_<l.length;_++)if(l[_].fire(s,O,!0),O.originalEvent._stopped||l[_].options.bubblingMouseEvents===!1&&z(this._mouseEvents,s)!==-1)return}},_draggableMoved:function(e){return e=e.dragging&&e.dragging.enabled()?e:this,e.dragging&&e.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var e=0,s=this._handlers.length;e<s;e++)this._handlers[e].disable()},whenReady:function(e,s){return this._loaded?e.call(s||this,{target:this}):this.on("load",e,s),this},_getMapPanePos:function(){return Ot(this._mapPane)||new x(0,0)},_moved:function(){var e=this._getMapPanePos();return e&&!e.equals([0,0])},_getTopLeftPoint:function(e,s){var i=e&&s!==void 0?this._getNewPixelOrigin(e,s):this.getPixelOrigin();return i.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(e,s){var i=this.getSize()._divideBy(2);return this.project(e,s)._subtract(i)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(e,s,i){var r=this._getNewPixelOrigin(i,s);return this.project(e,s)._subtract(r)},_latLngBoundsToNewLayerBounds:function(e,s,i){var r=this._getNewPixelOrigin(i,s);return de([this.project(e.getSouthWest(),s)._subtract(r),this.project(e.getNorthWest(),s)._subtract(r),this.project(e.getSouthEast(),s)._subtract(r),this.project(e.getNorthEast(),s)._subtract(r)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(e){return this.latLngToLayerPoint(e).subtract(this._getCenterLayerPoint())},_limitCenter:function(e,s,i){if(!i)return e;var r=this.project(e,s),l=this.getSize().divideBy(2),h=new ee(r.subtract(l),r.add(l)),_=this._getBoundsOffset(h,i,s);return Math.abs(_.x)<=1&&Math.abs(_.y)<=1?e:this.unproject(r.add(_),s)},_limitOffset:function(e,s){if(!s)return e;var i=this.getPixelBounds(),r=new ee(i.min.add(e),i.max.add(e));return e.add(this._getBoundsOffset(r,s))},_getBoundsOffset:function(e,s,i){var r=de(this.project(s.getNorthEast(),i),this.project(s.getSouthWest(),i)),l=r.min.subtract(e.min),h=r.max.subtract(e.max),_=this._rebound(l.x,-h.x),T=this._rebound(l.y,-h.y);return new x(_,T)},_rebound:function(e,s){return e+s>0?Math.round(e-s)/2:Math.max(0,Math.ceil(e))-Math.max(0,Math.floor(s))},_limitZoom:function(e){var s=this.getMinZoom(),i=this.getMaxZoom(),r=ae.any3d?this.options.zoomSnap:1;return r&&(e=Math.round(e/r)*r),Math.max(s,Math.min(i,e))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Fe(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(e,s){var i=this._getCenterOffset(e)._trunc();return(s&&s.animate)!==!0&&!this.getSize().contains(i)?!1:(this.panBy(i,s),!0)},_createAnimProxy:function(){var e=this._proxy=Se("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(e),this.on("zoomanim",function(s){var i=ji,r=this._proxy.style[i];Dt(this._proxy,this.project(s.center,s.zoom),this.getZoomScale(s.zoom,1)),r===this._proxy.style[i]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){De(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var e=this.getCenter(),s=this.getZoom();Dt(this._proxy,this.project(e,s),this.getZoomScale(s,1))},_catchTransitionEnd:function(e){this._animatingZoom&&e.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(e,s,i){if(this._animatingZoom)return!0;if(i=i||{},!this._zoomAnimated||i.animate===!1||this._nothingToAnimate()||Math.abs(s-this._zoom)>this.options.zoomAnimationThreshold)return!1;var r=this.getZoomScale(s),l=this._getCenterOffset(e)._divideBy(1-1/r);return i.animate!==!0&&!this.getSize().contains(l)?!1:(V(function(){this._moveStart(!0,i.noMoveStart||!1)._animateZoom(e,s,!0)},this),!0)},_animateZoom:function(e,s,i,r){this._mapPane&&(i&&(this._animatingZoom=!0,this._animateToCenter=e,this._animateToZoom=s,je(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:e,zoom:s,noUpdate:r}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(u(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Fe(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function ma(e,s){return new Pe(e,s)}var ut=E.extend({options:{position:"topright"},initialize:function(e){P(this,e)},getPosition:function(){return this.options.position},setPosition:function(e){var s=this._map;return s&&s.removeControl(this),this.options.position=e,s&&s.addControl(this),this},getContainer:function(){return this._container},addTo:function(e){this.remove(),this._map=e;var s=this._container=this.onAdd(e),i=this.getPosition(),r=e._controlCorners[i];return je(s,"leaflet-control"),i.indexOf("bottom")!==-1?r.insertBefore(s,r.firstChild):r.appendChild(s),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(De(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(e){this._map&&e&&e.screenX>0&&e.screenY>0&&this._map.getContainer().focus()}}),gs=function(e){return new ut(e)};Pe.include({addControl:function(e){return e.addTo(this),this},removeControl:function(e){return e.remove(),this},_initControlPos:function(){var e=this._controlCorners={},s="leaflet-",i=this._controlContainer=Se("div",s+"control-container",this._container);function r(l,h){var _=s+l+" "+s+h;e[l+h]=Se("div",_,i)}r("top","left"),r("top","right"),r("bottom","left"),r("bottom","right")},_clearControlPos:function(){for(var e in this._controlCorners)De(this._controlCorners[e]);De(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var jr=ut.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(e,s,i,r){return i<r?-1:r<i?1:0}},initialize:function(e,s,i){P(this,i),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var r in e)this._addLayer(e[r],r);for(r in s)this._addLayer(s[r],r,!0)},onAdd:function(e){this._initLayout(),this._update(),this._map=e,e.on("zoomend",this._checkDisabledLayers,this);for(var s=0;s<this._layers.length;s++)this._layers[s].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(e){return ut.prototype.addTo.call(this,e),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(e,s){return this._addLayer(e,s),this._map?this._update():this},addOverlay:function(e,s){return this._addLayer(e,s,!0),this._map?this._update():this},removeLayer:function(e){e.off("add remove",this._onLayerChange,this);var s=this._getLayer(f(e));return s&&this._layers.splice(this._layers.indexOf(s),1),this._map?this._update():this},expand:function(){je(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var e=this._map.getSize().y-(this._container.offsetTop+50);return e<this._section.clientHeight?(je(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=e+"px"):Fe(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Fe(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var e="leaflet-control-layers",s=this._container=Se("div",e),i=this.options.collapsed;s.setAttribute("aria-haspopup",!0),ps(s),Oi(s);var r=this._section=Se("section",e+"-list");i&&(this._map.on("click",this.collapse,this),_e(s,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var l=this._layersLink=Se("a",e+"-toggle",s);l.href="#",l.title="Layers",l.setAttribute("role","button"),_e(l,{keydown:function(h){h.keyCode===13&&this._expandSafely()},click:function(h){Ke(h),this._expandSafely()}},this),i||this.expand(),this._baseLayersList=Se("div",e+"-base",r),this._separator=Se("div",e+"-separator",r),this._overlaysList=Se("div",e+"-overlays",r),s.appendChild(r)},_getLayer:function(e){for(var s=0;s<this._layers.length;s++)if(this._layers[s]&&f(this._layers[s].layer)===e)return this._layers[s]},_addLayer:function(e,s,i){this._map&&e.on("add remove",this._onLayerChange,this),this._layers.push({layer:e,name:s,overlay:i}),this.options.sortLayers&&this._layers.sort(u(function(r,l){return this.options.sortFunction(r.layer,l.layer,r.name,l.name)},this)),this.options.autoZIndex&&e.setZIndex&&(this._lastZIndex++,e.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;zs(this._baseLayersList),zs(this._overlaysList),this._layerControlInputs=[];var e,s,i,r,l=0;for(i=0;i<this._layers.length;i++)r=this._layers[i],this._addItem(r),s=s||r.overlay,e=e||!r.overlay,l+=r.overlay?0:1;return this.options.hideSingleBase&&(e=e&&l>1,this._baseLayersList.style.display=e?"":"none"),this._separator.style.display=s&&e?"":"none",this},_onLayerChange:function(e){this._handlingClick||this._update();var s=this._getLayer(f(e.target)),i=s.overlay?e.type==="add"?"overlayadd":"overlayremove":e.type==="add"?"baselayerchange":null;i&&this._map.fire(i,s)},_createRadioElement:function(e,s){var i='<input type="radio" class="leaflet-control-layers-selector" name="'+e+'"'+(s?' checked="checked"':"")+"/>",r=document.createElement("div");return r.innerHTML=i,r.firstChild},_addItem:function(e){var s=document.createElement("label"),i=this._map.hasLayer(e.layer),r;e.overlay?(r=document.createElement("input"),r.type="checkbox",r.className="leaflet-control-layers-selector",r.defaultChecked=i):r=this._createRadioElement("leaflet-base-layers_"+f(this),i),this._layerControlInputs.push(r),r.layerId=f(e.layer),_e(r,"click",this._onInputClick,this);var l=document.createElement("span");l.innerHTML=" "+e.name;var h=document.createElement("span");s.appendChild(h),h.appendChild(r),h.appendChild(l);var _=e.overlay?this._overlaysList:this._baseLayersList;return _.appendChild(s),this._checkDisabledLayers(),s},_onInputClick:function(){if(!this._preventClick){var e=this._layerControlInputs,s,i,r=[],l=[];this._handlingClick=!0;for(var h=e.length-1;h>=0;h--)s=e[h],i=this._getLayer(s.layerId).layer,s.checked?r.push(i):s.checked||l.push(i);for(h=0;h<l.length;h++)this._map.hasLayer(l[h])&&this._map.removeLayer(l[h]);for(h=0;h<r.length;h++)this._map.hasLayer(r[h])||this._map.addLayer(r[h]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var e=this._layerControlInputs,s,i,r=this._map.getZoom(),l=e.length-1;l>=0;l--)s=e[l],i=this._getLayer(s.layerId).layer,s.disabled=i.options.minZoom!==void 0&&r<i.options.minZoom||i.options.maxZoom!==void 0&&r>i.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var e=this._section;this._preventClick=!0,_e(e,"click",Ke),this.expand();var s=this;setTimeout(function(){Me(e,"click",Ke),s._preventClick=!1})}}),fa=function(e,s,i){return new jr(e,s,i)},Ii=ut.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(e){var s="leaflet-control-zoom",i=Se("div",s+" leaflet-bar"),r=this.options;return this._zoomInButton=this._createButton(r.zoomInText,r.zoomInTitle,s+"-in",i,this._zoomIn),this._zoomOutButton=this._createButton(r.zoomOutText,r.zoomOutTitle,s+"-out",i,this._zoomOut),this._updateDisabled(),e.on("zoomend zoomlevelschange",this._updateDisabled,this),i},onRemove:function(e){e.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(e){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(e.shiftKey?3:1))},_zoomOut:function(e){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(e.shiftKey?3:1))},_createButton:function(e,s,i,r,l){var h=Se("a",i,r);return h.innerHTML=e,h.href="#",h.title=s,h.setAttribute("role","button"),h.setAttribute("aria-label",s),ps(h),_e(h,"click",It),_e(h,"click",l,this),_e(h,"click",this._refocusOnMap,this),h},_updateDisabled:function(){var e=this._map,s="leaflet-disabled";Fe(this._zoomInButton,s),Fe(this._zoomOutButton,s),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||e._zoom===e.getMinZoom())&&(je(this._zoomOutButton,s),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||e._zoom===e.getMaxZoom())&&(je(this._zoomInButton,s),this._zoomInButton.setAttribute("aria-disabled","true"))}});Pe.mergeOptions({zoomControl:!0}),Pe.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Ii,this.addControl(this.zoomControl))});var pa=function(e){return new Ii(e)},Nr=ut.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(e){var s="leaflet-control-scale",i=Se("div",s),r=this.options;return this._addScales(r,s+"-line",i),e.on(r.updateWhenIdle?"moveend":"move",this._update,this),e.whenReady(this._update,this),i},onRemove:function(e){e.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(e,s,i){e.metric&&(this._mScale=Se("div",s,i)),e.imperial&&(this._iScale=Se("div",s,i))},_update:function(){var e=this._map,s=e.getSize().y/2,i=e.distance(e.containerPointToLatLng([0,s]),e.containerPointToLatLng([this.options.maxWidth,s]));this._updateScales(i)},_updateScales:function(e){this.options.metric&&e&&this._updateMetric(e),this.options.imperial&&e&&this._updateImperial(e)},_updateMetric:function(e){var s=this._getRoundNum(e),i=s<1e3?s+" m":s/1e3+" km";this._updateScale(this._mScale,i,s/e)},_updateImperial:function(e){var s=e*3.2808399,i,r,l;s>5280?(i=s/5280,r=this._getRoundNum(i),this._updateScale(this._iScale,r+" mi",r/i)):(l=this._getRoundNum(s),this._updateScale(this._iScale,l+" ft",l/s))},_updateScale:function(e,s,i){e.style.width=Math.round(this.options.maxWidth*i)+"px",e.innerHTML=s},_getRoundNum:function(e){var s=Math.pow(10,(Math.floor(e)+"").length-1),i=e/s;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1,s*i}}),ga=function(e){return new Nr(e)},xa='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',zi=ut.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(ae.inlineSvg?xa+" ":"")+"Leaflet</a>"},initialize:function(e){P(this,e),this._attributions={}},onAdd:function(e){e.attributionControl=this,this._container=Se("div","leaflet-control-attribution"),ps(this._container);for(var s in e._layers)e._layers[s].getAttribution&&this.addAttribution(e._layers[s].getAttribution());return this._update(),e.on("layeradd",this._addAttribution,this),this._container},onRemove:function(e){e.off("layeradd",this._addAttribution,this)},_addAttribution:function(e){e.layer.getAttribution&&(this.addAttribution(e.layer.getAttribution()),e.layer.once("remove",function(){this.removeAttribution(e.layer.getAttribution())},this))},setPrefix:function(e){return this.options.prefix=e,this._update(),this},addAttribution:function(e){return e?(this._attributions[e]||(this._attributions[e]=0),this._attributions[e]++,this._update(),this):this},removeAttribution:function(e){return e?(this._attributions[e]&&(this._attributions[e]--,this._update()),this):this},_update:function(){if(this._map){var e=[];for(var s in this._attributions)this._attributions[s]&&e.push(s);var i=[];this.options.prefix&&i.push(this.options.prefix),e.length&&i.push(e.join(", ")),this._container.innerHTML=i.join(' <span aria-hidden="true">|</span> ')}}});Pe.mergeOptions({attributionControl:!0}),Pe.addInitHook(function(){this.options.attributionControl&&new zi().addTo(this)});var ya=function(e){return new zi(e)};ut.Layers=jr,ut.Zoom=Ii,ut.Scale=Nr,ut.Attribution=zi,gs.layers=fa,gs.zoom=pa,gs.scale=ga,gs.attribution=ya;var pt=E.extend({initialize:function(e){this._map=e},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});pt.addTo=function(e,s){return e.addHandler(s,this),this};var va={Events:j},kr=ae.touch?"touchstart mousedown":"mousedown",Lt=A.extend({options:{clickTolerance:3},initialize:function(e,s,i,r){P(this,r),this._element=e,this._dragStartTarget=s||e,this._preventOutline=i},enable:function(){this._enabled||(_e(this._dragStartTarget,kr,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Lt._dragging===this&&this.finishDrag(!0),Me(this._dragStartTarget,kr,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(e){if(this._enabled&&(this._moved=!1,!Ni(this._element,"leaflet-zoom-anim"))){if(e.touches&&e.touches.length!==1){Lt._dragging===this&&this.finishDrag();return}if(!(Lt._dragging||e.shiftKey||e.which!==1&&e.button!==1&&!e.touches)&&(Lt._dragging=this,this._preventOutline&&Ti(this._element),Li(),hs(),!this._moving)){this.fire("down");var s=e.touches?e.touches[0]:e,i=xr(this._element);this._startPoint=new x(s.clientX,s.clientY),this._startPos=Ot(this._element),this._parentScale=Ei(i);var r=e.type==="mousedown";_e(document,r?"mousemove":"touchmove",this._onMove,this),_e(document,r?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(e){if(this._enabled){if(e.touches&&e.touches.length>1){this._moved=!0;return}var s=e.touches&&e.touches.length===1?e.touches[0]:e,i=new x(s.clientX,s.clientY)._subtract(this._startPoint);!i.x&&!i.y||Math.abs(i.x)+Math.abs(i.y)<this.options.clickTolerance||(i.x/=this._parentScale.x,i.y/=this._parentScale.y,Ke(e),this._moved||(this.fire("dragstart"),this._moved=!0,je(document.body,"leaflet-dragging"),this._lastTarget=e.target||e.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),je(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(i),this._moving=!0,this._lastEvent=e,this._updatePosition())}},_updatePosition:function(){var e={originalEvent:this._lastEvent};this.fire("predrag",e),Ze(this._element,this._newPos),this.fire("drag",e)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(e){Fe(document.body,"leaflet-dragging"),this._lastTarget&&(Fe(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Me(document,"mousemove touchmove",this._onMove,this),Me(document,"mouseup touchend touchcancel",this._onUp,this),Pi(),ms();var s=this._moved&&this._moving;this._moving=!1,Lt._dragging=!1,s&&this.fire("dragend",{noInertia:e,distance:this._newPos.distanceTo(this._startPos)})}});function Cr(e,s,i){var r,l=[1,4,2,8],h,_,T,O,U,re,me,ke;for(h=0,re=e.length;h<re;h++)e[h]._code=zt(e[h],s);for(T=0;T<4;T++){for(me=l[T],r=[],h=0,re=e.length,_=re-1;h<re;_=h++)O=e[h],U=e[_],O._code&me?U._code&me||(ke=Hs(U,O,me,s,i),ke._code=zt(ke,s),r.push(ke)):(U._code&me&&(ke=Hs(U,O,me,s,i),ke._code=zt(ke,s),r.push(ke)),r.push(O));e=r}return e}function Lr(e,s){var i,r,l,h,_,T,O,U,re;if(!e||e.length===0)throw new Error("latlngs not passed");lt(e)||(console.warn("latlngs are not flat! Only the first ring will be used"),e=e[0]);var me=fe([0,0]),ke=be(e),et=ke.getNorthWest().distanceTo(ke.getSouthWest())*ke.getNorthEast().distanceTo(ke.getNorthWest());et<1700&&(me=Bi(e));var We=e.length,ct=[];for(i=0;i<We;i++){var tt=fe(e[i]);ct.push(s.project(fe([tt.lat-me.lat,tt.lng-me.lng])))}for(T=O=U=0,i=0,r=We-1;i<We;r=i++)l=ct[i],h=ct[r],_=l.y*h.x-h.y*l.x,O+=(l.x+h.x)*_,U+=(l.y+h.y)*_,T+=_*3;T===0?re=ct[0]:re=[O/T,U/T];var Yt=s.unproject(F(re));return fe([Yt.lat+me.lat,Yt.lng+me.lng])}function Bi(e){for(var s=0,i=0,r=0,l=0;l<e.length;l++){var h=fe(e[l]);s+=h.lat,i+=h.lng,r++}return fe([s/r,i/r])}var ba={__proto__:null,clipPolygon:Cr,polygonCenter:Lr,centroid:Bi};function Pr(e,s){if(!s||!e.length)return e.slice();var i=s*s;return e=ja(e,i),e=wa(e,i),e}function Sr(e,s,i){return Math.sqrt(xs(e,s,i,!0))}function _a(e,s,i){return xs(e,s,i)}function wa(e,s){var i=e.length,r=typeof Uint8Array<"u"?Uint8Array:Array,l=new r(i);l[0]=l[i-1]=1,Fi(e,l,s,0,i-1);var h,_=[];for(h=0;h<i;h++)l[h]&&_.push(e[h]);return _}function Fi(e,s,i,r,l){var h=0,_,T,O;for(T=r+1;T<=l-1;T++)O=xs(e[T],e[r],e[l],!0),O>h&&(_=T,h=O);h>i&&(s[_]=1,Fi(e,s,i,r,_),Fi(e,s,i,_,l))}function ja(e,s){for(var i=[e[0]],r=1,l=0,h=e.length;r<h;r++)Na(e[r],e[l])>s&&(i.push(e[r]),l=r);return l<h-1&&i.push(e[h-1]),i}var Tr;function Er(e,s,i,r,l){var h=r?Tr:zt(e,i),_=zt(s,i),T,O,U;for(Tr=_;;){if(!(h|_))return[e,s];if(h&_)return!1;T=h||_,O=Hs(e,s,T,i,l),U=zt(O,i),T===h?(e=O,h=U):(s=O,_=U)}}function Hs(e,s,i,r,l){var h=s.x-e.x,_=s.y-e.y,T=r.min,O=r.max,U,re;return i&8?(U=e.x+h*(O.y-e.y)/_,re=O.y):i&4?(U=e.x+h*(T.y-e.y)/_,re=T.y):i&2?(U=O.x,re=e.y+_*(O.x-e.x)/h):i&1&&(U=T.x,re=e.y+_*(T.x-e.x)/h),new x(U,re,l)}function zt(e,s){var i=0;return e.x<s.min.x?i|=1:e.x>s.max.x&&(i|=2),e.y<s.min.y?i|=4:e.y>s.max.y&&(i|=8),i}function Na(e,s){var i=s.x-e.x,r=s.y-e.y;return i*i+r*r}function xs(e,s,i,r){var l=s.x,h=s.y,_=i.x-l,T=i.y-h,O=_*_+T*T,U;return O>0&&(U=((e.x-l)*_+(e.y-h)*T)/O,U>1?(l=i.x,h=i.y):U>0&&(l+=_*U,h+=T*U)),_=e.x-l,T=e.y-h,r?_*_+T*T:new x(l,h)}function lt(e){return!$(e[0])||typeof e[0][0]!="object"&&typeof e[0][0]<"u"}function Ar(e){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),lt(e)}function Mr(e,s){var i,r,l,h,_,T,O,U;if(!e||e.length===0)throw new Error("latlngs not passed");lt(e)||(console.warn("latlngs are not flat! Only the first ring will be used"),e=e[0]);var re=fe([0,0]),me=be(e),ke=me.getNorthWest().distanceTo(me.getSouthWest())*me.getNorthEast().distanceTo(me.getNorthWest());ke<1700&&(re=Bi(e));var et=e.length,We=[];for(i=0;i<et;i++){var ct=fe(e[i]);We.push(s.project(fe([ct.lat-re.lat,ct.lng-re.lng])))}for(i=0,r=0;i<et-1;i++)r+=We[i].distanceTo(We[i+1])/2;if(r===0)U=We[0];else for(i=0,h=0;i<et-1;i++)if(_=We[i],T=We[i+1],l=_.distanceTo(T),h+=l,h>r){O=(h-r)/l,U=[T.x-O*(T.x-_.x),T.y-O*(T.y-_.y)];break}var tt=s.unproject(F(U));return fe([tt.lat+re.lat,tt.lng+re.lng])}var ka={__proto__:null,simplify:Pr,pointToSegmentDistance:Sr,closestPointOnSegment:_a,clipSegment:Er,_getEdgeIntersection:Hs,_getBitCode:zt,_sqClosestPointOnSegment:xs,isFlat:lt,_flat:Ar,polylineCenter:Mr},Vi={project:function(e){return new x(e.lng,e.lat)},unproject:function(e){return new ge(e.y,e.x)},bounds:new ee([-180,-90],[180,90])},Zi={R:6378137,R_MINOR:6356752314245179e-9,bounds:new ee([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(e){var s=Math.PI/180,i=this.R,r=e.lat*s,l=this.R_MINOR/i,h=Math.sqrt(1-l*l),_=h*Math.sin(r),T=Math.tan(Math.PI/4-r/2)/Math.pow((1-_)/(1+_),h/2);return r=-i*Math.log(Math.max(T,1e-10)),new x(e.lng*s*i,r)},unproject:function(e){for(var s=180/Math.PI,i=this.R,r=this.R_MINOR/i,l=Math.sqrt(1-r*r),h=Math.exp(-e.y/i),_=Math.PI/2-2*Math.atan(h),T=0,O=.1,U;T<15&&Math.abs(O)>1e-7;T++)U=l*Math.sin(_),U=Math.pow((1-U)/(1+U),l/2),O=Math.PI/2-2*Math.atan(h*U)-_,_+=O;return new ge(_*s,e.x*s/i)}},Ca={__proto__:null,LonLat:Vi,Mercator:Zi,SphericalMercator:ne},La=d({},Ue,{code:"EPSG:3395",projection:Zi,transformation:function(){var e=.5/(Math.PI*Zi.R);return he(e,.5,-e,.5)}()}),Dr=d({},Ue,{code:"EPSG:4326",projection:Vi,transformation:he(1/180,1,-1/180,.5)}),Pa=d({},Ve,{projection:Vi,transformation:he(1,0,-1,0),scale:function(e){return Math.pow(2,e)},zoom:function(e){return Math.log(e)/Math.LN2},distance:function(e,s){var i=s.lng-e.lng,r=s.lat-e.lat;return Math.sqrt(i*i+r*r)},infinite:!0});Ve.Earth=Ue,Ve.EPSG3395=La,Ve.EPSG3857=Le,Ve.EPSG900913=Re,Ve.EPSG4326=Dr,Ve.Simple=Pa;var ht=A.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(e){return e.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(e){return e&&e.removeLayer(this),this},getPane:function(e){return this._map.getPane(e?this.options[e]||e:this.options.pane)},addInteractiveTarget:function(e){return this._map._targets[f(e)]=this,this},removeInteractiveTarget:function(e){return delete this._map._targets[f(e)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(e){var s=e.target;if(s.hasLayer(this)){if(this._map=s,this._zoomAnimated=s._zoomAnimated,this.getEvents){var i=this.getEvents();s.on(i,this),this.once("remove",function(){s.off(i,this)},this)}this.onAdd(s),this.fire("add"),s.fire("layeradd",{layer:this})}}});Pe.include({addLayer:function(e){if(!e._layerAdd)throw new Error("The provided object is not a Layer.");var s=f(e);return this._layers[s]?this:(this._layers[s]=e,e._mapToAdd=this,e.beforeAdd&&e.beforeAdd(this),this.whenReady(e._layerAdd,e),this)},removeLayer:function(e){var s=f(e);return this._layers[s]?(this._loaded&&e.onRemove(this),delete this._layers[s],this._loaded&&(this.fire("layerremove",{layer:e}),e.fire("remove")),e._map=e._mapToAdd=null,this):this},hasLayer:function(e){return f(e)in this._layers},eachLayer:function(e,s){for(var i in this._layers)e.call(s,this._layers[i]);return this},_addLayers:function(e){e=e?$(e)?e:[e]:[];for(var s=0,i=e.length;s<i;s++)this.addLayer(e[s])},_addZoomLimit:function(e){(!isNaN(e.options.maxZoom)||!isNaN(e.options.minZoom))&&(this._zoomBoundLayers[f(e)]=e,this._updateZoomLevels())},_removeZoomLimit:function(e){var s=f(e);this._zoomBoundLayers[s]&&(delete this._zoomBoundLayers[s],this._updateZoomLevels())},_updateZoomLevels:function(){var e=1/0,s=-1/0,i=this._getZoomSpan();for(var r in this._zoomBoundLayers){var l=this._zoomBoundLayers[r].options;e=l.minZoom===void 0?e:Math.min(e,l.minZoom),s=l.maxZoom===void 0?s:Math.max(s,l.maxZoom)}this._layersMaxZoom=s===-1/0?void 0:s,this._layersMinZoom=e===1/0?void 0:e,i!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Wt=ht.extend({initialize:function(e,s){P(this,s),this._layers={};var i,r;if(e)for(i=0,r=e.length;i<r;i++)this.addLayer(e[i])},addLayer:function(e){var s=this.getLayerId(e);return this._layers[s]=e,this._map&&this._map.addLayer(e),this},removeLayer:function(e){var s=e in this._layers?e:this.getLayerId(e);return this._map&&this._layers[s]&&this._map.removeLayer(this._layers[s]),delete this._layers[s],this},hasLayer:function(e){var s=typeof e=="number"?e:this.getLayerId(e);return s in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(e){var s=Array.prototype.slice.call(arguments,1),i,r;for(i in this._layers)r=this._layers[i],r[e]&&r[e].apply(r,s);return this},onAdd:function(e){this.eachLayer(e.addLayer,e)},onRemove:function(e){this.eachLayer(e.removeLayer,e)},eachLayer:function(e,s){for(var i in this._layers)e.call(s,this._layers[i]);return this},getLayer:function(e){return this._layers[e]},getLayers:function(){var e=[];return this.eachLayer(e.push,e),e},setZIndex:function(e){return this.invoke("setZIndex",e)},getLayerId:function(e){return f(e)}}),Sa=function(e,s){return new Wt(e,s)},bt=Wt.extend({addLayer:function(e){return this.hasLayer(e)?this:(e.addEventParent(this),Wt.prototype.addLayer.call(this,e),this.fire("layeradd",{layer:e}))},removeLayer:function(e){return this.hasLayer(e)?(e in this._layers&&(e=this._layers[e]),e.removeEventParent(this),Wt.prototype.removeLayer.call(this,e),this.fire("layerremove",{layer:e})):this},setStyle:function(e){return this.invoke("setStyle",e)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var e=new ve;for(var s in this._layers){var i=this._layers[s];e.extend(i.getBounds?i.getBounds():i.getLatLng())}return e}}),Ta=function(e,s){return new bt(e,s)},qt=E.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(e){P(this,e)},createIcon:function(e){return this._createIcon("icon",e)},createShadow:function(e){return this._createIcon("shadow",e)},_createIcon:function(e,s){var i=this._getIconUrl(e);if(!i){if(e==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var r=this._createImg(i,s&&s.tagName==="IMG"?s:null);return this._setIconStyles(r,e),(this.options.crossOrigin||this.options.crossOrigin==="")&&(r.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),r},_setIconStyles:function(e,s){var i=this.options,r=i[s+"Size"];typeof r=="number"&&(r=[r,r]);var l=F(r),h=F(s==="shadow"&&i.shadowAnchor||i.iconAnchor||l&&l.divideBy(2,!0));e.className="leaflet-marker-"+s+" "+(i.className||""),h&&(e.style.marginLeft=-h.x+"px",e.style.marginTop=-h.y+"px"),l&&(e.style.width=l.x+"px",e.style.height=l.y+"px")},_createImg:function(e,s){return s=s||document.createElement("img"),s.src=e,s},_getIconUrl:function(e){return ae.retina&&this.options[e+"RetinaUrl"]||this.options[e+"Url"]}});function Ea(e){return new qt(e)}var ys=qt.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(e){return typeof ys.imagePath!="string"&&(ys.imagePath=this._detectIconPath()),(this.options.imagePath||ys.imagePath)+qt.prototype._getIconUrl.call(this,e)},_stripUrl:function(e){var s=function(i,r,l){var h=r.exec(i);return h&&h[l]};return e=s(e,/^url\((['"])?(.+)\1\)$/,2),e&&s(e,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var e=Se("div","leaflet-default-icon-path",document.body),s=us(e,"background-image")||us(e,"backgroundImage");if(document.body.removeChild(e),s=this._stripUrl(s),s)return s;var i=document.querySelector('link[href$="leaflet.css"]');return i?i.href.substring(0,i.href.length-11-1):""}}),Or=pt.extend({initialize:function(e){this._marker=e},addHooks:function(){var e=this._marker._icon;this._draggable||(this._draggable=new Lt(e,e,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),je(e,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Fe(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(e){var s=this._marker,i=s._map,r=this._marker.options.autoPanSpeed,l=this._marker.options.autoPanPadding,h=Ot(s._icon),_=i.getPixelBounds(),T=i.getPixelOrigin(),O=de(_.min._subtract(T).add(l),_.max._subtract(T).subtract(l));if(!O.contains(h)){var U=F((Math.max(O.max.x,h.x)-O.max.x)/(_.max.x-O.max.x)-(Math.min(O.min.x,h.x)-O.min.x)/(_.min.x-O.min.x),(Math.max(O.max.y,h.y)-O.max.y)/(_.max.y-O.max.y)-(Math.min(O.min.y,h.y)-O.min.y)/(_.min.y-O.min.y)).multiplyBy(r);i.panBy(U,{animate:!1}),this._draggable._newPos._add(U),this._draggable._startPos._add(U),Ze(s._icon,this._draggable._newPos),this._onDrag(e),this._panRequest=V(this._adjustPan.bind(this,e))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(e){this._marker.options.autoPan&&(J(this._panRequest),this._panRequest=V(this._adjustPan.bind(this,e)))},_onDrag:function(e){var s=this._marker,i=s._shadow,r=Ot(s._icon),l=s._map.layerPointToLatLng(r);i&&Ze(i,r),s._latlng=l,e.latlng=l,e.oldLatLng=this._oldLatLng,s.fire("move",e).fire("drag",e)},_onDragEnd:function(e){J(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",e)}}),$s=ht.extend({options:{icon:new ys,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(e,s){P(this,s),this._latlng=fe(e)},onAdd:function(e){this._zoomAnimated=this._zoomAnimated&&e.options.markerZoomAnimation,this._zoomAnimated&&e.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(e){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&e.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(e){var s=this._latlng;return this._latlng=fe(e),this.update(),this.fire("move",{oldLatLng:s,latlng:this._latlng})},setZIndexOffset:function(e){return this.options.zIndexOffset=e,this.update()},getIcon:function(){return this.options.icon},setIcon:function(e){return this.options.icon=e,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var e=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(e)}return this},_initIcon:function(){var e=this.options,s="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),i=e.icon.createIcon(this._icon),r=!1;i!==this._icon&&(this._icon&&this._removeIcon(),r=!0,e.title&&(i.title=e.title),i.tagName==="IMG"&&(i.alt=e.alt||"")),je(i,s),e.keyboard&&(i.tabIndex="0",i.setAttribute("role","button")),this._icon=i,e.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&_e(i,"focus",this._panOnFocus,this);var l=e.icon.createShadow(this._shadow),h=!1;l!==this._shadow&&(this._removeShadow(),h=!0),l&&(je(l,s),l.alt=""),this._shadow=l,e.opacity<1&&this._updateOpacity(),r&&this.getPane().appendChild(this._icon),this._initInteraction(),l&&h&&this.getPane(e.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Me(this._icon,"focus",this._panOnFocus,this),De(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&De(this._shadow),this._shadow=null},_setPos:function(e){this._icon&&Ze(this._icon,e),this._shadow&&Ze(this._shadow,e),this._zIndex=e.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(e){this._icon&&(this._icon.style.zIndex=this._zIndex+e)},_animateZoom:function(e){var s=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center).round();this._setPos(s)},_initInteraction:function(){if(this.options.interactive&&(je(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Or)){var e=this.options.draggable;this.dragging&&(e=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Or(this),e&&this.dragging.enable()}},setOpacity:function(e){return this.options.opacity=e,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var e=this.options.opacity;this._icon&&ot(this._icon,e),this._shadow&&ot(this._shadow,e)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var e=this._map;if(e){var s=this.options.icon.options,i=s.iconSize?F(s.iconSize):F(0,0),r=s.iconAnchor?F(s.iconAnchor):F(0,0);e.panInside(this._latlng,{paddingTopLeft:r,paddingBottomRight:i.subtract(r)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Aa(e,s){return new $s(e,s)}var Pt=ht.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(e){this._renderer=e.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(e){return P(this,e),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&e&&Object.prototype.hasOwnProperty.call(e,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Us=Pt.extend({options:{fill:!0,radius:10},initialize:function(e,s){P(this,s),this._latlng=fe(e),this._radius=this.options.radius},setLatLng:function(e){var s=this._latlng;return this._latlng=fe(e),this.redraw(),this.fire("move",{oldLatLng:s,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(e){return this.options.radius=this._radius=e,this.redraw()},getRadius:function(){return this._radius},setStyle:function(e){var s=e&&e.radius||this._radius;return Pt.prototype.setStyle.call(this,e),this.setRadius(s),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var e=this._radius,s=this._radiusY||e,i=this._clickTolerance(),r=[e+i,s+i];this._pxBounds=new ee(this._point.subtract(r),this._point.add(r))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(e){return e.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Ma(e,s){return new Us(e,s)}var Hi=Us.extend({initialize:function(e,s,i){if(typeof s=="number"&&(s=d({},i,{radius:s})),P(this,s),this._latlng=fe(e),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(e){return this._mRadius=e,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var e=[this._radius,this._radiusY||this._radius];return new ve(this._map.layerPointToLatLng(this._point.subtract(e)),this._map.layerPointToLatLng(this._point.add(e)))},setStyle:Pt.prototype.setStyle,_project:function(){var e=this._latlng.lng,s=this._latlng.lat,i=this._map,r=i.options.crs;if(r.distance===Ue.distance){var l=Math.PI/180,h=this._mRadius/Ue.R/l,_=i.project([s+h,e]),T=i.project([s-h,e]),O=_.add(T).divideBy(2),U=i.unproject(O).lat,re=Math.acos((Math.cos(h*l)-Math.sin(s*l)*Math.sin(U*l))/(Math.cos(s*l)*Math.cos(U*l)))/l;(isNaN(re)||re===0)&&(re=h/Math.cos(Math.PI/180*s)),this._point=O.subtract(i.getPixelOrigin()),this._radius=isNaN(re)?0:O.x-i.project([U,e-re]).x,this._radiusY=O.y-_.y}else{var me=r.unproject(r.project(this._latlng).subtract([this._mRadius,0]));this._point=i.latLngToLayerPoint(this._latlng),this._radius=this._point.x-i.latLngToLayerPoint(me).x}this._updateBounds()}});function Da(e,s,i){return new Hi(e,s,i)}var _t=Pt.extend({options:{smoothFactor:1,noClip:!1},initialize:function(e,s){P(this,s),this._setLatLngs(e)},getLatLngs:function(){return this._latlngs},setLatLngs:function(e){return this._setLatLngs(e),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(e){for(var s=1/0,i=null,r=xs,l,h,_=0,T=this._parts.length;_<T;_++)for(var O=this._parts[_],U=1,re=O.length;U<re;U++){l=O[U-1],h=O[U];var me=r(e,l,h,!0);me<s&&(s=me,i=r(e,l,h))}return i&&(i.distance=Math.sqrt(s)),i},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Mr(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(e,s){return s=s||this._defaultShape(),e=fe(e),s.push(e),this._bounds.extend(e),this.redraw()},_setLatLngs:function(e){this._bounds=new ve,this._latlngs=this._convertLatLngs(e)},_defaultShape:function(){return lt(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(e){for(var s=[],i=lt(e),r=0,l=e.length;r<l;r++)i?(s[r]=fe(e[r]),this._bounds.extend(s[r])):s[r]=this._convertLatLngs(e[r]);return s},_project:function(){var e=new ee;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,e),this._bounds.isValid()&&e.isValid()&&(this._rawPxBounds=e,this._updateBounds())},_updateBounds:function(){var e=this._clickTolerance(),s=new x(e,e);this._rawPxBounds&&(this._pxBounds=new ee([this._rawPxBounds.min.subtract(s),this._rawPxBounds.max.add(s)]))},_projectLatlngs:function(e,s,i){var r=e[0]instanceof ge,l=e.length,h,_;if(r){for(_=[],h=0;h<l;h++)_[h]=this._map.latLngToLayerPoint(e[h]),i.extend(_[h]);s.push(_)}else for(h=0;h<l;h++)this._projectLatlngs(e[h],s,i)},_clipPoints:function(){var e=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(e))){if(this.options.noClip){this._parts=this._rings;return}var s=this._parts,i,r,l,h,_,T,O;for(i=0,l=0,h=this._rings.length;i<h;i++)for(O=this._rings[i],r=0,_=O.length;r<_-1;r++)T=Er(O[r],O[r+1],e,r,!0),T&&(s[l]=s[l]||[],s[l].push(T[0]),(T[1]!==O[r+1]||r===_-2)&&(s[l].push(T[1]),l++))}},_simplifyPoints:function(){for(var e=this._parts,s=this.options.smoothFactor,i=0,r=e.length;i<r;i++)e[i]=Pr(e[i],s)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(e,s){var i,r,l,h,_,T,O=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(i=0,h=this._parts.length;i<h;i++)for(T=this._parts[i],r=0,_=T.length,l=_-1;r<_;l=r++)if(!(!s&&r===0)&&Sr(e,T[l],T[r])<=O)return!0;return!1}});function Oa(e,s){return new _t(e,s)}_t._flat=Ar;var Gt=_t.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Lr(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(e){var s=_t.prototype._convertLatLngs.call(this,e),i=s.length;return i>=2&&s[0]instanceof ge&&s[0].equals(s[i-1])&&s.pop(),s},_setLatLngs:function(e){_t.prototype._setLatLngs.call(this,e),lt(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return lt(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var e=this._renderer._bounds,s=this.options.weight,i=new x(s,s);if(e=new ee(e.min.subtract(i),e.max.add(i)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(e))){if(this.options.noClip){this._parts=this._rings;return}for(var r=0,l=this._rings.length,h;r<l;r++)h=Cr(this._rings[r],e,!0),h.length&&this._parts.push(h)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(e){var s=!1,i,r,l,h,_,T,O,U;if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(h=0,O=this._parts.length;h<O;h++)for(i=this._parts[h],_=0,U=i.length,T=U-1;_<U;T=_++)r=i[_],l=i[T],r.y>e.y!=l.y>e.y&&e.x<(l.x-r.x)*(e.y-r.y)/(l.y-r.y)+r.x&&(s=!s);return s||_t.prototype._containsPoint.call(this,e,!0)}});function Ra(e,s){return new Gt(e,s)}var wt=bt.extend({initialize:function(e,s){P(this,s),this._layers={},e&&this.addData(e)},addData:function(e){var s=$(e)?e:e.features,i,r,l;if(s){for(i=0,r=s.length;i<r;i++)l=s[i],(l.geometries||l.geometry||l.features||l.coordinates)&&this.addData(l);return this}var h=this.options;if(h.filter&&!h.filter(e))return this;var _=Ws(e,h);return _?(_.feature=Ks(e),_.defaultOptions=_.options,this.resetStyle(_),h.onEachFeature&&h.onEachFeature(e,_),this.addLayer(_)):this},resetStyle:function(e){return e===void 0?this.eachLayer(this.resetStyle,this):(e.options=d({},e.defaultOptions),this._setLayerStyle(e,this.options.style),this)},setStyle:function(e){return this.eachLayer(function(s){this._setLayerStyle(s,e)},this)},_setLayerStyle:function(e,s){e.setStyle&&(typeof s=="function"&&(s=s(e.feature)),e.setStyle(s))}});function Ws(e,s){var i=e.type==="Feature"?e.geometry:e,r=i?i.coordinates:null,l=[],h=s&&s.pointToLayer,_=s&&s.coordsToLatLng||$i,T,O,U,re;if(!r&&!i)return null;switch(i.type){case"Point":return T=_(r),Rr(h,e,T,s);case"MultiPoint":for(U=0,re=r.length;U<re;U++)T=_(r[U]),l.push(Rr(h,e,T,s));return new bt(l);case"LineString":case"MultiLineString":return O=qs(r,i.type==="LineString"?0:1,_),new _t(O,s);case"Polygon":case"MultiPolygon":return O=qs(r,i.type==="Polygon"?1:2,_),new Gt(O,s);case"GeometryCollection":for(U=0,re=i.geometries.length;U<re;U++){var me=Ws({geometry:i.geometries[U],type:"Feature",properties:e.properties},s);me&&l.push(me)}return new bt(l);case"FeatureCollection":for(U=0,re=i.features.length;U<re;U++){var ke=Ws(i.features[U],s);ke&&l.push(ke)}return new bt(l);default:throw new Error("Invalid GeoJSON object.")}}function Rr(e,s,i,r){return e?e(s,i):new $s(i,r&&r.markersInheritOptions&&r)}function $i(e){return new ge(e[1],e[0],e[2])}function qs(e,s,i){for(var r=[],l=0,h=e.length,_;l<h;l++)_=s?qs(e[l],s-1,i):(i||$i)(e[l]),r.push(_);return r}function Ui(e,s){return e=fe(e),e.alt!==void 0?[C(e.lng,s),C(e.lat,s),C(e.alt,s)]:[C(e.lng,s),C(e.lat,s)]}function Gs(e,s,i,r){for(var l=[],h=0,_=e.length;h<_;h++)l.push(s?Gs(e[h],lt(e[h])?0:s-1,i,r):Ui(e[h],r));return!s&&i&&l.length>0&&l.push(l[0].slice()),l}function Kt(e,s){return e.feature?d({},e.feature,{geometry:s}):Ks(s)}function Ks(e){return e.type==="Feature"||e.type==="FeatureCollection"?e:{type:"Feature",properties:{},geometry:e}}var Wi={toGeoJSON:function(e){return Kt(this,{type:"Point",coordinates:Ui(this.getLatLng(),e)})}};$s.include(Wi),Hi.include(Wi),Us.include(Wi),_t.include({toGeoJSON:function(e){var s=!lt(this._latlngs),i=Gs(this._latlngs,s?1:0,!1,e);return Kt(this,{type:(s?"Multi":"")+"LineString",coordinates:i})}}),Gt.include({toGeoJSON:function(e){var s=!lt(this._latlngs),i=s&&!lt(this._latlngs[0]),r=Gs(this._latlngs,i?2:s?1:0,!0,e);return s||(r=[r]),Kt(this,{type:(i?"Multi":"")+"Polygon",coordinates:r})}}),Wt.include({toMultiPoint:function(e){var s=[];return this.eachLayer(function(i){s.push(i.toGeoJSON(e).geometry.coordinates)}),Kt(this,{type:"MultiPoint",coordinates:s})},toGeoJSON:function(e){var s=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(s==="MultiPoint")return this.toMultiPoint(e);var i=s==="GeometryCollection",r=[];return this.eachLayer(function(l){if(l.toGeoJSON){var h=l.toGeoJSON(e);if(i)r.push(h.geometry);else{var _=Ks(h);_.type==="FeatureCollection"?r.push.apply(r,_.features):r.push(_)}}}),i?Kt(this,{geometries:r,type:"GeometryCollection"}):{type:"FeatureCollection",features:r}}});function Ir(e,s){return new wt(e,s)}var Ia=Ir,Js=ht.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(e,s,i){this._url=e,this._bounds=be(s),P(this,i)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(je(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){De(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(e){return this.options.opacity=e,this._image&&this._updateOpacity(),this},setStyle:function(e){return e.opacity&&this.setOpacity(e.opacity),this},bringToFront:function(){return this._map&&$t(this._image),this},bringToBack:function(){return this._map&&Ut(this._image),this},setUrl:function(e){return this._url=e,this._image&&(this._image.src=e),this},setBounds:function(e){return this._bounds=be(e),this._map&&this._reset(),this},getEvents:function(){var e={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var e=this._url.tagName==="IMG",s=this._image=e?this._url:Se("img");if(je(s,"leaflet-image-layer"),this._zoomAnimated&&je(s,"leaflet-zoom-animated"),this.options.className&&je(s,this.options.className),s.onselectstart=N,s.onmousemove=N,s.onload=u(this.fire,this,"load"),s.onerror=u(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(s.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),e){this._url=s.src;return}s.src=this._url,s.alt=this.options.alt},_animateZoom:function(e){var s=this._map.getZoomScale(e.zoom),i=this._map._latLngBoundsToNewLayerBounds(this._bounds,e.zoom,e.center).min;Dt(this._image,i,s)},_reset:function(){var e=this._image,s=new ee(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),i=s.getSize();Ze(e,s.min),e.style.width=i.x+"px",e.style.height=i.y+"px"},_updateOpacity:function(){ot(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var e=this.options.errorOverlayUrl;e&&this._url!==e&&(this._url=e,this._image.src=e)},getCenter:function(){return this._bounds.getCenter()}}),za=function(e,s,i){return new Js(e,s,i)},zr=Js.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var e=this._url.tagName==="VIDEO",s=this._image=e?this._url:Se("video");if(je(s,"leaflet-image-layer"),this._zoomAnimated&&je(s,"leaflet-zoom-animated"),this.options.className&&je(s,this.options.className),s.onselectstart=N,s.onmousemove=N,s.onloadeddata=u(this.fire,this,"load"),e){for(var i=s.getElementsByTagName("source"),r=[],l=0;l<i.length;l++)r.push(i[l].src);this._url=i.length>0?r:[s.src];return}$(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(s.style,"objectFit")&&(s.style.objectFit="fill"),s.autoplay=!!this.options.autoplay,s.loop=!!this.options.loop,s.muted=!!this.options.muted,s.playsInline=!!this.options.playsInline;for(var h=0;h<this._url.length;h++){var _=Se("source");_.src=this._url[h],s.appendChild(_)}}});function Ba(e,s,i){return new zr(e,s,i)}var Br=Js.extend({_initImage:function(){var e=this._image=this._url;je(e,"leaflet-image-layer"),this._zoomAnimated&&je(e,"leaflet-zoom-animated"),this.options.className&&je(e,this.options.className),e.onselectstart=N,e.onmousemove=N}});function Fa(e,s,i){return new Br(e,s,i)}var gt=ht.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(e,s){e&&(e instanceof ge||$(e))?(this._latlng=fe(e),P(this,s)):(P(this,e),this._source=s),this.options.content&&(this._content=this.options.content)},openOn:function(e){return e=arguments.length?e:this._source._map,e.hasLayer(this)||e.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(e){return this._map?this.close():(arguments.length?this._source=e:e=this._source,this._prepareOpen(),this.openOn(e._map)),this},onAdd:function(e){this._zoomAnimated=e._zoomAnimated,this._container||this._initLayout(),e._fadeAnimated&&ot(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),e._fadeAnimated&&ot(this._container,1),this.bringToFront(),this.options.interactive&&(je(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(e){e._fadeAnimated?(ot(this._container,0),this._removeTimeout=setTimeout(u(De,void 0,this._container),200)):De(this._container),this.options.interactive&&(Fe(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(e){return this._latlng=fe(e),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(e){return this._content=e,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var e={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&$t(this._container),this},bringToBack:function(){return this._map&&Ut(this._container),this},_prepareOpen:function(e){var s=this._source;if(!s._map)return!1;if(s instanceof bt){s=null;var i=this._source._layers;for(var r in i)if(i[r]._map){s=i[r];break}if(!s)return!1;this._source=s}if(!e)if(s.getCenter)e=s.getCenter();else if(s.getLatLng)e=s.getLatLng();else if(s.getBounds)e=s.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(e),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var e=this._contentNode,s=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof s=="string")e.innerHTML=s;else{for(;e.hasChildNodes();)e.removeChild(e.firstChild);e.appendChild(s)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var e=this._map.latLngToLayerPoint(this._latlng),s=F(this.options.offset),i=this._getAnchor();this._zoomAnimated?Ze(this._container,e.add(i)):s=s.add(e).add(i);var r=this._containerBottom=-s.y,l=this._containerLeft=-Math.round(this._containerWidth/2)+s.x;this._container.style.bottom=r+"px",this._container.style.left=l+"px"}},_getAnchor:function(){return[0,0]}});Pe.include({_initOverlay:function(e,s,i,r){var l=s;return l instanceof e||(l=new e(r).setContent(s)),i&&l.setLatLng(i),l}}),ht.include({_initOverlay:function(e,s,i,r){var l=i;return l instanceof e?(P(l,r),l._source=this):(l=s&&!r?s:new e(r,this),l.setContent(i)),l}});var Ys=gt.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(e){return e=arguments.length?e:this._source._map,!e.hasLayer(this)&&e._popup&&e._popup.options.autoClose&&e.removeLayer(e._popup),e._popup=this,gt.prototype.openOn.call(this,e)},onAdd:function(e){gt.prototype.onAdd.call(this,e),e.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Pt||this._source.on("preclick",Rt))},onRemove:function(e){gt.prototype.onRemove.call(this,e),e.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Pt||this._source.off("preclick",Rt))},getEvents:function(){var e=gt.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(e.preclick=this.close),this.options.keepInView&&(e.moveend=this._adjustPan),e},_initLayout:function(){var e="leaflet-popup",s=this._container=Se("div",e+" "+(this.options.className||"")+" leaflet-zoom-animated"),i=this._wrapper=Se("div",e+"-content-wrapper",s);if(this._contentNode=Se("div",e+"-content",i),ps(s),Oi(this._contentNode),_e(s,"contextmenu",Rt),this._tipContainer=Se("div",e+"-tip-container",s),this._tip=Se("div",e+"-tip",this._tipContainer),this.options.closeButton){var r=this._closeButton=Se("a",e+"-close-button",s);r.setAttribute("role","button"),r.setAttribute("aria-label","Close popup"),r.href="#close",r.innerHTML='<span aria-hidden="true">&#215;</span>',_e(r,"click",function(l){Ke(l),this.close()},this)}},_updateLayout:function(){var e=this._contentNode,s=e.style;s.width="",s.whiteSpace="nowrap";var i=e.offsetWidth;i=Math.min(i,this.options.maxWidth),i=Math.max(i,this.options.minWidth),s.width=i+1+"px",s.whiteSpace="",s.height="";var r=e.offsetHeight,l=this.options.maxHeight,h="leaflet-popup-scrolled";l&&r>l?(s.height=l+"px",je(e,h)):Fe(e,h),this._containerWidth=this._container.offsetWidth},_animateZoom:function(e){var s=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center),i=this._getAnchor();Ze(this._container,s.add(i))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var e=this._map,s=parseInt(us(this._container,"marginBottom"),10)||0,i=this._container.offsetHeight+s,r=this._containerWidth,l=new x(this._containerLeft,-i-this._containerBottom);l._add(Ot(this._container));var h=e.layerPointToContainerPoint(l),_=F(this.options.autoPanPadding),T=F(this.options.autoPanPaddingTopLeft||_),O=F(this.options.autoPanPaddingBottomRight||_),U=e.getSize(),re=0,me=0;h.x+r+O.x>U.x&&(re=h.x+r-U.x+O.x),h.x-re-T.x<0&&(re=h.x-T.x),h.y+i+O.y>U.y&&(me=h.y+i-U.y+O.y),h.y-me-T.y<0&&(me=h.y-T.y),(re||me)&&(this.options.keepInView&&(this._autopanning=!0),e.fire("autopanstart").panBy([re,me]))}},_getAnchor:function(){return F(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Va=function(e,s){return new Ys(e,s)};Pe.mergeOptions({closePopupOnClick:!0}),Pe.include({openPopup:function(e,s,i){return this._initOverlay(Ys,e,s,i).openOn(this),this},closePopup:function(e){return e=arguments.length?e:this._popup,e&&e.close(),this}}),ht.include({bindPopup:function(e,s){return this._popup=this._initOverlay(Ys,this._popup,e,s),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(e){return this._popup&&(this instanceof bt||(this._popup._source=this),this._popup._prepareOpen(e||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(e){return this._popup&&this._popup.setContent(e),this},getPopup:function(){return this._popup},_openPopup:function(e){if(!(!this._popup||!this._map)){It(e);var s=e.layer||e.target;if(this._popup._source===s&&!(s instanceof Pt)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(e.latlng);return}this._popup._source=s,this.openPopup(e.latlng)}},_movePopup:function(e){this._popup.setLatLng(e.latlng)},_onKeyPress:function(e){e.originalEvent.keyCode===13&&this._openPopup(e)}});var Xs=gt.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(e){gt.prototype.onAdd.call(this,e),this.setOpacity(this.options.opacity),e.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(e){gt.prototype.onRemove.call(this,e),e.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var e=gt.prototype.getEvents.call(this);return this.options.permanent||(e.preclick=this.close),e},_initLayout:function(){var e="leaflet-tooltip",s=e+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Se("div",s),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+f(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(e){var s,i,r=this._map,l=this._container,h=r.latLngToContainerPoint(r.getCenter()),_=r.layerPointToContainerPoint(e),T=this.options.direction,O=l.offsetWidth,U=l.offsetHeight,re=F(this.options.offset),me=this._getAnchor();T==="top"?(s=O/2,i=U):T==="bottom"?(s=O/2,i=0):T==="center"?(s=O/2,i=U/2):T==="right"?(s=0,i=U/2):T==="left"?(s=O,i=U/2):_.x<h.x?(T="right",s=0,i=U/2):(T="left",s=O+(re.x+me.x)*2,i=U/2),e=e.subtract(F(s,i,!0)).add(re).add(me),Fe(l,"leaflet-tooltip-right"),Fe(l,"leaflet-tooltip-left"),Fe(l,"leaflet-tooltip-top"),Fe(l,"leaflet-tooltip-bottom"),je(l,"leaflet-tooltip-"+T),Ze(l,e)},_updatePosition:function(){var e=this._map.latLngToLayerPoint(this._latlng);this._setPosition(e)},setOpacity:function(e){this.options.opacity=e,this._container&&ot(this._container,e)},_animateZoom:function(e){var s=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center);this._setPosition(s)},_getAnchor:function(){return F(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Za=function(e,s){return new Xs(e,s)};Pe.include({openTooltip:function(e,s,i){return this._initOverlay(Xs,e,s,i).openOn(this),this},closeTooltip:function(e){return e.close(),this}}),ht.include({bindTooltip:function(e,s){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Xs,this._tooltip,e,s),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(e){if(!(!e&&this._tooltipHandlersAdded)){var s=e?"off":"on",i={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?i.add=this._openTooltip:(i.mouseover=this._openTooltip,i.mouseout=this.closeTooltip,i.click=this._openTooltip,this._map?this._addFocusListeners():i.add=this._addFocusListeners),this._tooltip.options.sticky&&(i.mousemove=this._moveTooltip),this[s](i),this._tooltipHandlersAdded=!e}},openTooltip:function(e){return this._tooltip&&(this instanceof bt||(this._tooltip._source=this),this._tooltip._prepareOpen(e)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(e){return this._tooltip&&this._tooltip.setContent(e),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(e){var s=typeof e.getElement=="function"&&e.getElement();s&&(_e(s,"focus",function(){this._tooltip._source=e,this.openTooltip()},this),_e(s,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(e){var s=typeof e.getElement=="function"&&e.getElement();s&&s.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(e){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var s=this;this._map.once("moveend",function(){s._openOnceFlag=!1,s._openTooltip(e)});return}this._tooltip._source=e.layer||e.target,this.openTooltip(this._tooltip.options.sticky?e.latlng:void 0)}},_moveTooltip:function(e){var s=e.latlng,i,r;this._tooltip.options.sticky&&e.originalEvent&&(i=this._map.mouseEventToContainerPoint(e.originalEvent),r=this._map.containerPointToLayerPoint(i),s=this._map.layerPointToLatLng(r)),this._tooltip.setLatLng(s)}});var Fr=qt.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(e){var s=e&&e.tagName==="DIV"?e:document.createElement("div"),i=this.options;if(i.html instanceof Element?(zs(s),s.appendChild(i.html)):s.innerHTML=i.html!==!1?i.html:"",i.bgPos){var r=F(i.bgPos);s.style.backgroundPosition=-r.x+"px "+-r.y+"px"}return this._setIconStyles(s,"icon"),s},createShadow:function(){return null}});function Ha(e){return new Fr(e)}qt.Default=ys;var vs=ht.extend({options:{tileSize:256,opacity:1,updateWhenIdle:ae.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(e){P(this,e)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(e){e._addZoomLimit(this)},onRemove:function(e){this._removeAllTiles(),De(this._container),e._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&($t(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Ut(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(e){return this.options.opacity=e,this._updateOpacity(),this},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var e=this._clampZoom(this._map.getZoom());e!==this._tileZoom&&(this._tileZoom=e,this._updateLevels()),this._update()}return this},getEvents:function(){var e={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=y(this._onMoveEnd,this.options.updateInterval,this)),e.move=this._onMove),this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},createTile:function(){return document.createElement("div")},getTileSize:function(){var e=this.options.tileSize;return e instanceof x?e:new x(e,e)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(e){for(var s=this.getPane().children,i=-e(-1/0,1/0),r=0,l=s.length,h;r<l;r++)h=s[r].style.zIndex,s[r]!==this._container&&h&&(i=e(i,+h));isFinite(i)&&(this.options.zIndex=i+e(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!ae.ielt9){ot(this._container,this.options.opacity);var e=+new Date,s=!1,i=!1;for(var r in this._tiles){var l=this._tiles[r];if(!(!l.current||!l.loaded)){var h=Math.min(1,(e-l.loaded)/200);ot(l.el,h),h<1?s=!0:(l.active?i=!0:this._onOpaqueTile(l),l.active=!0)}}i&&!this._noPrune&&this._pruneTiles(),s&&(J(this._fadeFrame),this._fadeFrame=V(this._updateOpacity,this))}},_onOpaqueTile:N,_initContainer:function(){this._container||(this._container=Se("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var e=this._tileZoom,s=this.options.maxZoom;if(e!==void 0){for(var i in this._levels)i=Number(i),this._levels[i].el.children.length||i===e?(this._levels[i].el.style.zIndex=s-Math.abs(e-i),this._onUpdateLevel(i)):(De(this._levels[i].el),this._removeTilesAtZoom(i),this._onRemoveLevel(i),delete this._levels[i]);var r=this._levels[e],l=this._map;return r||(r=this._levels[e]={},r.el=Se("div","leaflet-tile-container leaflet-zoom-animated",this._container),r.el.style.zIndex=s,r.origin=l.project(l.unproject(l.getPixelOrigin()),e).round(),r.zoom=e,this._setZoomTransform(r,l.getCenter(),l.getZoom()),N(r.el.offsetWidth),this._onCreateLevel(r)),this._level=r,r}},_onUpdateLevel:N,_onRemoveLevel:N,_onCreateLevel:N,_pruneTiles:function(){if(this._map){var e,s,i=this._map.getZoom();if(i>this.options.maxZoom||i<this.options.minZoom){this._removeAllTiles();return}for(e in this._tiles)s=this._tiles[e],s.retain=s.current;for(e in this._tiles)if(s=this._tiles[e],s.current&&!s.active){var r=s.coords;this._retainParent(r.x,r.y,r.z,r.z-5)||this._retainChildren(r.x,r.y,r.z,r.z+2)}for(e in this._tiles)this._tiles[e].retain||this._removeTile(e)}},_removeTilesAtZoom:function(e){for(var s in this._tiles)this._tiles[s].coords.z===e&&this._removeTile(s)},_removeAllTiles:function(){for(var e in this._tiles)this._removeTile(e)},_invalidateAll:function(){for(var e in this._levels)De(this._levels[e].el),this._onRemoveLevel(Number(e)),delete this._levels[e];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(e,s,i,r){var l=Math.floor(e/2),h=Math.floor(s/2),_=i-1,T=new x(+l,+h);T.z=+_;var O=this._tileCoordsToKey(T),U=this._tiles[O];return U&&U.active?(U.retain=!0,!0):(U&&U.loaded&&(U.retain=!0),_>r?this._retainParent(l,h,_,r):!1)},_retainChildren:function(e,s,i,r){for(var l=2*e;l<2*e+2;l++)for(var h=2*s;h<2*s+2;h++){var _=new x(l,h);_.z=i+1;var T=this._tileCoordsToKey(_),O=this._tiles[T];if(O&&O.active){O.retain=!0;continue}else O&&O.loaded&&(O.retain=!0);i+1<r&&this._retainChildren(l,h,i+1,r)}},_resetView:function(e){var s=e&&(e.pinch||e.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),s,s)},_animateZoom:function(e){this._setView(e.center,e.zoom,!0,e.noUpdate)},_clampZoom:function(e){var s=this.options;return s.minNativeZoom!==void 0&&e<s.minNativeZoom?s.minNativeZoom:s.maxNativeZoom!==void 0&&s.maxNativeZoom<e?s.maxNativeZoom:e},_setView:function(e,s,i,r){var l=Math.round(s);this.options.maxZoom!==void 0&&l>this.options.maxZoom||this.options.minZoom!==void 0&&l<this.options.minZoom?l=void 0:l=this._clampZoom(l);var h=this.options.updateWhenZooming&&l!==this._tileZoom;(!r||h)&&(this._tileZoom=l,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),l!==void 0&&this._update(e),i||this._pruneTiles(),this._noPrune=!!i),this._setZoomTransforms(e,s)},_setZoomTransforms:function(e,s){for(var i in this._levels)this._setZoomTransform(this._levels[i],e,s)},_setZoomTransform:function(e,s,i){var r=this._map.getZoomScale(i,e.zoom),l=e.origin.multiplyBy(r).subtract(this._map._getNewPixelOrigin(s,i)).round();ae.any3d?Dt(e.el,l,r):Ze(e.el,l)},_resetGrid:function(){var e=this._map,s=e.options.crs,i=this._tileSize=this.getTileSize(),r=this._tileZoom,l=this._map.getPixelWorldBounds(this._tileZoom);l&&(this._globalTileRange=this._pxBoundsToTileRange(l)),this._wrapX=s.wrapLng&&!this.options.noWrap&&[Math.floor(e.project([0,s.wrapLng[0]],r).x/i.x),Math.ceil(e.project([0,s.wrapLng[1]],r).x/i.y)],this._wrapY=s.wrapLat&&!this.options.noWrap&&[Math.floor(e.project([s.wrapLat[0],0],r).y/i.x),Math.ceil(e.project([s.wrapLat[1],0],r).y/i.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(e){var s=this._map,i=s._animatingZoom?Math.max(s._animateToZoom,s.getZoom()):s.getZoom(),r=s.getZoomScale(i,this._tileZoom),l=s.project(e,this._tileZoom).floor(),h=s.getSize().divideBy(r*2);return new ee(l.subtract(h),l.add(h))},_update:function(e){var s=this._map;if(s){var i=this._clampZoom(s.getZoom());if(e===void 0&&(e=s.getCenter()),this._tileZoom!==void 0){var r=this._getTiledPixelBounds(e),l=this._pxBoundsToTileRange(r),h=l.getCenter(),_=[],T=this.options.keepBuffer,O=new ee(l.getBottomLeft().subtract([T,-T]),l.getTopRight().add([T,-T]));if(!(isFinite(l.min.x)&&isFinite(l.min.y)&&isFinite(l.max.x)&&isFinite(l.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var U in this._tiles){var re=this._tiles[U].coords;(re.z!==this._tileZoom||!O.contains(new x(re.x,re.y)))&&(this._tiles[U].current=!1)}if(Math.abs(i-this._tileZoom)>1){this._setView(e,i);return}for(var me=l.min.y;me<=l.max.y;me++)for(var ke=l.min.x;ke<=l.max.x;ke++){var et=new x(ke,me);if(et.z=this._tileZoom,!!this._isValidTile(et)){var We=this._tiles[this._tileCoordsToKey(et)];We?We.current=!0:_.push(et)}}if(_.sort(function(tt,Yt){return tt.distanceTo(h)-Yt.distanceTo(h)}),_.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var ct=document.createDocumentFragment();for(ke=0;ke<_.length;ke++)this._addTile(_[ke],ct);this._level.el.appendChild(ct)}}}},_isValidTile:function(e){var s=this._map.options.crs;if(!s.infinite){var i=this._globalTileRange;if(!s.wrapLng&&(e.x<i.min.x||e.x>i.max.x)||!s.wrapLat&&(e.y<i.min.y||e.y>i.max.y))return!1}if(!this.options.bounds)return!0;var r=this._tileCoordsToBounds(e);return be(this.options.bounds).overlaps(r)},_keyToBounds:function(e){return this._tileCoordsToBounds(this._keyToTileCoords(e))},_tileCoordsToNwSe:function(e){var s=this._map,i=this.getTileSize(),r=e.scaleBy(i),l=r.add(i),h=s.unproject(r,e.z),_=s.unproject(l,e.z);return[h,_]},_tileCoordsToBounds:function(e){var s=this._tileCoordsToNwSe(e),i=new ve(s[0],s[1]);return this.options.noWrap||(i=this._map.wrapLatLngBounds(i)),i},_tileCoordsToKey:function(e){return e.x+":"+e.y+":"+e.z},_keyToTileCoords:function(e){var s=e.split(":"),i=new x(+s[0],+s[1]);return i.z=+s[2],i},_removeTile:function(e){var s=this._tiles[e];s&&(De(s.el),delete this._tiles[e],this.fire("tileunload",{tile:s.el,coords:this._keyToTileCoords(e)}))},_initTile:function(e){je(e,"leaflet-tile");var s=this.getTileSize();e.style.width=s.x+"px",e.style.height=s.y+"px",e.onselectstart=N,e.onmousemove=N,ae.ielt9&&this.options.opacity<1&&ot(e,this.options.opacity)},_addTile:function(e,s){var i=this._getTilePos(e),r=this._tileCoordsToKey(e),l=this.createTile(this._wrapCoords(e),u(this._tileReady,this,e));this._initTile(l),this.createTile.length<2&&V(u(this._tileReady,this,e,null,l)),Ze(l,i),this._tiles[r]={el:l,coords:e,current:!0},s.appendChild(l),this.fire("tileloadstart",{tile:l,coords:e})},_tileReady:function(e,s,i){s&&this.fire("tileerror",{error:s,tile:i,coords:e});var r=this._tileCoordsToKey(e);i=this._tiles[r],i&&(i.loaded=+new Date,this._map._fadeAnimated?(ot(i.el,0),J(this._fadeFrame),this._fadeFrame=V(this._updateOpacity,this)):(i.active=!0,this._pruneTiles()),s||(je(i.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:i.el,coords:e})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),ae.ielt9||!this._map._fadeAnimated?V(this._pruneTiles,this):setTimeout(u(this._pruneTiles,this),250)))},_getTilePos:function(e){return e.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(e){var s=new x(this._wrapX?g(e.x,this._wrapX):e.x,this._wrapY?g(e.y,this._wrapY):e.y);return s.z=e.z,s},_pxBoundsToTileRange:function(e){var s=this.getTileSize();return new ee(e.min.unscaleBy(s).floor(),e.max.unscaleBy(s).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var e in this._tiles)if(!this._tiles[e].loaded)return!1;return!0}});function $a(e){return new vs(e)}var Jt=vs.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(e,s){this._url=e,s=P(this,s),s.detectRetina&&ae.retina&&s.maxZoom>0?(s.tileSize=Math.floor(s.tileSize/2),s.zoomReverse?(s.zoomOffset--,s.minZoom=Math.min(s.maxZoom,s.minZoom+1)):(s.zoomOffset++,s.maxZoom=Math.max(s.minZoom,s.maxZoom-1)),s.minZoom=Math.max(0,s.minZoom)):s.zoomReverse?s.minZoom=Math.min(s.maxZoom,s.minZoom):s.maxZoom=Math.max(s.minZoom,s.maxZoom),typeof s.subdomains=="string"&&(s.subdomains=s.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(e,s){return this._url===e&&s===void 0&&(s=!0),this._url=e,s||this.redraw(),this},createTile:function(e,s){var i=document.createElement("img");return _e(i,"load",u(this._tileOnLoad,this,s,i)),_e(i,"error",u(this._tileOnError,this,s,i)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(i.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(i.referrerPolicy=this.options.referrerPolicy),i.alt="",i.src=this.getTileUrl(e),i},getTileUrl:function(e){var s={r:ae.retina?"@2x":"",s:this._getSubdomain(e),x:e.x,y:e.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var i=this._globalTileRange.max.y-e.y;this.options.tms&&(s.y=i),s["-y"]=i}return K(this._url,d(s,this.options))},_tileOnLoad:function(e,s){ae.ielt9?setTimeout(u(e,this,null,s),0):e(null,s)},_tileOnError:function(e,s,i){var r=this.options.errorTileUrl;r&&s.getAttribute("src")!==r&&(s.src=r),e(i,s)},_onTileRemove:function(e){e.tile.onload=null},_getZoomForUrl:function(){var e=this._tileZoom,s=this.options.maxZoom,i=this.options.zoomReverse,r=this.options.zoomOffset;return i&&(e=s-e),e+r},_getSubdomain:function(e){var s=Math.abs(e.x+e.y)%this.options.subdomains.length;return this.options.subdomains[s]},_abortLoading:function(){var e,s;for(e in this._tiles)if(this._tiles[e].coords.z!==this._tileZoom&&(s=this._tiles[e].el,s.onload=N,s.onerror=N,!s.complete)){s.src=G;var i=this._tiles[e].coords;De(s),delete this._tiles[e],this.fire("tileabort",{tile:s,coords:i})}},_removeTile:function(e){var s=this._tiles[e];if(s)return s.el.setAttribute("src",G),vs.prototype._removeTile.call(this,e)},_tileReady:function(e,s,i){if(!(!this._map||i&&i.getAttribute("src")===G))return vs.prototype._tileReady.call(this,e,s,i)}});function Vr(e,s){return new Jt(e,s)}var Zr=Jt.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(e,s){this._url=e;var i=d({},this.defaultWmsParams);for(var r in s)r in this.options||(i[r]=s[r]);s=P(this,s);var l=s.detectRetina&&ae.retina?2:1,h=this.getTileSize();i.width=h.x*l,i.height=h.y*l,this.wmsParams=i},onAdd:function(e){this._crs=this.options.crs||e.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var s=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[s]=this._crs.code,Jt.prototype.onAdd.call(this,e)},getTileUrl:function(e){var s=this._tileCoordsToNwSe(e),i=this._crs,r=de(i.project(s[0]),i.project(s[1])),l=r.min,h=r.max,_=(this._wmsVersion>=1.3&&this._crs===Dr?[l.y,l.x,h.y,h.x]:[l.x,l.y,h.x,h.y]).join(","),T=Jt.prototype.getTileUrl.call(this,e);return T+M(this.wmsParams,T,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+_},setParams:function(e,s){return d(this.wmsParams,e),s||this.redraw(),this}});function Ua(e,s){return new Zr(e,s)}Jt.WMS=Zr,Vr.wms=Ua;var jt=ht.extend({options:{padding:.1},initialize:function(e){P(this,e),f(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),je(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var e={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(e.zoomanim=this._onAnimZoom),e},_onAnimZoom:function(e){this._updateTransform(e.center,e.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(e,s){var i=this._map.getZoomScale(s,this._zoom),r=this._map.getSize().multiplyBy(.5+this.options.padding),l=this._map.project(this._center,s),h=r.multiplyBy(-i).add(l).subtract(this._map._getNewPixelOrigin(e,s));ae.any3d?Dt(this._container,h,i):Ze(this._container,h)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var e in this._layers)this._layers[e]._reset()},_onZoomEnd:function(){for(var e in this._layers)this._layers[e]._project()},_updatePaths:function(){for(var e in this._layers)this._layers[e]._update()},_update:function(){var e=this.options.padding,s=this._map.getSize(),i=this._map.containerPointToLayerPoint(s.multiplyBy(-e)).round();this._bounds=new ee(i,i.add(s.multiplyBy(1+e*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Hr=jt.extend({options:{tolerance:0},getEvents:function(){var e=jt.prototype.getEvents.call(this);return e.viewprereset=this._onViewPreReset,e},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){jt.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var e=this._container=document.createElement("canvas");_e(e,"mousemove",this._onMouseMove,this),_e(e,"click dblclick mousedown mouseup contextmenu",this._onClick,this),_e(e,"mouseout",this._handleMouseOut,this),e._leaflet_disable_events=!0,this._ctx=e.getContext("2d")},_destroyContainer:function(){J(this._redrawRequest),delete this._ctx,De(this._container),Me(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var e;this._redrawBounds=null;for(var s in this._layers)e=this._layers[s],e._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){jt.prototype._update.call(this);var e=this._bounds,s=this._container,i=e.getSize(),r=ae.retina?2:1;Ze(s,e.min),s.width=r*i.x,s.height=r*i.y,s.style.width=i.x+"px",s.style.height=i.y+"px",ae.retina&&this._ctx.scale(2,2),this._ctx.translate(-e.min.x,-e.min.y),this.fire("update")}},_reset:function(){jt.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(e){this._updateDashArray(e),this._layers[f(e)]=e;var s=e._order={layer:e,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=s),this._drawLast=s,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(e){this._requestRedraw(e)},_removePath:function(e){var s=e._order,i=s.next,r=s.prev;i?i.prev=r:this._drawLast=r,r?r.next=i:this._drawFirst=i,delete e._order,delete this._layers[f(e)],this._requestRedraw(e)},_updatePath:function(e){this._extendRedrawBounds(e),e._project(),e._update(),this._requestRedraw(e)},_updateStyle:function(e){this._updateDashArray(e),this._requestRedraw(e)},_updateDashArray:function(e){if(typeof e.options.dashArray=="string"){var s=e.options.dashArray.split(/[, ]+/),i=[],r,l;for(l=0;l<s.length;l++){if(r=Number(s[l]),isNaN(r))return;i.push(r)}e.options._dashArray=i}else e.options._dashArray=e.options.dashArray},_requestRedraw:function(e){this._map&&(this._extendRedrawBounds(e),this._redrawRequest=this._redrawRequest||V(this._redraw,this))},_extendRedrawBounds:function(e){if(e._pxBounds){var s=(e.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new ee,this._redrawBounds.extend(e._pxBounds.min.subtract([s,s])),this._redrawBounds.extend(e._pxBounds.max.add([s,s]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var e=this._redrawBounds;if(e){var s=e.getSize();this._ctx.clearRect(e.min.x,e.min.y,s.x,s.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var e,s=this._redrawBounds;if(this._ctx.save(),s){var i=s.getSize();this._ctx.beginPath(),this._ctx.rect(s.min.x,s.min.y,i.x,i.y),this._ctx.clip()}this._drawing=!0;for(var r=this._drawFirst;r;r=r.next)e=r.layer,(!s||e._pxBounds&&e._pxBounds.intersects(s))&&e._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(e,s){if(this._drawing){var i,r,l,h,_=e._parts,T=_.length,O=this._ctx;if(T){for(O.beginPath(),i=0;i<T;i++){for(r=0,l=_[i].length;r<l;r++)h=_[i][r],O[r?"lineTo":"moveTo"](h.x,h.y);s&&O.closePath()}this._fillStroke(O,e)}}},_updateCircle:function(e){if(!(!this._drawing||e._empty())){var s=e._point,i=this._ctx,r=Math.max(Math.round(e._radius),1),l=(Math.max(Math.round(e._radiusY),1)||r)/r;l!==1&&(i.save(),i.scale(1,l)),i.beginPath(),i.arc(s.x,s.y/l,r,0,Math.PI*2,!1),l!==1&&i.restore(),this._fillStroke(i,e)}},_fillStroke:function(e,s){var i=s.options;i.fill&&(e.globalAlpha=i.fillOpacity,e.fillStyle=i.fillColor||i.color,e.fill(i.fillRule||"evenodd")),i.stroke&&i.weight!==0&&(e.setLineDash&&e.setLineDash(s.options&&s.options._dashArray||[]),e.globalAlpha=i.opacity,e.lineWidth=i.weight,e.strokeStyle=i.color,e.lineCap=i.lineCap,e.lineJoin=i.lineJoin,e.stroke())},_onClick:function(e){for(var s=this._map.mouseEventToLayerPoint(e),i,r,l=this._drawFirst;l;l=l.next)i=l.layer,i.options.interactive&&i._containsPoint(s)&&(!(e.type==="click"||e.type==="preclick")||!this._map._draggableMoved(i))&&(r=i);this._fireEvent(r?[r]:!1,e)},_onMouseMove:function(e){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var s=this._map.mouseEventToLayerPoint(e);this._handleMouseHover(e,s)}},_handleMouseOut:function(e){var s=this._hoveredLayer;s&&(Fe(this._container,"leaflet-interactive"),this._fireEvent([s],e,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(e,s){if(!this._mouseHoverThrottled){for(var i,r,l=this._drawFirst;l;l=l.next)i=l.layer,i.options.interactive&&i._containsPoint(s)&&(r=i);r!==this._hoveredLayer&&(this._handleMouseOut(e),r&&(je(this._container,"leaflet-interactive"),this._fireEvent([r],e,"mouseover"),this._hoveredLayer=r)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,e),this._mouseHoverThrottled=!0,setTimeout(u(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(e,s,i){this._map._fireDOMEvent(s,i||s.type,e)},_bringToFront:function(e){var s=e._order;if(s){var i=s.next,r=s.prev;if(i)i.prev=r;else return;r?r.next=i:i&&(this._drawFirst=i),s.prev=this._drawLast,this._drawLast.next=s,s.next=null,this._drawLast=s,this._requestRedraw(e)}},_bringToBack:function(e){var s=e._order;if(s){var i=s.next,r=s.prev;if(r)r.next=i;else return;i?i.prev=r:r&&(this._drawLast=r),s.prev=null,s.next=this._drawFirst,this._drawFirst.prev=s,this._drawFirst=s,this._requestRedraw(e)}}});function $r(e){return ae.canvas?new Hr(e):null}var bs=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(e){return document.createElement("<lvml:"+e+' class="lvml">')}}catch{}return function(e){return document.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),Wa={_initContainer:function(){this._container=Se("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(jt.prototype._update.call(this),this.fire("update"))},_initPath:function(e){var s=e._container=bs("shape");je(s,"leaflet-vml-shape "+(this.options.className||"")),s.coordsize="1 1",e._path=bs("path"),s.appendChild(e._path),this._updateStyle(e),this._layers[f(e)]=e},_addPath:function(e){var s=e._container;this._container.appendChild(s),e.options.interactive&&e.addInteractiveTarget(s)},_removePath:function(e){var s=e._container;De(s),e.removeInteractiveTarget(s),delete this._layers[f(e)]},_updateStyle:function(e){var s=e._stroke,i=e._fill,r=e.options,l=e._container;l.stroked=!!r.stroke,l.filled=!!r.fill,r.stroke?(s||(s=e._stroke=bs("stroke")),l.appendChild(s),s.weight=r.weight+"px",s.color=r.color,s.opacity=r.opacity,r.dashArray?s.dashStyle=$(r.dashArray)?r.dashArray.join(" "):r.dashArray.replace(/( *, *)/g," "):s.dashStyle="",s.endcap=r.lineCap.replace("butt","flat"),s.joinstyle=r.lineJoin):s&&(l.removeChild(s),e._stroke=null),r.fill?(i||(i=e._fill=bs("fill")),l.appendChild(i),i.color=r.fillColor||r.color,i.opacity=r.fillOpacity):i&&(l.removeChild(i),e._fill=null)},_updateCircle:function(e){var s=e._point.round(),i=Math.round(e._radius),r=Math.round(e._radiusY||i);this._setPath(e,e._empty()?"M0 0":"AL "+s.x+","+s.y+" "+i+","+r+" 0,"+65535*360)},_setPath:function(e,s){e._path.v=s},_bringToFront:function(e){$t(e._container)},_bringToBack:function(e){Ut(e._container)}},Qs=ae.vml?bs:I,_s=jt.extend({_initContainer:function(){this._container=Qs("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Qs("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){De(this._container),Me(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){jt.prototype._update.call(this);var e=this._bounds,s=e.getSize(),i=this._container;(!this._svgSize||!this._svgSize.equals(s))&&(this._svgSize=s,i.setAttribute("width",s.x),i.setAttribute("height",s.y)),Ze(i,e.min),i.setAttribute("viewBox",[e.min.x,e.min.y,s.x,s.y].join(" ")),this.fire("update")}},_initPath:function(e){var s=e._path=Qs("path");e.options.className&&je(s,e.options.className),e.options.interactive&&je(s,"leaflet-interactive"),this._updateStyle(e),this._layers[f(e)]=e},_addPath:function(e){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(e._path),e.addInteractiveTarget(e._path)},_removePath:function(e){De(e._path),e.removeInteractiveTarget(e._path),delete this._layers[f(e)]},_updatePath:function(e){e._project(),e._update()},_updateStyle:function(e){var s=e._path,i=e.options;s&&(i.stroke?(s.setAttribute("stroke",i.color),s.setAttribute("stroke-opacity",i.opacity),s.setAttribute("stroke-width",i.weight),s.setAttribute("stroke-linecap",i.lineCap),s.setAttribute("stroke-linejoin",i.lineJoin),i.dashArray?s.setAttribute("stroke-dasharray",i.dashArray):s.removeAttribute("stroke-dasharray"),i.dashOffset?s.setAttribute("stroke-dashoffset",i.dashOffset):s.removeAttribute("stroke-dashoffset")):s.setAttribute("stroke","none"),i.fill?(s.setAttribute("fill",i.fillColor||i.color),s.setAttribute("fill-opacity",i.fillOpacity),s.setAttribute("fill-rule",i.fillRule||"evenodd")):s.setAttribute("fill","none"))},_updatePoly:function(e,s){this._setPath(e,q(e._parts,s))},_updateCircle:function(e){var s=e._point,i=Math.max(Math.round(e._radius),1),r=Math.max(Math.round(e._radiusY),1)||i,l="a"+i+","+r+" 0 1,0 ",h=e._empty()?"M0 0":"M"+(s.x-i)+","+s.y+l+i*2+",0 "+l+-i*2+",0 ";this._setPath(e,h)},_setPath:function(e,s){e._path.setAttribute("d",s)},_bringToFront:function(e){$t(e._path)},_bringToBack:function(e){Ut(e._path)}});ae.vml&&_s.include(Wa);function Ur(e){return ae.svg||ae.vml?new _s(e):null}Pe.include({getRenderer:function(e){var s=e.options.renderer||this._getPaneRenderer(e.options.pane)||this.options.renderer||this._renderer;return s||(s=this._renderer=this._createRenderer()),this.hasLayer(s)||this.addLayer(s),s},_getPaneRenderer:function(e){if(e==="overlayPane"||e===void 0)return!1;var s=this._paneRenderers[e];return s===void 0&&(s=this._createRenderer({pane:e}),this._paneRenderers[e]=s),s},_createRenderer:function(e){return this.options.preferCanvas&&$r(e)||Ur(e)}});var Wr=Gt.extend({initialize:function(e,s){Gt.prototype.initialize.call(this,this._boundsToLatLngs(e),s)},setBounds:function(e){return this.setLatLngs(this._boundsToLatLngs(e))},_boundsToLatLngs:function(e){return e=be(e),[e.getSouthWest(),e.getNorthWest(),e.getNorthEast(),e.getSouthEast()]}});function qa(e,s){return new Wr(e,s)}_s.create=Qs,_s.pointsToPath=q,wt.geometryToLayer=Ws,wt.coordsToLatLng=$i,wt.coordsToLatLngs=qs,wt.latLngToCoords=Ui,wt.latLngsToCoords=Gs,wt.getFeature=Kt,wt.asFeature=Ks,Pe.mergeOptions({boxZoom:!0});var qr=pt.extend({initialize:function(e){this._map=e,this._container=e._container,this._pane=e._panes.overlayPane,this._resetStateTimeout=0,e.on("unload",this._destroy,this)},addHooks:function(){_e(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Me(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){De(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(e){if(!e.shiftKey||e.which!==1&&e.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),hs(),Li(),this._startPoint=this._map.mouseEventToContainerPoint(e),_e(document,{contextmenu:It,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(e){this._moved||(this._moved=!0,this._box=Se("div","leaflet-zoom-box",this._container),je(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(e);var s=new ee(this._point,this._startPoint),i=s.getSize();Ze(this._box,s.min),this._box.style.width=i.x+"px",this._box.style.height=i.y+"px"},_finish:function(){this._moved&&(De(this._box),Fe(this._container,"leaflet-crosshair")),ms(),Pi(),Me(document,{contextmenu:It,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(e){if(!(e.which!==1&&e.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(u(this._resetState,this),0);var s=new ve(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(s).fire("boxzoomend",{boxZoomBounds:s})}},_onKeyDown:function(e){e.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Pe.addInitHook("addHandler","boxZoom",qr),Pe.mergeOptions({doubleClickZoom:!0});var Gr=pt.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(e){var s=this._map,i=s.getZoom(),r=s.options.zoomDelta,l=e.originalEvent.shiftKey?i-r:i+r;s.options.doubleClickZoom==="center"?s.setZoom(l):s.setZoomAround(e.containerPoint,l)}});Pe.addInitHook("addHandler","doubleClickZoom",Gr),Pe.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Kr=pt.extend({addHooks:function(){if(!this._draggable){var e=this._map;this._draggable=new Lt(e._mapPane,e._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),e.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),e.on("zoomend",this._onZoomEnd,this),e.whenReady(this._onZoomEnd,this))}je(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Fe(this._map._container,"leaflet-grab"),Fe(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var e=this._map;if(e._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var s=be(this._map.options.maxBounds);this._offsetLimit=de(this._map.latLngToContainerPoint(s.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(s.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;e.fire("movestart").fire("dragstart"),e.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(e){if(this._map.options.inertia){var s=this._lastTime=+new Date,i=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(i),this._times.push(s),this._prunePositions(s)}this._map.fire("move",e).fire("drag",e)},_prunePositions:function(e){for(;this._positions.length>1&&e-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var e=this._map.getSize().divideBy(2),s=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=s.subtract(e).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(e,s){return e-(e-s)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var e=this._draggable._newPos.subtract(this._draggable._startPos),s=this._offsetLimit;e.x<s.min.x&&(e.x=this._viscousLimit(e.x,s.min.x)),e.y<s.min.y&&(e.y=this._viscousLimit(e.y,s.min.y)),e.x>s.max.x&&(e.x=this._viscousLimit(e.x,s.max.x)),e.y>s.max.y&&(e.y=this._viscousLimit(e.y,s.max.y)),this._draggable._newPos=this._draggable._startPos.add(e)}},_onPreDragWrap:function(){var e=this._worldWidth,s=Math.round(e/2),i=this._initialWorldOffset,r=this._draggable._newPos.x,l=(r-s+i)%e+s-i,h=(r+s+i)%e-s-i,_=Math.abs(l+i)<Math.abs(h+i)?l:h;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=_},_onDragEnd:function(e){var s=this._map,i=s.options,r=!i.inertia||e.noInertia||this._times.length<2;if(s.fire("dragend",e),r)s.fire("moveend");else{this._prunePositions(+new Date);var l=this._lastPos.subtract(this._positions[0]),h=(this._lastTime-this._times[0])/1e3,_=i.easeLinearity,T=l.multiplyBy(_/h),O=T.distanceTo([0,0]),U=Math.min(i.inertiaMaxSpeed,O),re=T.multiplyBy(U/O),me=U/(i.inertiaDeceleration*_),ke=re.multiplyBy(-me/2).round();!ke.x&&!ke.y?s.fire("moveend"):(ke=s._limitOffset(ke,s.options.maxBounds),V(function(){s.panBy(ke,{duration:me,easeLinearity:_,noMoveStart:!0,animate:!0})}))}}});Pe.addInitHook("addHandler","dragging",Kr),Pe.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Jr=pt.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(e){this._map=e,this._setPanDelta(e.options.keyboardPanDelta),this._setZoomDelta(e.options.zoomDelta)},addHooks:function(){var e=this._map._container;e.tabIndex<=0&&(e.tabIndex="0"),_e(e,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Me(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var e=document.body,s=document.documentElement,i=e.scrollTop||s.scrollTop,r=e.scrollLeft||s.scrollLeft;this._map._container.focus(),window.scrollTo(r,i)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(e){var s=this._panKeys={},i=this.keyCodes,r,l;for(r=0,l=i.left.length;r<l;r++)s[i.left[r]]=[-1*e,0];for(r=0,l=i.right.length;r<l;r++)s[i.right[r]]=[e,0];for(r=0,l=i.down.length;r<l;r++)s[i.down[r]]=[0,e];for(r=0,l=i.up.length;r<l;r++)s[i.up[r]]=[0,-1*e]},_setZoomDelta:function(e){var s=this._zoomKeys={},i=this.keyCodes,r,l;for(r=0,l=i.zoomIn.length;r<l;r++)s[i.zoomIn[r]]=e;for(r=0,l=i.zoomOut.length;r<l;r++)s[i.zoomOut[r]]=-e},_addHooks:function(){_e(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Me(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(e){if(!(e.altKey||e.ctrlKey||e.metaKey)){var s=e.keyCode,i=this._map,r;if(s in this._panKeys){if(!i._panAnim||!i._panAnim._inProgress)if(r=this._panKeys[s],e.shiftKey&&(r=F(r).multiplyBy(3)),i.options.maxBounds&&(r=i._limitOffset(F(r),i.options.maxBounds)),i.options.worldCopyJump){var l=i.wrapLatLng(i.unproject(i.project(i.getCenter()).add(r)));i.panTo(l)}else i.panBy(r)}else if(s in this._zoomKeys)i.setZoom(i.getZoom()+(e.shiftKey?3:1)*this._zoomKeys[s]);else if(s===27&&i._popup&&i._popup.options.closeOnEscapeKey)i.closePopup();else return;It(e)}}});Pe.addInitHook("addHandler","keyboard",Jr),Pe.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Yr=pt.extend({addHooks:function(){_e(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Me(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(e){var s=_r(e),i=this._map.options.wheelDebounceTime;this._delta+=s,this._lastMousePos=this._map.mouseEventToContainerPoint(e),this._startTime||(this._startTime=+new Date);var r=Math.max(i-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(u(this._performZoom,this),r),It(e)},_performZoom:function(){var e=this._map,s=e.getZoom(),i=this._map.options.zoomSnap||0;e._stop();var r=this._delta/(this._map.options.wheelPxPerZoomLevel*4),l=4*Math.log(2/(1+Math.exp(-Math.abs(r))))/Math.LN2,h=i?Math.ceil(l/i)*i:l,_=e._limitZoom(s+(this._delta>0?h:-h))-s;this._delta=0,this._startTime=null,_&&(e.options.scrollWheelZoom==="center"?e.setZoom(s+_):e.setZoomAround(this._lastMousePos,s+_))}});Pe.addInitHook("addHandler","scrollWheelZoom",Yr);var Ga=600;Pe.mergeOptions({tapHold:ae.touchNative&&ae.safari&&ae.mobile,tapTolerance:15});var Xr=pt.extend({addHooks:function(){_e(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Me(this._map._container,"touchstart",this._onDown,this)},_onDown:function(e){if(clearTimeout(this._holdTimeout),e.touches.length===1){var s=e.touches[0];this._startPos=this._newPos=new x(s.clientX,s.clientY),this._holdTimeout=setTimeout(u(function(){this._cancel(),this._isTapValid()&&(_e(document,"touchend",Ke),_e(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",s))},this),Ga),_e(document,"touchend touchcancel contextmenu",this._cancel,this),_e(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function e(){Me(document,"touchend",Ke),Me(document,"touchend touchcancel",e)},_cancel:function(){clearTimeout(this._holdTimeout),Me(document,"touchend touchcancel contextmenu",this._cancel,this),Me(document,"touchmove",this._onMove,this)},_onMove:function(e){var s=e.touches[0];this._newPos=new x(s.clientX,s.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(e,s){var i=new MouseEvent(e,{bubbles:!0,cancelable:!0,view:window,screenX:s.screenX,screenY:s.screenY,clientX:s.clientX,clientY:s.clientY});i._simulated=!0,s.target.dispatchEvent(i)}});Pe.addInitHook("addHandler","tapHold",Xr),Pe.mergeOptions({touchZoom:ae.touch,bounceAtZoomLimits:!0});var Qr=pt.extend({addHooks:function(){je(this._map._container,"leaflet-touch-zoom"),_e(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Fe(this._map._container,"leaflet-touch-zoom"),Me(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(e){var s=this._map;if(!(!e.touches||e.touches.length!==2||s._animatingZoom||this._zooming)){var i=s.mouseEventToContainerPoint(e.touches[0]),r=s.mouseEventToContainerPoint(e.touches[1]);this._centerPoint=s.getSize()._divideBy(2),this._startLatLng=s.containerPointToLatLng(this._centerPoint),s.options.touchZoom!=="center"&&(this._pinchStartLatLng=s.containerPointToLatLng(i.add(r)._divideBy(2))),this._startDist=i.distanceTo(r),this._startZoom=s.getZoom(),this._moved=!1,this._zooming=!0,s._stop(),_e(document,"touchmove",this._onTouchMove,this),_e(document,"touchend touchcancel",this._onTouchEnd,this),Ke(e)}},_onTouchMove:function(e){if(!(!e.touches||e.touches.length!==2||!this._zooming)){var s=this._map,i=s.mouseEventToContainerPoint(e.touches[0]),r=s.mouseEventToContainerPoint(e.touches[1]),l=i.distanceTo(r)/this._startDist;if(this._zoom=s.getScaleZoom(l,this._startZoom),!s.options.bounceAtZoomLimits&&(this._zoom<s.getMinZoom()&&l<1||this._zoom>s.getMaxZoom()&&l>1)&&(this._zoom=s._limitZoom(this._zoom)),s.options.touchZoom==="center"){if(this._center=this._startLatLng,l===1)return}else{var h=i._add(r)._divideBy(2)._subtract(this._centerPoint);if(l===1&&h.x===0&&h.y===0)return;this._center=s.unproject(s.project(this._pinchStartLatLng,this._zoom).subtract(h),this._zoom)}this._moved||(s._moveStart(!0,!1),this._moved=!0),J(this._animRequest);var _=u(s._move,s,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=V(_,this,!0),Ke(e)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,J(this._animRequest),Me(document,"touchmove",this._onTouchMove,this),Me(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Pe.addInitHook("addHandler","touchZoom",Qr),Pe.BoxZoom=qr,Pe.DoubleClickZoom=Gr,Pe.Drag=Kr,Pe.Keyboard=Jr,Pe.ScrollWheelZoom=Yr,Pe.TapHold=Xr,Pe.TouchZoom=Qr,o.Bounds=ee,o.Browser=ae,o.CRS=Ve,o.Canvas=Hr,o.Circle=Hi,o.CircleMarker=Us,o.Class=E,o.Control=ut,o.DivIcon=Fr,o.DivOverlay=gt,o.DomEvent=ha,o.DomUtil=da,o.Draggable=Lt,o.Evented=A,o.FeatureGroup=bt,o.GeoJSON=wt,o.GridLayer=vs,o.Handler=pt,o.Icon=qt,o.ImageOverlay=Js,o.LatLng=ge,o.LatLngBounds=ve,o.Layer=ht,o.LayerGroup=Wt,o.LineUtil=ka,o.Map=Pe,o.Marker=$s,o.Mixin=va,o.Path=Pt,o.Point=x,o.PolyUtil=ba,o.Polygon=Gt,o.Polyline=_t,o.Popup=Ys,o.PosAnimation=wr,o.Projection=Ca,o.Rectangle=Wr,o.Renderer=jt,o.SVG=_s,o.SVGOverlay=Br,o.TileLayer=Jt,o.Tooltip=Xs,o.Transformation=oe,o.Util=k,o.VideoOverlay=zr,o.bind=u,o.bounds=de,o.canvas=$r,o.circle=Da,o.circleMarker=Ma,o.control=gs,o.divIcon=Ha,o.extend=d,o.featureGroup=Ta,o.geoJSON=Ir,o.geoJson=Ia,o.gridLayer=$a,o.icon=Ea,o.imageOverlay=za,o.latLng=fe,o.latLngBounds=be,o.layerGroup=Sa,o.map=ma,o.marker=Aa,o.point=F,o.polygon=Ra,o.polyline=Oa,o.popup=Va,o.rectangle=qa,o.setOptions=P,o.stamp=f,o.svg=Ur,o.svgOverlay=Fa,o.tileLayer=Vr,o.tooltip=Za,o.transformation=he,o.version=c,o.videoOverlay=Ba;var Ka=window.L;o.noConflict=function(){return window.L=Ka,this},window.L=o})})(or,or.exports);var Tc=or.exports;const Ye=ao(Tc),Ec=({vehicleStats:n,recentActivity:a,formatTimeAgo:o,driversStats:c,tripsStats:d})=>t.jsxs("div",{className:"space-y-8",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Business Overview"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-6",children:[t.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:t.jsx("div",{className:"p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("svg",{className:"h-6 w-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"})})}),t.jsx("div",{className:"ml-5 w-0 flex-1",children:t.jsxs("dl",{children:[t.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Vehicles"}),t.jsx("dd",{className:"text-lg font-medium text-gray-900",children:n.total})]})})]})})}),t.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:t.jsx("div",{className:"p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("svg",{className:"h-6 w-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),t.jsx("div",{className:"ml-5 w-0 flex-1",children:t.jsxs("dl",{children:[t.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Active Vehicles"}),t.jsx("dd",{className:"text-lg font-medium text-gray-900",children:n.active})]})})]})})}),t.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:t.jsx("div",{className:"p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsxs("svg",{className:"h-6 w-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}),t.jsx("div",{className:"ml-5 w-0 flex-1",children:t.jsxs("dl",{children:[t.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"In Maintenance"}),t.jsx("dd",{className:"text-lg font-medium text-gray-900",children:n.maintenance})]})})]})})}),t.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:t.jsx("div",{className:"p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("svg",{className:"h-6 w-6 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),t.jsx("div",{className:"ml-5 w-0 flex-1",children:t.jsxs("dl",{children:[t.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Retired Vehicles"}),t.jsx("dd",{className:"text-lg font-medium text-gray-900",children:n.retired})]})})]})})}),t.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:t.jsx("div",{className:"p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("svg",{className:"h-6 w-6 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),t.jsx("div",{className:"ml-5 w-0 flex-1",children:t.jsxs("dl",{children:[t.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Drivers Hired"}),t.jsx("dd",{className:"text-lg font-medium text-gray-900",children:(c==null?void 0:c.hired)||0})]})})]})})}),t.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:t.jsx("div",{className:"p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("svg",{className:"h-6 w-6 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})})}),t.jsx("div",{className:"ml-5 w-0 flex-1",children:t.jsxs("dl",{children:[t.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Trips"}),t.jsx("dd",{className:"text-lg font-medium text-gray-900",children:(d==null?void 0:d.total)||0})]})})]})})})]}),t.jsx("div",{className:"bg-white shadow rounded-lg",children:t.jsxs("div",{className:"px-6 py-6 sm:p-8",children:[t.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Recent Activity"}),t.jsx("div",{className:"mt-5",children:a.length===0?t.jsxs("div",{className:"text-center py-6",children:[t.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"})}),t.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No recent activity"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Add vehicles to see activity here."})]}):t.jsx("div",{className:"flow-root",children:t.jsx("ul",{className:"space-y-6",children:a.map((m,u)=>{let p="bg-blue-500",f=t.jsx("svg",{className:"h-5 w-5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{d:"M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"})});return m.type==="driver_hired"?(p="bg-indigo-500",f=t.jsx("svg",{className:"h-5 w-5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})})):m.type==="trip_created"&&(p="bg-orange-500",f=t.jsx("svg",{className:"h-5 w-5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})})),t.jsx("li",{children:t.jsxs("div",{className:"relative flex items-start space-x-4",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("span",{className:`h-10 w-10 rounded-full ${p} flex items-center justify-center ring-4 ring-white shadow-sm`,children:f})}),t.jsx("div",{className:"flex-1 min-w-0",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-sm text-gray-900",children:m.message}),m.vehicle&&t.jsx("div",{className:"mt-2",children:t.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:m.vehicle.status})}),m.driver&&t.jsx("div",{className:"mt-2",children:t.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800",children:"Hired"})}),m.trip&&t.jsx("div",{className:"mt-2",children:t.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800",children:m.trip.status})})]}),t.jsx("div",{className:"ml-4 flex-shrink-0",children:t.jsx("time",{className:"text-xs text-gray-500",children:o(m.timestamp)})})]})})]})},m.id)})})})})]})})]}),Ac=({vehicles:n,loading:a,clearVehicleForm:o,setShowAddVehicle:c,handleViewVehicleDetails:d,handleEditVehicle:m,handleDeleteVehicle:u})=>t.jsxs("div",{className:"space-y-8",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Fleet Management"}),t.jsxs("button",{onClick:()=>{o(),c(!0)},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center",children:[t.jsx("svg",{className:"h-5 w-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Vehicle"]})]}),t.jsxs("div",{className:"bg-white shadow rounded-lg",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Your Vehicles (",n.length,")"]})}),a?t.jsxs("div",{className:"p-6 text-center",children:[t.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),t.jsx("p",{className:"mt-2 text-gray-600",children:"Loading vehicles..."})]}):n.length===0?t.jsxs("div",{className:"p-6 text-center",children:[t.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"})}),t.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No vehicles"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by adding your first vehicle."}),t.jsx("div",{className:"mt-6",children:t.jsx("button",{onClick:()=>{o(),c(!0)},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium",children:"Add Vehicle"})})]}):t.jsx("div",{className:"p-6",children:t.jsx("div",{className:"space-y-4",children:n.map(p=>{var f;return t.jsx("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md transition-shadow",children:t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"w-1/3 p-4",children:(f=p.vehicleImage)!=null&&f.url?t.jsx("img",{src:p.vehicleImage.url,alt:"Vehicle",className:"w-full h-40 object-cover rounded-md"}):t.jsx("div",{className:"w-full h-40 bg-gray-200 rounded-md flex items-center justify-center",children:t.jsx("svg",{className:"h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"})})})}),t.jsxs("div",{className:"w-2/3 p-4 flex flex-col justify-between",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:p.registeredNumber}),t.jsx("p",{className:"text-sm text-gray-600",children:p.makersName})]}),t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"space-y-1",children:[p.seatingCapacity&&t.jsxs("p",{className:"text-sm text-gray-500",children:["Seats: ",p.seatingCapacity]}),p.vehicleType&&t.jsxs("p",{className:"text-sm text-gray-500",children:["Type: ",p.vehicleType]})]})})]}),t.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[t.jsx("button",{onClick:()=>d(p),className:"text-blue-600 hover:text-blue-800 font-medium",children:"View Details"}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("button",{onClick:()=>m(p),className:"text-gray-600 hover:text-gray-800 p-2 rounded-md hover:bg-gray-100",title:"Edit Vehicle",children:t.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),t.jsx("button",{onClick:()=>u(p._id),className:"text-red-600 hover:text-red-800 p-2 rounded-md hover:bg-red-50",title:"Delete Vehicle",children:t.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})]})]})},p._id)})})})]})]}),Mc=({activeSubTab:n,setActiveSubTab:a,drivers:o,hiredDrivers:c,pendingOffers:d,driversLoading:m,hiredDriversLoading:u,pendingOffersLoading:p,fetchAvailableDrivers:f,fetchHiredDrivers:y,fetchPendingOffers:g,selectedDriver:N,showDriverDetails:C,setSelectedDriver:Z,setShowDriverDetails:w,offerForm:P,setOfferForm:M,showOfferModal:W,setShowOfferModal:K})=>{const[$,z]=v.useState(null),[G,Q]=v.useState({}),[Y,X]=v.useState(!1),[ce,ye]=v.useState(""),[V,J]=v.useState({HMV:!1,LMV:!1,MCWG:!1,MCWOG:!1}),k=async x=>{try{X(!0);const b=localStorage.getItem("token");if(!b)return;const F=await fetch(`/api/drivers/${x}`,{headers:{Authorization:`Bearer ${b}`,"Content-Type":"application/json"}});if(F.ok){const ee=await F.json();Q(de=>({...de,[x]:ee.driver}))}else console.error("Failed to fetch driver details",F.status),D.error("Failed to fetch driver details")}catch(b){console.error("Error fetching driver details",b),D.error("Error fetching driver details")}finally{X(!1)}},E=x=>{$===x?z(null):(z(x),G[x]||k(x))},S=x=>x.filter(b=>(ce===""||b.name&&b.name.toLowerCase().includes(ce.toLowerCase())||b.dlNumber&&b.dlNumber.toLowerCase().includes(ce.toLowerCase()))&&(()=>{const de=Object.entries(V).filter(([be,ge])=>ge);if(de.length===0)return!0;const ve=Array.isArray(b.vehicleClass)?b.vehicleClass:[b.vehicleClass];return de.some(([be,ge])=>ve.some(fe=>fe===be))})()),j=x=>{J(b=>({...b,[x]:!b[x]}))},A=()=>{ye(""),J({HMV:!1,LMV:!1,MCWG:!1,MCWOG:!1})};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Hire Drivers"}),t.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded-md text-sm",onClick:()=>{f(),y(),g()},children:"Refresh"})]}),t.jsxs("div",{className:"bg-white shadow rounded-lg",children:[t.jsx("div",{className:"border-b border-gray-200",children:t.jsxs("nav",{className:"flex space-x-8 px-6",children:[t.jsx("button",{onClick:()=>a(x=>({...x,drivers:"available"})),className:`py-4 px-1 border-b-2 font-medium text-sm ${n.drivers==="available"?"border-yellow-500 text-yellow-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Available Drivers"}),t.jsx("button",{onClick:()=>a(x=>({...x,drivers:"pending"})),className:`py-4 px-1 border-b-2 font-medium text-sm ${n.drivers==="pending"?"border-yellow-500 text-yellow-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Pending Offers"}),t.jsx("button",{onClick:()=>a(x=>({...x,drivers:"hired"})),className:`py-4 px-1 border-b-2 font-medium text-sm ${n.drivers==="hired"?"border-yellow-500 text-yellow-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Hired Drivers"})]})}),t.jsxs("div",{className:"p-6",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-4 mb-6",children:t.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0 lg:space-x-6",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),t.jsx("input",{type:"text",placeholder:"Search drivers by name or DL number...",value:ce,onChange:x=>ye(x.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500"})]})}),t.jsxs("div",{className:"flex flex-wrap items-center space-x-4",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Vehicle Class:"}),["HMV","LMV","MCWG","MCWOG"].map(x=>t.jsxs("label",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",checked:V[x],onChange:()=>j(x),className:"h-4 w-4 text-yellow-600 focus:ring-yellow-500 border-gray-300 rounded"}),t.jsx("span",{className:"ml-2 text-sm text-gray-700",children:x})]},x))]}),t.jsx("button",{onClick:A,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors",children:"Clear Filters"})]})}),n.drivers==="available"&&t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Available Drivers"}),t.jsx("div",{className:"bg-white",children:m?t.jsxs("div",{className:"p-6 text-center",children:[t.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),t.jsx("p",{className:"mt-2 text-gray-600",children:"Loading drivers..."})]}):o.length===0?t.jsxs("div",{className:"text-center text-gray-600",children:[t.jsx("p",{children:"No available drivers found."}),t.jsx("p",{className:"text-sm mt-2",children:"All drivers may have pending offers or be hired by other businesses."})]}):(()=>{const x=S(o);return x.length===0?t.jsxs("div",{className:"text-center text-gray-600",children:[t.jsx("p",{children:"No drivers match your search criteria."}),t.jsx("p",{className:"text-sm mt-2",children:"Try adjusting your search terms or filters."})]}):t.jsx("div",{className:"space-y-4",children:x.map(b=>t.jsxs("div",{className:"border rounded-lg shadow-sm bg-white hover:shadow-md transition-shadow",children:[t.jsx("div",{className:"p-5",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[b.profileImage?t.jsx("img",{src:b.profileImage,alt:b.name||"Driver",className:"w-12 h-12 rounded-full object-cover"}):t.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold text-lg",children:b.name?b.name.charAt(0).toUpperCase():"D"}),t.jsx("div",{children:t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:b.name||"Unnamed Driver"})})]}),t.jsxs("div",{className:"flex items-center space-x-6",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("span",{className:"text-sm text-gray-600",children:["DL: ",b.dlNumber||"N/A"]}),t.jsx("span",{className:"text-sm text-gray-600",children:Array.isArray(b.vehicleClass)?b.vehicleClass.join(", "):b.vehicleClass||"N/A"})]}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("button",{className:"text-blue-600 hover:text-blue-800 font-medium text-sm",onClick:()=>E(b._id||b.id),children:$===(b._id||b.id)?"Hide Details":"View Details"}),t.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1.5 rounded-md text-sm",onClick:()=>{Z(b),M({message:"",salaryPerDay:""}),K(!0)},children:"Send Job Offer"})]})]})]})}),$===(b._id||b.id)&&t.jsx("div",{className:"border-t bg-gray-50 p-5",children:Y?t.jsxs("div",{className:"flex items-center justify-center py-4",children:[t.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),t.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Loading details..."})]}):G[b._id||b.id]?t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),t.jsx("p",{className:"text-sm text-gray-900",children:G[b._id||b.id].name||"N/A"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DL Number"}),t.jsx("p",{className:"text-sm text-gray-900",children:G[b._id||b.id].dlNumber||"N/A"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date of Birth"}),t.jsx("p",{className:"text-sm text-gray-900",children:G[b._id||b.id].dateOfBirth?new Date(G[b._id||b.id].dateOfBirth).toLocaleDateString():"N/A"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Blood Group"}),t.jsx("p",{className:"text-sm text-gray-900",children:G[b._id||b.id].bloodGroup||"N/A"})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),t.jsx("p",{className:"text-sm text-gray-900",children:G[b._id||b.id].permanentAddress||"N/A"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vehicle Classes"}),t.jsx("p",{className:"text-sm text-gray-900",children:Array.isArray(G[b._id||b.id].vehicleClass)?G[b._id||b.id].vehicleClass.join(", "):G[b._id||b.id].vehicleClass||"N/A"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DL Validity"}),t.jsx("p",{className:"text-sm text-gray-900",children:G[b._id||b.id].dlValidity?new Date(G[b._id||b.id].dlValidity).toLocaleDateString():"N/A"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${G[b._id||b.id].status==="Available"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:G[b._id||b.id].status||"N/A"})]})]})]}):t.jsx("div",{className:"text-center text-gray-500 py-4",children:t.jsx("p",{children:"Failed to load driver details"})})})]},b._id||b.id))})})()})]}),n.drivers==="pending"&&t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Pending Job Offers"}),t.jsx("div",{className:"bg-white",children:p?t.jsxs("div",{className:"p-6 text-center",children:[t.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),t.jsx("p",{className:"mt-2 text-gray-600",children:"Loading pending offers..."})]}):d.length===0?t.jsxs("div",{className:"text-center text-gray-600",children:[t.jsx("p",{children:"No pending job offers."}),t.jsx("p",{className:"text-sm mt-2",children:"All your job offers have been responded to."})]}):(()=>{const x=S(d.map(b=>b.driver)).map(b=>d.find(F=>F.driver._id===b._id||F.driver.id===b.id));return x.length===0?t.jsxs("div",{className:"text-center text-gray-600",children:[t.jsx("p",{children:"No pending offers match your search criteria."}),t.jsx("p",{className:"text-sm mt-2",children:"Try adjusting your search terms or filters."})]}):t.jsx("div",{className:"space-y-4",children:x.map(b=>t.jsx("div",{className:"border rounded-lg shadow-sm bg-white hover:shadow-md transition-shadow",children:t.jsxs("div",{className:"p-5",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[b.driver.profileImage?t.jsx("img",{src:b.driver.profileImage,alt:b.driver.name||"Driver",className:"w-12 h-12 rounded-full object-cover"}):t.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-yellow-500 to-orange-600 rounded-full flex items-center justify-center text-white font-semibold text-lg",children:b.driver.name?b.driver.name.charAt(0).toUpperCase():"D"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:b.driver.name||"Unnamed Driver"}),t.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 mt-1",children:"Pending Response"})]})]}),t.jsx("div",{className:"flex items-center space-x-6",children:t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("span",{className:"text-sm text-gray-600",children:["DL: ",b.driver.dlNumber||"N/A"]}),t.jsx("span",{className:"text-sm text-gray-600",children:Array.isArray(b.driver.vehicleClass)?b.driver.vehicleClass.join(", "):b.driver.vehicleClass||"N/A"}),t.jsxs("span",{className:"text-sm text-gray-600",children:["Salary: ",b.salaryPerDay,"/day"]})]})})]}),t.jsxs("div",{className:"mt-4 pt-4 border-t",children:[t.jsxs("div",{className:"bg-gray-50 p-3 rounded-md",children:[t.jsx("p",{className:"text-sm text-gray-700 font-medium mb-1",children:"Message:"}),t.jsx("p",{className:"text-sm text-gray-600",children:b.message})]}),t.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Sent: ",new Date(b.sentAt).toLocaleDateString()]})]})]})},b.id))})})()})]}),n.drivers==="hired"&&t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Hired Drivers"}),t.jsx("div",{className:"bg-white",children:u?t.jsxs("div",{className:"p-6 text-center",children:[t.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),t.jsx("p",{className:"mt-2 text-gray-600",children:"Loading hired drivers..."})]}):c.length===0?t.jsx("div",{className:"text-center text-gray-600",children:"You have not hired any drivers yet."}):(()=>{const x=S(c);return x.length===0?t.jsxs("div",{className:"text-center text-gray-600",children:[t.jsx("p",{children:"No hired drivers match your search criteria."}),t.jsx("p",{className:"text-sm mt-2",children:"Try adjusting your search terms or filters."})]}):t.jsx("div",{className:"space-y-4",children:x.map(b=>t.jsxs("div",{className:"border rounded-lg shadow-sm bg-white hover:shadow-md transition-shadow",children:[t.jsx("div",{className:"p-5",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[b.profileImage?t.jsx("img",{src:b.profileImage,alt:b.name||"Driver",className:"w-12 h-12 rounded-full object-cover"}):t.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center text-white font-semibold text-lg",children:b.name?b.name.charAt(0).toUpperCase():"D"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:b.name||"Unnamed Driver"}),t.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 mt-1",children:"Hired"})]})]}),t.jsxs("div",{className:"flex items-center space-x-6",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("span",{className:"text-sm text-gray-600",children:["DL: ",b.dlNumber||"N/A"]}),t.jsx("span",{className:"text-sm text-gray-600",children:Array.isArray(b.vehicleClass)?b.vehicleClass.join(", "):b.vehicleClass||"N/A"})]}),t.jsx("div",{children:t.jsx("button",{className:"text-blue-600 hover:text-blue-800 font-medium text-sm",onClick:()=>E(b._id||b.id),children:$===(b._id||b.id)?"Hide Details":"View Details"})})]})]})}),$===(b._id||b.id)&&t.jsx("div",{className:"border-t bg-gray-50 p-5",children:Y?t.jsxs("div",{className:"flex items-center justify-center py-4",children:[t.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),t.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Loading details..."})]}):G[b._id||b.id]?t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),t.jsx("p",{className:"text-sm text-gray-900",children:G[b._id||b.id].name||"N/A"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DL Number"}),t.jsx("p",{className:"text-sm text-gray-900",children:G[b._id||b.id].dlNumber||"N/A"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date of Birth"}),t.jsx("p",{className:"text-sm text-gray-900",children:G[b._id||b.id].dateOfBirth?new Date(G[b._id||b.id].dateOfBirth).toLocaleDateString():"N/A"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Blood Group"}),t.jsx("p",{className:"text-sm text-gray-900",children:G[b._id||b.id].bloodGroup||"N/A"})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),t.jsx("p",{className:"text-sm text-gray-900",children:G[b._id||b.id].permanentAddress||"N/A"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vehicle Classes"}),t.jsx("p",{className:"text-sm text-gray-900",children:Array.isArray(G[b._id||b.id].vehicleClass)?G[b._id||b.id].vehicleClass.join(", "):G[b._id||b.id].vehicleClass||"N/A"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DL Validity"}),t.jsx("p",{className:"text-sm text-gray-900",children:G[b._id||b.id].dlValidity?new Date(G[b._id||b.id].dlValidity).toLocaleDateString():"N/A"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${G[b._id||b.id].status==="Available"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:G[b._id||b.id].status||"N/A"})]})]})]}):t.jsx("div",{className:"text-center text-gray-500 py-4",children:t.jsx("p",{children:"Failed to load driver details"})})})]},b._id||b.id))})})()})]})]})]}),W&&N&&t.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:t.jsx("div",{className:"relative top-24 mx-auto p-5 border w-11/12 md:w-1/2 lg:w-1/3 shadow-lg rounded-md bg-white",children:t.jsxs("div",{className:"mt-3",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Send Job Offer"}),t.jsx("button",{onClick:()=>K(!1),className:"text-gray-400 hover:text-gray-600",children:t.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Message"}),t.jsx("textarea",{rows:3,value:P.message,onChange:x=>M(b=>({...b,message:x.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Write a short message to the driver"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Salary / day (INR)"}),t.jsx("input",{type:"number",min:"0",value:P.salaryPerDay,onChange:x=>M(b=>({...b,salaryPerDay:x.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., 1500"})]})]}),t.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[t.jsx("button",{onClick:()=>K(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),t.jsx("button",{onClick:async()=>{try{const x=localStorage.getItem("token"),b=await fetch("/api/job-offers",{method:"POST",headers:{Authorization:`Bearer ${x}`,"Content-Type":"application/json"},body:JSON.stringify({driverId:N._id||N.id,message:P.message,salaryPerDay:Number(P.salaryPerDay)})});if(b.ok)D.success("Offer sent"),K(!1),f(),g();else{const F=await b.json();D.error(F.message||"Failed to send offer")}}catch(x){console.error(x),D.error("Failed to send offer")}},className:"px-4 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700 rounded-md",children:"Send Offer"})]})]})})})]})},Dc=()=>{const[n,a]=v.useState([]),[o,c]=v.useState(!1),[d,m]=v.useState(null),[u,p]=v.useState({}),[f,y]=v.useState(!1),[g,N]=v.useState(""),[C,Z]=v.useState("all"),[w,P]=v.useState(!1),[M,W]=v.useState(""),[K,$]=v.useState(null),[z,G]=v.useState(""),[Q,Y]=v.useState(0),[X,ce]=v.useState("");v.useEffect(()=>{ye()},[]);const ye=async()=>{try{c(!0);const x=localStorage.getItem("token");if(!x)return;const b=await fetch("/api/drivers/hired",{headers:{Authorization:`Bearer ${x}`,"Content-Type":"application/json"}});if(b.ok){const F=await b.json();a(Array.isArray(F.drivers)?F.drivers:[])}else console.error("Failed to fetch hired drivers",b.status),D.error("Failed to fetch hired drivers")}catch(x){console.error("Error fetching hired drivers",x),D.error("Error fetching hired drivers")}finally{c(!1)}},V=async x=>{try{y(!0);const b=localStorage.getItem("token");if(!b)return;const F=await fetch(`/api/drivers/${x}`,{headers:{Authorization:`Bearer ${b}`,"Content-Type":"application/json"}});if(F.ok){const ee=await F.json();p(de=>({...de,[x]:ee.driver}))}else console.error("Failed to fetch driver details",F.status),D.error("Failed to fetch driver details")}catch(b){console.error("Error fetching driver details",b),D.error("Error fetching driver details")}finally{y(!1)}},J=x=>{d===x?m(null):(m(x),u[x]||V(x))},k=(x,b)=>{$(x),W(b),G(""),Y(0),ce(""),P(!0)},E=async()=>{if(!(!K||!M))try{const x=localStorage.getItem("token");if(!x)return;let b="",F={};switch(M){case"on-leave":b=`/api/drivers/${K._id||K.id}/status`,F={status:"on-leave",reason:z};break;case"suspend":b=`/api/drivers/${K._id||K.id}/status`,F={status:"suspended",reason:z};break;case"remove":b=`/api/drivers/${K._id||K.id}/remove`,F={reason:z,rating:Q,review:X};break;default:return}const ee=await fetch(b,{method:"PUT",headers:{Authorization:`Bearer ${x}`,"Content-Type":"application/json"},body:JSON.stringify(F)});if(ee.ok){const de={"on-leave":"Driver marked as on leave",suspend:"Driver suspended",remove:"Driver removed and made available for hiring"};D.success(de[M]),P(!1),ye()}else{const de=await ee.json();D.error(de.message||`Failed to ${M} driver`)}}catch(x){console.error(`Error ${M} driver:`,x),D.error(`Failed to ${M} driver`)}},S=x=>{const b={active:{color:"bg-green-100 text-green-800",text:"Active"},"on-leave":{color:"bg-yellow-100 text-yellow-800",text:"On Leave"},suspended:{color:"bg-red-100 text-red-800",text:"Suspended"},hired:{color:"bg-blue-100 text-blue-800",text:"Hired"}},F=b[x]||b.hired;return t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${F.color}`,children:F.text})},A=(x=>x.filter(b=>{const F=g===""||b.name&&b.name.toLowerCase().includes(g.toLowerCase())||b.dlNumber&&b.dlNumber.toLowerCase().includes(g.toLowerCase()),ee=C==="all"||b.status===C;return F&&ee}))(n);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Driver Management"}),t.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded-md text-sm",onClick:ye,children:"Refresh"})]}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:t.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0 lg:space-x-6",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),t.jsx("input",{type:"text",placeholder:"Search drivers by name or DL number...",value:g,onChange:x=>N(x.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Status:"}),t.jsxs("select",{value:C,onChange:x=>Z(x.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"all",children:"All Status"}),t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"on-leave",children:"On Leave"}),t.jsx("option",{value:"suspended",children:"Suspended"})]})]})]})}),t.jsx("div",{className:"bg-white shadow rounded-lg",children:t.jsx("div",{className:"p-6",children:o?t.jsxs("div",{className:"p-6 text-center",children:[t.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),t.jsx("p",{className:"mt-2 text-gray-600",children:"Loading drivers..."})]}):n.length===0?t.jsxs("div",{className:"text-center text-gray-600",children:[t.jsx("p",{children:"No hired drivers found."}),t.jsx("p",{className:"text-sm mt-2",children:"Hire drivers from the Hire page to manage them here."})]}):A.length===0?t.jsxs("div",{className:"text-center text-gray-600",children:[t.jsx("p",{children:"No drivers match your search criteria."}),t.jsx("p",{className:"text-sm mt-2",children:"Try adjusting your search terms or filters."})]}):t.jsx("div",{className:"space-y-4",children:A.map(x=>t.jsxs("div",{className:"border rounded-lg shadow-sm bg-white hover:shadow-md transition-shadow",children:[t.jsx("div",{className:"p-5",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[x.profileImage?t.jsx("img",{src:x.profileImage,alt:x.name||"Driver",className:"w-12 h-12 rounded-full object-cover"}):t.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center text-white font-semibold text-lg",children:x.name?x.name.charAt(0).toUpperCase():"D"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:x.name||"Unnamed Driver"}),t.jsx("div",{className:"flex items-center space-x-2 mt-1",children:S(x.status)})]})]}),t.jsxs("div",{className:"flex items-center space-x-6",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("span",{className:"text-sm text-gray-600",children:["DL: ",x.dlNumber||"N/A"]}),t.jsx("span",{className:"text-sm text-gray-600",children:Array.isArray(x.vehicleClass)?x.vehicleClass.join(", "):x.vehicleClass||"N/A"})]}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("button",{className:"text-blue-600 hover:text-blue-800 font-medium text-sm",onClick:()=>J(x._id||x.id),children:d===(x._id||x.id)?"Hide Details":"View Details"}),t.jsxs("div",{className:"flex space-x-1",children:[t.jsx("button",{className:"bg-yellow-600 hover:bg-yellow-700 text-white px-2 py-1 rounded text-xs",onClick:()=>k(x,"on-leave"),disabled:x.status==="on-leave",children:"On Leave"}),t.jsx("button",{className:"bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-xs",onClick:()=>k(x,"suspend"),disabled:x.status==="suspended",children:"Suspend"}),t.jsx("button",{className:"bg-gray-600 hover:bg-gray-700 text-white px-2 py-1 rounded text-xs",onClick:()=>k(x,"remove"),children:"Remove"})]})]})]})]})}),d===(x._id||x.id)&&t.jsx("div",{className:"border-t bg-gray-50 p-5",children:f?t.jsxs("div",{className:"flex items-center justify-center py-4",children:[t.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),t.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Loading details..."})]}):u[x._id||x.id]?t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),t.jsx("p",{className:"text-sm text-gray-900",children:u[x._id||x.id].name||"N/A"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DL Number"}),t.jsx("p",{className:"text-sm text-gray-900",children:u[x._id||x.id].dlNumber||"N/A"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date of Birth"}),t.jsx("p",{className:"text-sm text-gray-900",children:u[x._id||x.id].dateOfBirth?new Date(u[x._id||x.id].dateOfBirth).toLocaleDateString():"N/A"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Blood Group"}),t.jsx("p",{className:"text-sm text-gray-900",children:u[x._id||x.id].bloodGroup||"N/A"})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),t.jsx("p",{className:"text-sm text-gray-900",children:u[x._id||x.id].permanentAddress||"N/A"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vehicle Classes"}),t.jsx("p",{className:"text-sm text-gray-900",children:Array.isArray(u[x._id||x.id].vehicleClass)?u[x._id||x.id].vehicleClass.join(", "):u[x._id||x.id].vehicleClass||"N/A"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DL Validity"}),t.jsx("p",{className:"text-sm text-gray-900",children:u[x._id||x.id].dlValidity?new Date(u[x._id||x.id].dlValidity).toLocaleDateString():"N/A"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),S(u[x._id||x.id].status)]})]})]}):t.jsx("div",{className:"text-center text-gray-500 py-4",children:t.jsx("p",{children:"Failed to load driver details"})})})]},x._id||x.id))})})}),w&&K&&t.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:t.jsx("div",{className:"relative top-24 mx-auto p-5 border w-11/12 md:w-1/2 lg:w-1/3 shadow-lg rounded-md bg-white",children:t.jsxs("div",{className:"mt-3",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:[M==="on-leave"&&"Mark Driver as On Leave",M==="suspend"&&"Suspend Driver",M==="remove"&&"Remove Driver"]}),t.jsx("button",{onClick:()=>P(!1),className:"text-gray-400 hover:text-gray-600",children:t.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-gray-50 p-3 rounded-md",children:[t.jsxs("p",{className:"text-sm text-gray-700",children:[t.jsx("strong",{children:"Driver:"})," ",K.name||"Unnamed Driver"]}),t.jsxs("p",{className:"text-sm text-gray-700",children:[t.jsx("strong",{children:"DL Number:"})," ",K.dlNumber||"N/A"]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason *"}),t.jsx("textarea",{rows:3,value:z,onChange:x=>G(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter reason for this action...",required:!0})]}),M==="remove"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rating (1-5 stars)"}),t.jsx("div",{className:"flex space-x-1",children:[1,2,3,4,5].map(x=>t.jsx("button",{type:"button",onClick:()=>Y(x),className:`text-2xl ${x<=Q?"text-yellow-400":"text-gray-300"}`,children:""},x))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Review"}),t.jsx("textarea",{rows:3,value:X,onChange:x=>ce(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Write a review about this driver..."})]})]}),t.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-3",children:t.jsxs("p",{className:"text-sm text-yellow-800",children:[M==="on-leave"&&"This will mark the driver as on leave. They will not be available for new assignments.",M==="suspend"&&"This will suspend the driver. They will not be available for any assignments until unsuspended.",M==="remove"&&"This will remove the driver from your team and make them available for hiring by other businesses."]})})]}),t.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[t.jsx("button",{onClick:()=>P(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),t.jsxs("button",{onClick:E,disabled:!z.trim(),className:`px-4 py-2 text-sm font-medium text-white rounded-md ${M==="on-leave"?"bg-yellow-600 hover:bg-yellow-700":M==="suspend"?"bg-red-600 hover:bg-red-700":"bg-gray-600 hover:bg-gray-700"} disabled:bg-gray-400`,children:[M==="on-leave"&&"Mark as On Leave",M==="suspend"&&"Suspend Driver",M==="remove"&&"Remove Driver"]})]})]})})})]})},Oc=()=>t.jsxs("div",{className:"space-y-6",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Reports & Analytics"}),t.jsx("div",{className:"bg-white shadow rounded-lg p-6",children:t.jsx("p",{className:"text-gray-600",children:"Reports and analytics features will be implemented here."})})]}),Rc=({vehicles:n,onRefreshVehicles:a})=>{const o=v.useRef(null),c=v.useRef(null),d=v.useRef(null),m=v.useRef([]),[u,p]=v.useState([]),[f,y]=v.useState(!1),[g,N]=v.useState({waypoints:[],route:[],distanceKm:0,startDate:"",endDate:"",vehicleId:"",driverId:"",driverBata:0,ratePerKm:0,vehicleRent:0,totalAmount:0,numDays:1}),[C,Z]=v.useState({start:[],end:[]}),[w,P]=v.useState({vehicles:new Set,drivers:new Set});v.useEffect(()=>{!c.current&&o.current&&(c.current=Ye.map(o.current,{zoomControl:!0,scrollWheelZoom:!1,preferCanvas:!0}).setView([20.5937,78.9629],5),Ye.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:" OpenStreetMap"}).addTo(c.current))},[]),v.useEffect(()=>{N(k=>!k.waypoints||k.waypoints.length<2?{...k,waypoints:[{address:"",coords:null},{address:"",coords:null}]}:k)},[]),v.useEffect(()=>{(async()=>{try{const E=localStorage.getItem("token");if(!E)return;const[S,j]=await Promise.all([Te.get("/api/drivers/available",{headers:{Authorization:`Bearer ${E}`}}),Te.get("/api/drivers/hired",{headers:{Authorization:`Bearer ${E}`}})]),A=Array.isArray(S.data.drivers)?S.data.drivers:[],x=Array.isArray(j.data.drivers)?j.data.drivers:[],b=new Map;[...A,...x].forEach(F=>b.set(String(F._id||F.id),F)),p(Array.from(b.values()))}catch(E){console.error(E)}})(),a==null||a()},[]);const M=async k=>{if(!k||k.length<3)return[];const E=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(k)}&limit=5&countrycodes=IN`;return(await(await fetch(E,{headers:{"Accept-Language":"en"}})).json()).map(A=>({display:A.display_name,lat:parseFloat(A.lat),lng:parseFloat(A.lon)}))},W=async(k,E)=>{N(S=>{const j={...S};return j.waypoints[k]={...j.waypoints[k]||{},address:E},j});try{const S=await M(E);Z(j=>({...j,[k]:S}))}catch(S){console.error(S)}},K=(k,E)=>{if(N(S=>{const j={...S};return j.waypoints[k]={address:E.display,coords:{lat:E.lat,lng:E.lng}},j}),c.current&&c.current.setView([E.lat,E.lng],12),Z(S=>({...S,[k]:[]})),c.current){const S=Ye.icon({iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",iconSize:[25,41],iconAnchor:[12,41],shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png"}),j=Ye.marker([E.lat,E.lng],{icon:S}).bindPopup(E.display);m.current[k]&&c.current.removeLayer(m.current[k]),j.addTo(c.current),m.current[k]=j}},$=k=>{if(!c.current)return;d.current&&(c.current.removeLayer(d.current),d.current=null),d.current=Ye.polyline(k.map(S=>[S.lat,S.lng]),{color:"blue",weight:4}).addTo(c.current);const E=d.current.getBounds();c.current.fitBounds(E,{padding:[20,20]})},z=async()=>{if(!g.waypoints||g.waypoints.length<2)return;const k=g.waypoints.filter(A=>A==null?void 0:A.coords).map(A=>`${A.coords.lng},${A.coords.lat}`);if(k.length<2)return;const E=`/api/maps/osrm?coords=${encodeURIComponent(k.join(";"))}`,S=`https://router.project-osrm.org/route/v1/driving/${k.join(";")}?overview=full&geometries=geojson`;let j;try{const A=await fetch(E);if(!A.ok)throw new Error(`Backend proxy ${A.status}`);j=await A.json()}catch(A){try{const x=`https://corsproxy.io/?${encodeURIComponent(S)}`,b=await fetch(x);if(!b.ok)throw new Error(`corsproxy.io ${b.status}`);j=await b.json()}catch(x){console.error("Route fetch failed",A,x),D.error("Failed to calculate route");return}}if(j.routes&&j.routes[0]){const A=j.routes[0],x=A.geometry.coordinates.map(([F,ee])=>({lat:ee,lng:F})),b=+(A.distance/1e3).toFixed(2);N(F=>({...F,route:x,distanceKm:b})),$(x)}else D.error("No route found")};v.useEffect(()=>{z()},[JSON.stringify(g.waypoints)]);const G=()=>{N(k=>({...k,waypoints:[...k.waypoints||[],{address:"",coords:null}]}))},Q=k=>{N(E=>{const S={...E};return S.waypoints=S.waypoints.filter((j,A)=>A!==k),S})},Y=(k,E)=>{N(S=>{const j={...S},A=[...j.waypoints],x=A.splice(k,1)[0];return A.splice(E,0,x),j.waypoints=A,j})},X=()=>new Date().toISOString().split("T")[0],ce=()=>{const k=new Date;return k.setMonth(k.getMonth()+2),k.toISOString().split("T")[0]},ye=()=>{if(!g.startDate||!g.endDate)return;const k=new Date(g.startDate),S=new Date(g.endDate)-k;if(S<0)return;const j=Math.max(1,Math.floor(S/(1e3*60*60*24))+1),A=(g.driverBata||0)*j+(g.ratePerKm||0)*(g.distanceKm||0)+(g.vehicleRent||0)*j;N(x=>({...x,numDays:j,totalAmount:+A.toFixed(2)}))};v.useEffect(()=>{ye()},[g.startDate,g.endDate,g.driverBata,g.ratePerKm,g.vehicleRent,g.distanceKm]);const V=async()=>{var k;if(!(!g.startDate||!g.endDate))try{const E=localStorage.getItem("token"),S=await Te.get("/api/trips/availability",{params:{startDate:g.startDate,endDate:g.endDate},headers:{Authorization:`Bearer ${E}`}});P({vehicles:new Set(S.data.unavailableVehicles||[]),drivers:new Set(S.data.unavailableDrivers||[])})}catch(E){if(((k=E.response)==null?void 0:k.status)===404)return;console.error(E)}};v.useEffect(()=>{V()},[g.startDate,g.endDate]);const J=async k=>{var E,S,j,A,x,b;k.preventDefault();try{y(!0);const F=localStorage.getItem("token"),ee={trip_id:`TRIP-${Date.now()}`,startAddress:(E=g.waypoints[0])==null?void 0:E.address,endAddress:(S=g.waypoints[g.waypoints.length-1])==null?void 0:S.address,startCoords:(j=g.waypoints[0])==null?void 0:j.coords,endCoords:(A=g.waypoints[g.waypoints.length-1])==null?void 0:A.coords,route:g.route,distanceKm:g.distanceKm,startDate:g.startDate,endDate:g.endDate,vehicleId:g.vehicleId,driverId:g.driverId,status:"scheduled",driverBata:g.driverBata,ratePerKm:g.ratePerKm,vehicleRent:g.vehicleRent,totalAmount:g.totalAmount,numDays:g.numDays},de=await Te.post("/api/trips",ee,{headers:{Authorization:`Bearer ${F}`}});D.success("Trip created"),N(ve=>({...ve,waypoints:[],route:[],distanceKm:0,vehicleId:"",driverId:"",driverBata:0,ratePerKm:0,vehicleRent:0,totalAmount:0,numDays:1})),d.current&&c.current&&(c.current.removeLayer(d.current),d.current=null)}catch(F){const ee=((b=(x=F.response)==null?void 0:x.data)==null?void 0:b.message)||"Failed to create trip";D.error(ee)}finally{y(!1)}};return t.jsx("div",{className:"space-y-6",children:t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx("div",{className:"lg:col-span-1 bg-white shadow rounded-lg p-6 space-y-4",children:t.jsxs("form",{onSubmit:J,className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Route"}),t.jsx("button",{type:"button",onClick:G,className:"text-blue-600 hover:text-blue-800 text-sm",children:"Add destination"})]}),t.jsxs("div",{className:"space-y-3",children:[g.waypoints.map((k,E)=>t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{value:k.address||"",onChange:S=>W(E,S.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:E===0?"Choose starting point...":E===g.waypoints.length-1?"Choose destination...":`Stop ${E}`}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{type:"button",onClick:()=>Y(E,Math.max(0,E-1)),disabled:E===0,className:"p-2 rounded border disabled:opacity-40",title:"Move up",children:""}),t.jsx("button",{type:"button",onClick:()=>Y(E,Math.min(g.waypoints.length-1,E+1)),disabled:E===g.waypoints.length-1,className:"p-2 rounded border disabled:opacity-40",title:"Move down",children:""}),t.jsx("button",{type:"button",onClick:()=>Q(E),disabled:g.waypoints.length<=2&&(E===0||E===g.waypoints.length-1),className:"p-2 rounded border disabled:opacity-40",title:"Remove",children:""})]})]}),Array.isArray(C[E])&&C[E].length>0&&t.jsx("div",{className:"border rounded mt-1 bg-white max-h-40 overflow-auto z-10",children:C[E].map((S,j)=>t.jsx("button",{type:"button",onClick:()=>K(E,S),className:"w-full text-left px-3 py-2 hover:bg-gray-100",children:S.display},`wg-${E}-${j}`))})]},E)),g.waypoints.length<2&&t.jsx("p",{className:"text-xs text-gray-500",children:"Add at least a start and a destination."})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start date"}),t.jsx("input",{type:"date",min:X(),max:ce(),value:g.startDate,onChange:k=>N(E=>({...E,startDate:k.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End date"}),t.jsx("input",{type:"date",min:g.startDate||X(),max:ce(),value:g.endDate,onChange:k=>N(E=>({...E,endDate:k.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Driver bata (per day)"}),t.jsx("input",{type:"number",min:"0",value:g.driverBata,onChange:k=>N(E=>({...E,driverBata:Number(k.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rate per km"}),t.jsx("input",{type:"number",min:"0",value:g.ratePerKm,onChange:k=>N(E=>({...E,ratePerKm:Number(k.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vehicle rent (per day)"}),t.jsx("input",{type:"number",min:"0",value:g.vehicleRent,onChange:k=>N(E=>({...E,vehicleRent:Number(k.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vehicle"}),t.jsxs("select",{value:g.vehicleId,onChange:k=>N(E=>({...E,vehicleId:k.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"Select vehicle"}),n.map(k=>t.jsxs("option",{value:k._id,disabled:w.vehicles.has(String(k._id)),children:[k.registeredNumber," ",w.vehicles.has(String(k._id))?"(Unavailable)":""]},k._id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Driver"}),t.jsxs("select",{value:g.driverId,onChange:k=>N(E=>({...E,driverId:k.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"Select driver"}),u.map(k=>t.jsxs("option",{value:k._id||k.id,disabled:w.drivers.has(String(k._id||k.id)),children:[k.name||"Unnamed Driver"," ",w.drivers.has(String(k._id||k.id))?"(Unavailable)":""]},k._id||k.id))]})]}),t.jsxs("div",{className:"w-full text-sm text-gray-700 bg-gray-50 border border-gray-200 rounded-md p-3 flex flex-wrap gap-6",children:[t.jsxs("div",{children:["Days: ",t.jsx("span",{className:"font-medium",children:g.numDays})]}),t.jsxs("div",{children:["Distance: ",t.jsxs("span",{className:"font-medium",children:[g.distanceKm," km"]})," ",t.jsx("button",{type:"button",onClick:z,className:"ml-2 text-blue-600 hover:text-blue-800",children:"Recompute"})]}),t.jsxs("div",{children:["Total: ",t.jsxs("span",{className:"font-semibold",children:[" ",g.totalAmount.toLocaleString()]})]})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{type:"submit",disabled:f||g.waypoints.filter(k=>k==null?void 0:k.coords).length<2||!g.vehicleId||!g.driverId||!g.startDate||!g.endDate,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm disabled:bg-gray-400",children:f?"Creating...":"Create Trip"})})]})}),t.jsx("div",{className:"lg:col-span-2 bg-white shadow rounded-lg p-2 overflow-hidden",children:t.jsx("div",{ref:o,className:"w-full h-[480px] rounded-md overflow-hidden"})})]})})},Ic=()=>{const[n,a]=v.useState([]),[o,c]=v.useState(!1),d=async()=>{try{c(!0);const u=localStorage.getItem("token"),p=await fetch("/api/trips",{headers:{Authorization:`Bearer ${u}`}});if(!p.ok)throw new Error("Failed to load trips");const y=((await p.json()).trips||[]).filter(g=>g.status!=="pending_payment");a(y)}catch(u){console.error(u),D.error("Failed to load trips")}finally{c(!1)}};v.useEffect(()=>{d()},[]);const m=async u=>{if(confirm("Delete this trip?"))try{const p=localStorage.getItem("token");if(!(await fetch(`/api/trips/${u}`,{method:"DELETE",headers:{Authorization:`Bearer ${p}`}})).ok)throw new Error("Delete failed");D.success("Trip deleted"),d()}catch(p){console.error(p),D.error("Failed to delete trip")}};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:["Confirmed Trips (",n.length,")"]}),t.jsx("button",{onClick:d,className:"text-sm px-3 py-1.5 rounded-md bg-blue-600 text-white hover:bg-blue-700",children:"Refresh"})]}),t.jsx("div",{className:"bg-white shadow rounded-lg",children:o?t.jsx("div",{className:"p-6",children:"Loading..."}):n.length===0?t.jsx("div",{className:"p-6 text-gray-600",children:"No trips yet."}):t.jsx("div",{className:"p-4 space-y-3",children:n.map(u=>{var p,f;return t.jsxs("div",{className:"border rounded-md p-4 flex items-center justify-between",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"text-sm text-gray-900 font-medium",children:[u.startAddress,"  ",u.endAddress]}),t.jsxs("div",{className:"text-xs text-gray-600",children:[new Date(u.startDate).toLocaleDateString()," - ",new Date(u.endDate).toLocaleDateString(),"  ",u.numDays||1," day(s)"]}),t.jsxs("div",{className:"text-xs text-gray-600",children:["Distance: ",u.distanceKm," km  Total:  ",Number(u.totalAmount||0).toLocaleString()]}),t.jsxs("div",{className:"text-xs text-gray-500",children:["Vehicle: ",((p=u.vehicleId)==null?void 0:p.registeredNumber)||u.vehicleId,"  Driver: ",((f=u.driverId)==null?void 0:f.name)||u.driverId]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs ${u.status==="completed"?"bg-green-100 text-green-800":u.status==="in_progress"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:u.status}),t.jsx("button",{onClick:()=>m(u._id),className:"text-red-600 hover:text-red-800 text-sm",children:"Delete"})]})]},u._id)})})})]})},sa=()=>{const[n,a]=v.useState([]),[o,c]=v.useState(!1),d=async()=>{try{c(!0);const u=localStorage.getItem("token");if(!u){console.error("No authentication token found"),D.error("Please log in to view pending trips");return}const p=await fetch("/api/enquiries/business/pending-trips",{headers:{Authorization:`Bearer ${u}`}});if(!p.ok){const y=await p.json();throw console.error("API Error:",y),new Error(y.message||"Failed to load pending trips")}const f=await p.json();a(f.enquiries||[])}catch(u){console.error("Error fetching pending trips:",u),D.error("Failed to load pending trips: "+u.message)}finally{c(!1)}};v.useEffect(()=>{d()},[]);const m=u=>{switch(u){case"pending_payment":return"bg-yellow-100 text-yellow-800";case"scheduled":return"bg-blue-100 text-blue-800";case"in_progress":return"bg-green-100 text-green-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Pending Trip Confirmations"}),t.jsx("button",{onClick:d,className:"text-sm px-3 py-1.5 rounded-md bg-blue-600 text-white hover:bg-blue-700",children:"Refresh"})]}),t.jsxs("div",{className:"bg-white shadow rounded-lg",children:[t.jsxs("div",{className:"p-4 border-b",children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Trips Awaiting Customer Payment (",n.length,")"]}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"These trips have been created and are waiting for customer payment confirmation."})]}),o?t.jsx("div",{className:"p-6",children:"Loading pending trips..."}):n.length===0?t.jsx("div",{className:"p-6 text-gray-600",children:"No pending trips at the moment."}):t.jsx("div",{className:"p-4 space-y-4",children:n.map(u=>{var p,f;return t.jsx("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:t.jsx("div",{className:"flex items-start justify-between mb-3",children:t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[t.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[u.vehicle.number," - ",u.vehicle.name]}),t.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${m("pending_payment")}`,children:"Awaiting Payment"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600 mb-2",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Customer:"})," ",u.customer.name]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Vehicle Class:"})," ",u.vehicle.class]})]}),t.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:[t.jsx("strong",{children:"Route:"})," ",u.route.from,"  ",u.route.to]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600 mb-2",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Dates:"})," ",new Date(u.dates.start).toLocaleDateString()," - ",new Date(u.dates.end).toLocaleDateString()]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Trip ID:"})," ",u.tripId]})]}),t.jsxs("div",{className:"p-3 bg-yellow-50 rounded-lg",children:[t.jsxs("div",{className:"text-sm text-yellow-800",children:[t.jsx("strong",{children:"Total Amount:"})," ",(p=u.amount.total)==null?void 0:p.toLocaleString()]}),t.jsxs("div",{className:"text-xs text-yellow-600",children:[t.jsx("strong",{children:"Advance Required:"})," ",(f=u.amount.advance)==null?void 0:f.toLocaleString()]})]})]})})},u.id)})})]})]})},zc=({activeSubTab:n,setActiveSubTab:a,vehicles:o,fetchVehicles:c})=>t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Trips"})}),t.jsxs("div",{className:"bg-white shadow rounded-lg",children:[t.jsx("div",{className:"border-b border-gray-200",children:t.jsxs("nav",{className:"flex space-x-8 px-6",children:[t.jsx("button",{onClick:()=>a(d=>({...d,trips:"add"})),className:`py-4 px-1 border-b-2 font-medium text-sm ${n.trips==="add"?"border-yellow-500 text-yellow-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Add Trip"}),t.jsx("button",{onClick:()=>a(d=>({...d,trips:"pending"})),className:`py-4 px-1 border-b-2 font-medium text-sm ${n.trips==="pending"?"border-yellow-500 text-yellow-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Pending Trips"}),t.jsx("button",{onClick:()=>a(d=>({...d,trips:"view"})),className:`py-4 px-1 border-b-2 font-medium text-sm ${n.trips==="view"?"border-yellow-500 text-yellow-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Confirmed Trips"})]})}),t.jsxs("div",{className:"p-6",children:[n.trips==="add"&&t.jsx(Rc,{vehicles:o,onRefreshVehicles:c}),n.trips==="pending"&&t.jsx(sa,{}),n.trips==="view"&&t.jsx(Ic,{})]})]})]});delete Ye.Icon.Default.prototype._getIconUrl;Ye.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const Bc=({onProfileUpdate:n})=>{const[a,o]=v.useState(null),[c,d]=v.useState(!0),[m,u]=v.useState(!1),[p,f]=v.useState(!1),[y,g]=v.useState({profileIcon:null,email:"",companyName:"",ownerName:"",contactNumber:"",panCard:"",panCardImage:null,address:{line1:"",line2:"",city:"",state:"",pincode:"",country:"India"}}),[N,C]=v.useState({coordinates:null,address:""}),[Z,w]=v.useState(!1),[P,M]=v.useState(null),[W,K]=v.useState(null),[$,z]=v.useState(!1),[G,Q]=v.useState(!1),[Y,X]=v.useState([]),[ce,ye]=v.useState({isValid:null,suggestions:[],loading:!1}),[V,J]=v.useState(!1),k=v.useRef(null),E=v.useRef(null),S=v.useRef(null);v.useEffect(()=>{j()},[]),v.useEffect(()=>{a===null&&!c&&u(!0)},[a,c]),v.useEffect(()=>{m&&w(!0)},[m]),v.useEffect(()=>{if(Z&&!P&&k.current){const ue=setTimeout(()=>{console.log("Initializing Leaflet map...");try{const ne=Ye.map(k.current).setView([28.6139,77.209],10);Ye.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:" OpenStreetMap contributors"}).addTo(ne),M(ne),console.log("Map initialized successfully"),ne.on("click",oe=>{const{lat:he,lng:Le}=oe.latlng;console.log("Map clicked:",he,Le),C(I=>({...I,coordinates:{lat:he,lng:Le}})),W&&ne.removeLayer(W);const Re=Ye.marker([he,Le]).addTo(ne);K(Re),ve(he,Le)})}catch(ne){console.error("Error initializing map:",ne),J(!0)}},100);return()=>clearTimeout(ue)}},[Z,P]),v.useEffect(()=>{if(P&&N.coordinates){console.log("Updating map location:",N.coordinates),P.setView([N.coordinates.lat,N.coordinates.lng],15),W&&P.removeLayer(W);const ue=Ye.marker([N.coordinates.lat,N.coordinates.lng]).addTo(P);K(ue)}},[N.coordinates,P]),v.useEffect(()=>()=>{P&&(console.log("Cleaning up map..."),P.remove())},[P]);const j=async()=>{var ue,ne,oe,he,Le,Re,I;try{d(!0);const q=localStorage.getItem("token");if(!q){console.log("No token found for business profile");return}const te=await fetch("/api/business/profile",{headers:{Authorization:`Bearer ${q}`,"Content-Type":"application/json"}});if(te.ok){const se=await te.json();o(se.business),g({profileIcon:se.business.profileIcon||null,email:((ue=se.business.userId)==null?void 0:ue.email)||"",companyName:se.business.companyName||"",ownerName:se.business.ownerName||"",contactNumber:se.business.contactNumber||"",panCard:se.business.panCard||"",panCardImage:se.business.panCardImage||null,address:{line1:((ne=se.business.address)==null?void 0:ne.line1)||"",line2:((oe=se.business.address)==null?void 0:oe.line2)||"",city:((he=se.business.address)==null?void 0:he.city)||"",state:((Le=se.business.address)==null?void 0:Le.state)||"",pincode:((Re=se.business.address)==null?void 0:Re.pincode)||"",country:((I=se.business.address)==null?void 0:I.country)||"India"}}),se.business.location&&se.business.location.coordinates&&C({coordinates:{lat:se.business.location.coordinates[1],lng:se.business.location.coordinates[0]},address:se.business.location.address||""}),console.log("Business profile fetched:",se.business)}else te.status===404?(console.log("Business profile not found, fetching user info"),o(null),await A()):(console.error("Failed to fetch business profile:",te.status),D.error("Failed to load business profile"))}catch(q){console.error("Error fetching business profile:",q),D.error("Error loading business profile")}finally{d(!1)}},A=async()=>{try{const ue=localStorage.getItem("token");if(!ue){console.log("No token found for user info");return}const ne=await fetch("/api/business/user-info",{headers:{Authorization:`Bearer ${ue}`,"Content-Type":"application/json"}});if(ne.ok){const oe=await ne.json();console.log("User info fetched:",oe.user),g(he=>({...he,email:oe.user.email||""}))}else console.error("Failed to fetch user info:",ne.status)}catch(ue){console.error("Error fetching user info:",ue)}},x=async ue=>{ue.preventDefault();try{f(!0);const ne=localStorage.getItem("token"),oe={...y,location:N.coordinates?{coordinates:N.coordinates,address:N.address,accuracy:N.accuracy||null,source:N.source||"manual",confidence:N.confidence||null}:null};console.log("Sending profile data:",JSON.stringify(oe,null,2));const he=await fetch("/api/business/profile",{method:"POST",headers:{Authorization:`Bearer ${ne}`,"Content-Type":"application/json"},body:JSON.stringify(oe)});if(he.ok){const Le=await he.json();o(Le.business),u(!1),D.success("Business profile saved successfully!"),console.log("Business profile saved:",Le.business),n&&n()}else{const Le=await he.json();console.error("Profile save error:",Le),console.error("Response status:",he.status),D.error("Error saving profile: "+Le.message)}}catch(ne){console.error("Error saving business profile:",ne),D.error("Error saving business profile")}finally{f(!1)}},b=ue=>{const{name:ne,value:oe}=ue.target;if(ne.includes(".")){const[he,Le]=ne.split(".");g(Re=>({...Re,[he]:{...Re[he],[Le]:oe}}))}else g(he=>({...he,[ne]:oe}))},F=(ue,ne)=>{const oe=ue.target.files[0];if(oe){const he=new FileReader;he.onload=Le=>{ne==="profileIcon"?g(Re=>({...Re,profileIcon:Le.target.result})):ne==="panCardImage"&&(g(Re=>({...Re,panCardImage:Le.target.result})),ee(Le.target.result))},he.readAsDataURL(oe)}},ee=async ue=>{try{Q(!0);const ne=localStorage.getItem("token");if(!ne){D.error("Please login first");return}console.log("Extracting PAN data...");const oe=await fetch("/api/business/extract-pan",{method:"POST",headers:{Authorization:`Bearer ${ne}`,"Content-Type":"application/json"},body:JSON.stringify({imageUrl:ue})});if(oe.ok){const he=await oe.json();if(console.log("PAN extraction response:",he),he.data&&he.data.panNumber){const Le=[];g(Re=>{const I={...Re,panCard:he.data.panNumber||Re.panCard};return he.data.panNumber&&Le.push("PAN Card Number"),I}),X(Le),console.log("PAN data extracted successfully"),D.success(`Updated: ${Le.join(", ")}`),setTimeout(()=>{X([])},3e3)}else console.warn("No PAN number found in image"),D.error("No PAN number found in the image"),fe()}else{const he=await oe.json();console.error("PAN extraction failed:",he),he.error&&he.error.includes("Insufficient credits")?D.error("PAN extraction service is temporarily unavailable. Please enter the PAN number manually."):he.error&&he.error.includes("API key not configured")?D.error("PAN extraction service is not configured. Please enter the PAN number manually."):D.error("Failed to extract PAN data: "+(he.message||"Unknown error")),fe()}}catch(ne){console.error("Error extracting PAN data:",ne),D.error("Error extracting PAN data: "+ne.message),fe()}finally{Q(!1)}},de=()=>{if(!navigator.geolocation){D.error("Geolocation is not supported by this browser");return}z(!0),navigator.geolocation.getCurrentPosition(ue=>{const{latitude:ne,longitude:oe}=ue.coords;console.log("Current location:",ne,oe),C(he=>({...he,coordinates:{lat:ne,lng:oe},source:"gps"})),ve(ne,oe),z(!1)},ue=>{console.error("Error getting location:",ue),D.error("Unable to get your location"),z(!1)})},ve=async(ue,ne)=>{try{const oe=await fetch(`/api/maps/reverse-geocode?lat=${ue}&lng=${ne}`);if(oe.ok){const he=await oe.json();C(Le=>({...Le,address:he.address}))}}catch(oe){console.error("Reverse geocoding error:",oe)}},be=async()=>{const ue=`${y.address.line1||""}${y.address.line2?", "+y.address.line2:""}, ${y.address.city||""}, ${y.address.state||""} ${y.address.pincode||""}, ${y.address.country||"India"}`;if(!y.address.line1&&!y.address.city&&!y.address.state&&!y.address.pincode){D.error("Please enter at least some address information to find location");return}try{z(!0);const ne=await fetch(`/api/maps/geocode-enhanced?address=${encodeURIComponent(ue)}`);if(ne.ok){const oe=await ne.json();console.log("Geocoding result:",oe),C({coordinates:oe.coordinates,address:oe.address,confidence:oe.confidence,source:"geocoded"}),D.success(`Location found! (Confidence: ${Math.round(oe.confidence*100)}%)`)}else D.error("Address not found")}catch(ne){console.error("Geocoding error:",ne),D.error("Error finding location")}finally{z(!1)}},ge=()=>{C({coordinates:null,address:""}),W&&P&&(P.removeLayer(W),K(null))},fe=()=>{g(ue=>({...ue,panCardImage:null})),S.current&&(S.current.value="")},Ve=ue=>Y.includes(ue),Ue=async()=>{const ue=`${y.address.line1||""}${y.address.line2?", "+y.address.line2:""}, ${y.address.city||""}, ${y.address.state||""} ${y.address.pincode||""}, ${y.address.country||"India"}`;if(!y.address.line1&&!y.address.city&&!y.address.state&&!y.address.pincode){ye({isValid:!1,suggestions:[],loading:!1}),D.error("Please enter at least some address information to validate");return}try{ye(oe=>({...oe,loading:!0}));const ne=await fetch(`/api/maps/geocode-enhanced?address=${encodeURIComponent(ue)}`);if(ne.ok){const oe=await ne.json();ye({isValid:!0,suggestions:[{address:oe.address,confidence:oe.confidence,coordinates:oe.coordinates}],loading:!1}),oe.confidence>.7&&C({coordinates:oe.coordinates,address:oe.address,confidence:oe.confidence,source:"geocoded"})}else ye({isValid:!1,suggestions:[],loading:!1})}catch(ne){console.error("Address validation error:",ne),ye({isValid:!1,suggestions:[],loading:!1})}};return c?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Business Profile"}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your business information and location"})]}),!m&&a&&t.jsxs("button",{onClick:()=>u(!0),className:"bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-3 rounded-lg font-medium flex items-center transition-colors",children:[t.jsx("svg",{className:"h-5 w-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Edit Profile"]})]}),t.jsx("form",{onSubmit:x,className:"space-y-6",noValidate:!0,children:t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-yellow-200 overflow-hidden",children:[t.jsx("div",{className:"bg-gradient-to-r from-yellow-500 to-yellow-600 px-6 py-8",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"h-20 w-20 bg-white rounded-full flex items-center justify-center overflow-hidden shadow-lg",children:y.profileIcon?t.jsx("img",{src:y.profileIcon,alt:"Profile",className:"h-full w-full object-cover"}):t.jsx("svg",{className:"h-10 w-10 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})})}),t.jsxs("div",{className:"ml-6 text-white",children:[t.jsx("h2",{className:"text-2xl font-bold",children:y.companyName||"Company Name"}),t.jsx("p",{className:"text-yellow-100 text-lg",children:y.ownerName||"Owner Name"}),y.address.city&&t.jsxs("p",{className:"text-yellow-200 text-sm mt-1",children:[y.address.city,", ",y.address.state]})]})]})}),t.jsxs("div",{className:"p-6 space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Profile Icon"}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("div",{className:"h-16 w-16 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden",children:y.profileIcon?t.jsx("img",{src:y.profileIcon,alt:"Profile",className:"h-full w-full object-cover"}):t.jsx("svg",{className:"h-8 w-8 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})})}),t.jsx("input",{ref:E,type:"file",accept:"image/*",onChange:ue=>F(ue,"profileIcon"),className:"block text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-yellow-50 file:text-yellow-700 hover:file:bg-yellow-100"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),t.jsx("input",{type:"email",name:"email",value:y.email,disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 text-gray-600 cursor-not-allowed",placeholder:"Email address"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Email cannot be changed"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contact Number"}),t.jsx("input",{type:"tel",name:"contactNumber",value:y.contactNumber,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500",placeholder:"Enter contact number"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Name"}),t.jsx("input",{type:"text",name:"companyName",value:y.companyName,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500",placeholder:"Enter company name"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Owner Name"}),t.jsx("input",{type:"text",name:"ownerName",value:y.ownerName,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500",placeholder:"Enter owner name"})]})]}),t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[t.jsx("svg",{className:"h-5 w-5 mr-2 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"PAN Card Information"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"PAN Card Image"}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("div",{className:"h-16 w-16 rounded-lg bg-gray-200 flex items-center justify-center overflow-hidden",children:y.panCardImage?t.jsx("img",{src:y.panCardImage,alt:"PAN Card",className:"h-full w-full object-cover"}):t.jsx("svg",{className:"h-8 w-8 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})})}),t.jsx("input",{ref:S,type:"file",accept:"image/*",onChange:ue=>F(ue,"panCardImage"),className:"block text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-yellow-50 file:text-yellow-700 hover:file:bg-yellow-100"})]}),t.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Upload a clear image of your PAN card. We'll automatically extract the PAN number.",t.jsx("br",{}),t.jsx("span",{className:"text-yellow-600 font-medium",children:"Note: If auto-extraction fails, you can manually enter the PAN number below."})]}),G&&t.jsxs("div",{className:"mt-2 flex items-center text-yellow-600",children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-yellow-600 mr-2"}),t.jsx("span",{className:"text-sm",children:"Extracting PAN data..."})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PAN Card Number"}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("input",{type:"text",name:"panCard",value:y.panCard,onChange:b,className:`flex-1 px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500 ${Ve("PAN Card Number")?"border-green-500 bg-green-50 text-green-800":"border-gray-300"}`,placeholder:"ABCDE1234F",style:{textTransform:"uppercase"}}),t.jsx("button",{type:"button",onClick:()=>{const ue=y.panCard.toUpperCase();/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/.test(ue)?D.success("PAN number format is valid!"):D.error("Please enter a valid PAN number (e.g., ABCDE1234F)")},className:"px-3 py-2 bg-yellow-100 text-yellow-700 rounded-md hover:bg-yellow-200 text-sm font-medium",children:"Validate"})]}),Ve("PAN Card Number")&&t.jsx("p",{className:"text-xs text-green-600 mt-1",children:" Auto-extracted from image"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Format: 5 letters, 4 numbers, 1 letter (e.g., ABCDE1234F)"})]})]})]}),t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[t.jsxs("svg",{className:"h-5 w-5 mr-2 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Address"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address Line 1"}),t.jsx("input",{type:"text",name:"address.line1",value:y.address.line1,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500",placeholder:"Street address"})]}),t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address Line 2"}),t.jsx("input",{type:"text",name:"address.line2",value:y.address.line2,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500",placeholder:"Apartment, suite, etc. (optional)"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City"}),t.jsx("input",{type:"text",name:"address.city",value:y.address.city,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500",placeholder:"City"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"State"}),t.jsx("input",{type:"text",name:"address.state",value:y.address.state,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500",placeholder:"State"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pincode"}),t.jsx("input",{type:"text",name:"address.pincode",value:y.address.pincode,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500",placeholder:"123456"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Country"}),t.jsx("input",{type:"text",name:"address.country",value:y.address.country,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500",placeholder:"Country"})]})]}),t.jsxs("div",{className:"mt-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{type:"button",onClick:Ue,disabled:ce.loading,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 flex items-center",children:ce.loading?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Validating..."]}):t.jsxs(t.Fragment,{children:[t.jsx("svg",{className:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Validate Address"]})}),ce.isValid!==null&&t.jsx("div",{className:"flex items-center",children:ce.isValid?t.jsxs("div",{className:"flex items-center text-green-600",children:[t.jsx("svg",{className:"h-5 w-5 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),t.jsx("span",{className:"text-sm font-medium",children:"Valid Address"})]}):t.jsxs("div",{className:"flex items-center text-red-600",children:[t.jsx("svg",{className:"h-5 w-5 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),t.jsx("span",{className:"text-sm font-medium",children:"Invalid Address"})]})})]}),ce.suggestions.length>0&&t.jsxs("div",{className:"mt-3 bg-blue-50 border border-blue-200 rounded-lg p-3",children:[t.jsx("h6",{className:"text-sm font-medium text-blue-900 mb-2",children:"Address Suggestions"}),ce.suggestions.map((ue,ne)=>t.jsxs("div",{className:"text-sm text-blue-800",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Suggested:"})," ",ue.address]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Confidence:"})," ",Math.round(ue.confidence*100),"%"]}),ue.confidence>.7&&t.jsx("p",{className:"text-green-600 font-medium",children:" High confidence - location auto-set"})]},ne))]})]})]}),t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[t.jsx("svg",{className:"h-5 w-5 mr-2 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})}),"Business Location"]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("button",{type:"button",onClick:de,disabled:$,className:"px-4 py-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700 disabled:bg-gray-400 flex items-center",children:$?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Getting Location..."]}):t.jsxs(t.Fragment,{children:[t.jsxs("svg",{className:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Use Current Location"]})}),t.jsx("button",{type:"button",onClick:be,disabled:$,className:"px-4 py-2 bg-yellow-500 text-white rounded-md hover:bg-yellow-600 disabled:bg-gray-400 flex items-center",children:$?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Finding..."]}):t.jsxs(t.Fragment,{children:[t.jsx("svg",{className:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),"Find from Address"]})}),N.coordinates&&t.jsxs("button",{type:"button",onClick:ge,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 flex items-center",children:[t.jsx("svg",{className:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"Clear Location"]})]}),N.coordinates&&t.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[t.jsx("h5",{className:"text-sm font-medium text-yellow-900 mb-2",children:"Selected Location"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("p",{className:"text-sm text-yellow-800",children:[t.jsx("strong",{children:"Coordinates:"})," ",N.coordinates.lat.toFixed(6),", ",N.coordinates.lng.toFixed(6)]}),N.address&&t.jsxs("p",{className:"text-sm text-yellow-800",children:[t.jsx("strong",{children:"Address:"})," ",N.address]}),N.confidence&&t.jsxs("p",{className:"text-sm text-yellow-800",children:[t.jsx("strong",{children:"Confidence:"})," ",Math.round(N.confidence*100),"%"]}),N.source&&t.jsxs("p",{className:"text-sm text-yellow-800",children:[t.jsx("strong",{children:"Source:"})," ",N.source==="geocoded"?"Auto-detected":"Manual selection"]})]})]}),t.jsxs("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:[t.jsx("div",{className:"bg-gray-100 px-4 py-2 text-sm text-gray-600 border-b",children:"Click on the map to set your business location"}),V?t.jsx("div",{className:"h-64 w-full bg-gray-100 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})}),t.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Map failed to load"}),t.jsx("button",{onClick:()=>{J(!1),M(null)},className:"mt-2 px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700",children:"Retry"})]})}):t.jsx("div",{ref:k,className:"h-64 w-full",style:{minHeight:"256px",zIndex:1}})]})]})]}),t.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t",children:[t.jsx("button",{type:"button",onClick:()=>u(!1),className:"px-6 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:p,className:"px-6 py-2 text-sm font-medium text-white bg-yellow-600 hover:bg-yellow-700 disabled:bg-gray-400 rounded-md flex items-center",children:p?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):"Save Profile"})]})]})]})})]})},Fc=()=>{var de,ve,be,ge,fe,Ve,Ue,ue,ne,oe,he,Le,Re;const[n,a]=v.useState([]),[o,c]=v.useState(!1),[d,m]=v.useState(null),[u,p]=v.useState(!1),[f,y]=v.useState({driverId:"",startCoords:{lat:0,lng:0},endCoords:{lat:0,lng:0},distanceKm:0,ratePerKm:0,vehicleRent:0,driverBata:0,route:[],waypoints:[]}),[g,N]=v.useState(null),[C,Z]=v.useState(null),[w,P]=v.useState([]),[M,W]=v.useState({start:[],end:[]}),[K,$]=v.useState(!1),[z,G]=v.useState(null),[Q,Y]=v.useState([]),X=async()=>{try{c(!0);const I=localStorage.getItem("token");if(!I){console.error("No authentication token found"),D.error("Please log in to view enquiries");return}const q=await fetch("/api/enquiries/business",{headers:{Authorization:`Bearer ${I}`}});if(!q.ok){const se=await q.json();throw console.error("API Error:",se),new Error(se.message||"Failed to load enquiries")}const te=await q.json();a(te.enquiries||[])}catch(I){console.error("Error fetching enquiries:",I),D.error("Failed to load enquiries: "+I.message)}finally{c(!1)}},ce=async()=>{try{const I=localStorage.getItem("token"),[q,te]=await Promise.all([fetch("/api/drivers/hired",{headers:{Authorization:`Bearer ${I}`}}),fetch("/api/job-offers/business",{headers:{Authorization:`Bearer ${I}`}})]);if(!q.ok)throw new Error("Failed to load drivers");const[se,Ee]=await Promise.all([q.ok?q.json():{drivers:[]},te.ok?te.json():{jobOffers:[]}]),Ce={};Ee.jobOffers&&Ee.jobOffers.forEach(Ae=>{Ae.status==="accepted"&&(Ce[Ae.driverId]=Ae.salaryPerDay)});const Ie=(se.drivers||[]).map(Ae=>({...Ae,acceptedSalary:Ce[Ae._id]||0}));Y(Ie)}catch(I){console.error("Error fetching drivers:",I),D.error("Failed to load drivers")}},ye=async I=>{if(!I||I.length<3)return[];try{const q=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(I)}&limit=5&countrycodes=IN`;return(await(await fetch(q,{headers:{"Accept-Language":"en"}})).json()).map(Ee=>({display:Ee.display_name,lat:parseFloat(Ee.lat),lng:parseFloat(Ee.lon)}))}catch(q){return console.error("Error searching places:",q),[]}},V=async(I,q)=>{y(te=>{const se={...te};return se.waypoints||(se.waypoints=[]),se.waypoints[I]={...se.waypoints[I]||{},address:q},se});try{const te=await ye(q);W(se=>({...se,[I]:te}))}catch(te){console.error("Error in place search:",te)}},J=(I,q)=>{y(te=>{const se={...te};return se.waypoints||(se.waypoints=[]),se.waypoints[I]={address:q.display,coords:{lat:q.lat,lng:q.lng}},se}),g&&g.setView([q.lat,q.lng],12),W(te=>({...te,[I]:[]}))},k=v.useCallback(async()=>{var se,Ee;if(!f.waypoints||f.waypoints.length<2||f.waypoints.filter(Ce=>Ce==null?void 0:Ce.coords).map(Ce=>`${Ce.coords.lng},${Ce.coords.lat}`).length<2)return;const q=(se=f.waypoints[0])==null?void 0:se.coords,te=(Ee=f.waypoints[f.waypoints.length-1])==null?void 0:Ee.coords;if(!(!q||!te))try{try{console.log("Trying Backend Route Service...");const Ae=`http://localhost:5000/api/enquiries/route?startLat=${q.lat}&startLng=${q.lng}&endLat=${te.lat}&endLng=${te.lng}`,Xe=await fetch(Ae,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});if(Xe.ok){const nt=await Xe.json();if(nt.success&&nt.route){console.log(`Success with Backend Route Service (${nt.service})`),y(Et=>({...Et,route:nt.route,distanceKm:nt.distance})),g&&A(nt.route);return}}}catch(Ae){console.log("Backend Route Service failed:",Ae)}console.log("Using enhanced vehicle route fallback");const Ce=E(q,te),Ie=S(Ce);y(Ae=>({...Ae,route:Ce,distanceKm:Ie})),g&&A(Ce)}catch(Ce){console.error("All routing failed:",Ce);const Ie=E(q,te),Ae=S(Ie);y(Xe=>({...Xe,route:Ie,distanceKm:Ae})),g&&A(Ie)}},[f.waypoints,g]),E=(I,q)=>{const te=[I],se=q.lat-I.lat,Ee=q.lng-I.lng,Ce=j(I,q),Ie=Math.max(3,Math.min(8,Math.floor(Ce/10)));for(let Ae=1;Ae<=Ie;Ae++){const Xe=Ae/(Ie+1),nt=(Math.random()-.5)*.01,Et=(Math.random()-.5)*.01,At={lat:I.lat+se*Xe+nt,lng:I.lng+Ee*Xe+Et};te.push(At)}return te.push(q),te},S=I=>{let q=0;for(let te=0;te<I.length-1;te++)q+=j(I[te],I[te+1]);return+(q*1.4).toFixed(2)},j=(I,q)=>{const se=(q.lat-I.lat)*Math.PI/180,Ee=(q.lng-I.lng)*Math.PI/180,Ce=Math.sin(se/2)*Math.sin(se/2)+Math.cos(I.lat*Math.PI/180)*Math.cos(q.lat*Math.PI/180)*Math.sin(Ee/2)*Math.sin(Ee/2);return+(6371*(2*Math.atan2(Math.sqrt(Ce),Math.sqrt(1-Ce)))).toFixed(2)},A=I=>{if(!g)return;C&&g.removeLayer(C),w.forEach(se=>{g.hasLayer(se)&&g.removeLayer(se)});const q=L.polyline(I.map(se=>[se.lat,se.lng]),{color:"#3B82F6",weight:4,opacity:.8}).addTo(g);Z(q);const te=[];if(I.length>0){const se=L.marker([I[0].lat,I[0].lng],{icon:L.divIcon({className:"custom-div-icon",html:'<div style="background-color: #10B981; color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;">S</div>',iconSize:[20,20],iconAnchor:[10,10]})}).bindPopup("Start Point").addTo(g);if(te.push(se),I.length>1){const Ee=L.marker([I[I.length-1].lat,I[I.length-1].lng],{icon:L.divIcon({className:"custom-div-icon",html:'<div style="background-color: #EF4444; color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;">E</div>',iconSize:[20,20],iconAnchor:[10,10]})}).bindPopup("End Point").addTo(g);te.push(Ee)}}if(P(te),I.length>1){const se=L.latLngBounds(I.map(Ee=>[Ee.lat,Ee.lng]));g.fitBounds(se,{padding:[20,20]})}else I.length===1&&g.setView([I[0].lat,I[0].lng],12)},x=async()=>{var I,q;try{const te=localStorage.getItem("token");if(!d||!d._id)throw new Error("No enquiry selected. Please select an enquiry first.");if(d.status!=="pending"&&d.status!=="responded")throw new Error("Cannot create trip from this enquiry. Only pending or responded enquiries can be converted to trips.");const se=f.distanceKm*f.ratePerKm+f.vehicleRent+f.driverBata,Ee={driverId:f.driverId,startCoords:((I=f.waypoints[0])==null?void 0:I.coords)||f.startCoords,endCoords:((q=f.waypoints[f.waypoints.length-1])==null?void 0:q.coords)||f.endCoords,distanceKm:f.distanceKm,ratePerKm:f.ratePerKm,vehicleRent:f.vehicleRent,driverBata:f.driverBata,route:f.route,totalAmount:se},Ce=await fetch(`/api/enquiries/${d._id}/create-trip`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${te}`},body:JSON.stringify(Ee)});if(!Ce.ok){const Ae=await Ce.json();throw console.error("Create trip error response:",Ae),Ce.status===404?new Error("Enquiry not found. Please refresh the page and try again."):Ce.status===403?new Error("You are not authorized to create a trip from this enquiry."):Ce.status===400?new Error(Ae.message||"Invalid request data. Please check all fields."):new Error(Ae.message||"Server error while creating trip")}const Ie=await Ce.json();D.success("Trip created successfully! Payment request sent to customer."),p(!1),y({driverId:"",startCoords:{lat:0,lng:0},endCoords:{lat:0,lng:0},distanceKm:0,ratePerKm:0,vehicleRent:0,driverBata:0,route:[],waypoints:[]}),await X()}catch(te){console.error("Error creating trip:",te),D.error("Failed to create trip: "+te.message),(te.message.includes("Enquiry not found")||te.message.includes("Unauthorized")||te.message.includes("belongs to a different business"))&&(console.log("Refreshing enquiries list due to error"),await X(),p(!1),m(null),D.error("This enquiry is no longer available. Please refresh the page and try again."))}},b=async I=>{try{if(!I||!I._id){D.error("Invalid enquiry selected");return}const q=n.find(se=>se._id===I._id);if(!q){D.error("Enquiry not found. Please refresh the page and try again."),await X();return}const te=q;if(te.status!=="pending"&&te.status!=="responded"){D.error("Cannot create trip from this enquiry. Only pending or responded enquiries can be converted to trips.");return}m(te),p(!0),await ce(),y({driverId:"",startCoords:te.startCoords||{lat:0,lng:0},endCoords:te.endCoords||{lat:0,lng:0},distanceKm:te.distanceKm||0,ratePerKm:0,vehicleRent:0,driverBata:0,route:[],waypoints:[{address:te.startingPoint||"",coords:te.startCoords||null},{address:te.destination||"",coords:te.endCoords||null}]}),te.startCoords&&te.endCoords&&setTimeout(()=>{k()},500)}catch(q){console.error("Error opening create trip modal:",q),D.error("Failed to open trip creation modal: "+q.message)}};v.useEffect(()=>{u&&typeof window<"u"&&window.L&&setTimeout(()=>{if(document.getElementById("trip-map")&&!g){const q=window.L.map("trip-map",{zoomControl:!0,scrollWheelZoom:!1,preferCanvas:!0}).setView([20.5937,78.9629],5);window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:" OpenStreetMap"}).addTo(q),N(q)}},100),!u&&g&&(w.forEach(I=>{g.hasLayer(I)&&g.removeLayer(I)}),P([]),C&&(g.removeLayer(C),Z(null)))},[u,g,w,C]),v.useEffect(()=>{g&&f.waypoints&&f.waypoints.length>=2&&f.waypoints.every(q=>q==null?void 0:q.coords)&&setTimeout(()=>{k()},200)},[g,f.waypoints,k]),v.useEffect(()=>{g&&d&&f.waypoints&&f.waypoints.length>=2&&f.waypoints.every(q=>q==null?void 0:q.coords)&&setTimeout(()=>{k()},300)},[g,d,f.waypoints,k]);const F=I=>{G(I),$(!0)};v.useEffect(()=>{X()},[]);const ee=I=>{switch(I){case"pending":return"bg-yellow-100 text-yellow-800";case"responded":return"bg-blue-100 text-blue-800";case"trip_created":return"bg-green-100 text-green-800";case"confirmed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Customer Enquiries"}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("button",{onClick:X,disabled:o,className:"text-sm px-3 py-1.5 rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:o?"Refreshing...":"Refresh"}),t.jsx("button",{onClick:async()=>{await X(),D.success("Enquiries refreshed")},disabled:o,className:"text-sm px-3 py-1.5 rounded-md bg-green-600 text-white hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:o?"Refreshing...":"Force Refresh"})]})]}),t.jsxs("div",{className:"bg-white shadow rounded-lg",children:[t.jsx("div",{className:"p-4 border-b",children:t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["All Enquiries (",n.length,")"]})}),o?t.jsx("div",{className:"p-6",children:"Loading enquiries..."}):n.length===0?t.jsx("div",{className:"p-6 text-gray-600",children:"No enquiries yet."}):t.jsx("div",{className:"p-4 space-y-4",children:n.map(I=>{var q,te,se,Ee,Ce,Ie,Ae,Xe;return t.jsx("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:t.jsxs("div",{className:"flex items-start justify-between mb-3",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[t.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[(q=I.vehicleId)==null?void 0:q.registeredNumber," - ",(te=I.vehicleId)==null?void 0:te.makersName]}),t.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${ee(I.status)}`,children:I.status.replace("_"," ")})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600 mb-2",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Customer:"})," ",((se=I.customerId)==null?void 0:se.name)||((Ee=I.customerId)==null?void 0:Ee.email)]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Vehicle Class:"})," ",(Ce=I.vehicleId)==null?void 0:Ce.vehicleClass]})]}),t.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:[t.jsx("strong",{children:"Route:"})," ",I.startingPoint,"  ",I.destination]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600 mb-2",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Dates:"})," ",new Date(I.startDate).toLocaleDateString()," - ",new Date(I.endDate).toLocaleDateString()]}),I.distanceKm>0&&t.jsxs("div",{children:[t.jsx("strong",{children:"Distance:"})," ",I.distanceKm," km"]})]}),I.message&&t.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:[t.jsx("strong",{children:"Message:"})," ",I.message]}),((Ie=I.businessResponse)==null?void 0:Ie.message)&&t.jsxs("div",{className:"mt-2 p-2 bg-blue-50 rounded text-sm",children:[t.jsx("strong",{children:"Your Response:"})," ",I.businessResponse.message]}),I.status==="trip_created"&&t.jsxs("div",{className:"mt-2 p-2 bg-green-50 rounded text-sm",children:[t.jsx("strong",{children:"Trip Created!"})," Total: ",(Ae=I.totalAmount)==null?void 0:Ae.toLocaleString(),"  Advance Required: ",(Xe=I.advanceAmount)==null?void 0:Xe.toLocaleString()]})]}),t.jsxs("div",{className:"flex flex-col space-y-2 ml-4",children:[t.jsx("button",{onClick:()=>F(I),className:"bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm",children:"View Details"}),(I.status==="pending"||I.status==="responded")&&t.jsx("button",{onClick:()=>b(I),className:"bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm",children:"Create Trip"})]})]})},I._id)})})]}),u&&d&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:t.jsxs("div",{className:"bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4 p-6 border-b",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Create Trip from Enquiry"}),t.jsx("button",{onClick:()=>p(!1),className:"text-gray-400 hover:text-gray-600",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[(de=d.vehicleId)==null?void 0:de.registeredNumber," - ",(ve=d.vehicleId)==null?void 0:ve.makersName]}),t.jsxs("div",{className:"text-xs text-gray-600",children:[d.startingPoint,"  ",d.destination]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Route"}),t.jsx("div",{className:"space-y-2",children:(be=f.waypoints)==null?void 0:be.map((I,q)=>{var te;return t.jsxs("div",{className:"relative",children:[t.jsx("input",{value:(I==null?void 0:I.address)||"",onChange:se=>V(q,se.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:q===0?"Starting point...":"Destination..."}),((te=M[q])==null?void 0:te.length)>0&&t.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border rounded-lg shadow-lg max-h-40 overflow-auto",children:M[q].map((se,Ee)=>t.jsx("button",{type:"button",onClick:()=>J(q,se),className:"w-full text-left px-3 py-2 hover:bg-gray-100 text-sm",children:se.display},Ee))})]},q)})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Driver"}),t.jsxs("select",{value:f.driverId,onChange:I=>{const q=Q.find(te=>te._id===I.target.value);y(te=>({...te,driverId:I.target.value,driverBata:(q==null?void 0:q.acceptedSalary)||0}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"Select a driver"}),Q.map(I=>t.jsxs("option",{value:I._id,children:[I.name," - ",I.licenseNumber,I.acceptedSalary>0&&` (${I.acceptedSalary}/day)`]},I._id))]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Distance (km)"}),t.jsx("input",{type:"number",value:f.distanceKm,onChange:I=>y(q=>({...q,distanceKm:parseFloat(I.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Distance in km"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rate per km ()"}),t.jsx("input",{type:"number",value:f.ratePerKm,onChange:I=>y(q=>({...q,ratePerKm:parseFloat(I.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Rate per km"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vehicle Rent ()"}),t.jsx("input",{type:"number",value:f.vehicleRent,onChange:I=>y(q=>({...q,vehicleRent:parseFloat(I.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Vehicle rent"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Driver Bata ()"}),t.jsx("input",{type:"number",value:f.driverBata,onChange:I=>y(q=>({...q,driverBata:parseFloat(I.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Driver bata"})]})]}),t.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg",children:[t.jsxs("div",{className:"text-sm text-blue-800",children:[t.jsx("strong",{children:"Total Amount:"})," ",(f.distanceKm*f.ratePerKm+f.vehicleRent+f.driverBata).toLocaleString()]}),t.jsxs("div",{className:"text-xs text-blue-600",children:["Advance Required: ",Math.round((f.distanceKm*f.ratePerKm+f.vehicleRent+f.driverBata)*20/100).toLocaleString()]})]})]}),t.jsx("div",{className:"bg-gray-100 rounded-lg overflow-hidden",children:t.jsx("div",{id:"trip-map",className:"w-full h-96"})})]}),t.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[t.jsx("button",{onClick:()=>p(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg",children:"Cancel"}),t.jsx("button",{onClick:x,disabled:!f.driverId||!f.distanceKm||!f.ratePerKm||!d||d.status!=="pending"&&d.status!=="responded",className:"px-4 py-2 text-sm font-medium text-white bg-green-500 hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed rounded-lg",children:"Create Trip & Send Payment Request"})]})]})]})}),K&&z&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:t.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Enquiry Details"}),t.jsx("button",{onClick:()=>$(!1),className:"text-gray-400 hover:text-gray-600",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Vehicle Information"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Registration:"})," ",(ge=z.vehicleId)==null?void 0:ge.registeredNumber]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Make/Model:"})," ",(fe=z.vehicleId)==null?void 0:fe.makersName]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Class:"})," ",(Ve=z.vehicleId)==null?void 0:Ve.vehicleClass]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Type:"})," ",(Ue=z.vehicleId)==null?void 0:Ue.vehicleType]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Seating:"})," ",(ue=z.vehicleId)==null?void 0:ue.seatingCapacity," seats"]})]})]}),t.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Customer Information"}),t.jsxs("div",{className:"text-sm",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Name:"})," ",((ne=z.customerId)==null?void 0:ne.name)||"N/A"]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Email:"})," ",(oe=z.customerId)==null?void 0:oe.email]})]})]}),t.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Trip Details"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"From:"})," ",z.startingPoint]}),t.jsxs("div",{children:[t.jsx("strong",{children:"To:"})," ",z.destination]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Start Date:"})," ",new Date(z.startDate).toLocaleDateString()]}),t.jsxs("div",{children:[t.jsx("strong",{children:"End Date:"})," ",new Date(z.endDate).toLocaleDateString()]}),z.distanceKm>0&&t.jsxs("div",{children:[t.jsx("strong",{children:"Distance:"})," ",z.distanceKm," km"]})]})]}),z.message&&t.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Customer Message"}),t.jsx("p",{className:"text-sm text-gray-700",children:z.message})]}),((he=z.businessResponse)==null?void 0:he.message)&&t.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Your Response"}),t.jsx("p",{className:"text-sm text-gray-700 mb-2",children:z.businessResponse.message}),t.jsxs("div",{className:"text-xs text-gray-500",children:[t.jsx("strong",{children:"Advance Percentage:"})," ",z.businessResponse.advancePercentage,"%"]}),t.jsxs("div",{className:"text-xs text-gray-500",children:[t.jsx("strong",{children:"Responded:"})," ",new Date(z.businessResponse.respondedAt).toLocaleString()]})]}),z.status==="trip_created"&&t.jsxs("div",{className:"bg-green-100 p-4 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Trip Information"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Total Amount:"})," ",(Le=z.totalAmount)==null?void 0:Le.toLocaleString()]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Advance Required:"})," ",(Re=z.advanceAmount)==null?void 0:Re.toLocaleString()]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Payment Status:"})," ",z.paymentStatus]}),z.tripId&&t.jsxs("div",{children:[t.jsx("strong",{children:"Trip ID:"})," ",z.tripId.trip_id]})]})]}),t.jsxs("div",{className:"bg-gray-100 p-4 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Status"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:`px-3 py-1 rounded-full text-sm ${ee(z.status)}`,children:z.status.replace("_"," ")}),t.jsxs("span",{className:"text-sm text-gray-600",children:["Created: ",new Date(z.createdAt).toLocaleString()]})]})]})]}),t.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[t.jsx("button",{onClick:()=>$(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg",children:"Close"}),z.status==="pending"&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>{$(!1),console.log("Reject enquiry:",z._id)},className:"px-4 py-2 text-sm font-medium text-white bg-red-500 hover:bg-red-600 rounded-lg",children:"Reject"}),t.jsx("button",{onClick:()=>{$(!1),b(z)},className:"px-4 py-2 text-sm font-medium text-white bg-green-500 hover:bg-green-600 rounded-lg",children:"Create Trip"})]})]})]})})]})},Vc=()=>t.jsxs("div",{className:"space-y-6",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Customer Management"}),t.jsx("div",{className:"bg-white shadow rounded-lg p-6",children:t.jsx("p",{className:"text-gray-600",children:"Customer management features will be implemented here."})})]}),Zc=({onLogout:n})=>{var ls,cs;const[a,o]=v.useState("overview"),[c,d]=v.useState({trips:"add",drivers:"available"}),[m,u]=v.useState([]),[p,f]=v.useState(!1),[y,g]=v.useState(!1),[N,C]=v.useState(null),[Z,w]=v.useState(!1),[P,M]=v.useState(null),[W,K]=v.useState(!1),[$,z]=v.useState([]),[G,Q]=v.useState({total:0,active:0,maintenance:0,retired:0}),[Y,X]=v.useState({hired:0,available:0}),[ce,ye]=v.useState({total:0,active:0,completed:0}),[V,J]=v.useState({vehicleImage:null,rcImage:null,registeredNumber:"",makersName:"",registeredOwnerName:"",vehicleClass:"",fuel:"",certificateOfFitnessFrom:"",certificateOfFitnessTo:"",seatingCapacity:"",vehicleType:""}),[k,E]=v.useState(!1),[S,j]=v.useState(!1),[A,x]=v.useState([]),[b,F]=v.useState(!1),[ee,de]=v.useState(null),[ve,be]=v.useState(!1),[ge,fe]=v.useState(null),Ve=v.useRef(null),Ue=v.useRef(null),[ue,ne]=v.useState([]),[oe,he]=v.useState([]),[Le,Re]=v.useState([]),[I,q]=v.useState(!1),[te,se]=v.useState(!1),[Ee,Ce]=v.useState(!1),[Ie,Ae]=v.useState(null),[Xe,nt]=v.useState(!1),[Et,At]=v.useState(!1),[Ps,Ss]=v.useState({message:"",salaryPerDay:""}),[Ge,is]=v.useState(null),[gi,Ts]=v.useState(!1),Es=()=>{n()},rs=B=>{const H=new Date,xe=new Date(B),ie=Math.floor((H-xe)/1e3);return ie<60?"Just now":ie<3600?`${Math.floor(ie/60)}m ago`:ie<86400?`${Math.floor(ie/3600)}h ago`:`${Math.floor(ie/86400)}d ago`};v.useEffect(()=>{as()},[]),v.useEffect(()=>{(a==="fleet"||a==="overview")&&Mt(),a==="hire"&&(ns(),As(),Ct()),a==="overview"&&(xi(),Ms())},[a]);const ns=async()=>{try{q(!0);const B=localStorage.getItem("token");if(!B)return;const H=await fetch("/api/drivers/available",{headers:{Authorization:`Bearer ${B}`,"Content-Type":"application/json"}});if(H.ok){const xe=await H.json();ne(Array.isArray(xe.drivers)?xe.drivers:[])}else console.error("Failed to fetch drivers",H.status),D.error("Failed to fetch drivers")}catch(B){console.error("Error fetching drivers",B),D.error("Error fetching drivers")}finally{q(!1)}},As=async()=>{try{se(!0);const B=localStorage.getItem("token");if(!B)return;const H=await fetch("/api/drivers/hired",{headers:{Authorization:`Bearer ${B}`,"Content-Type":"application/json"}});if(H.ok){const xe=await H.json();he(Array.isArray(xe.drivers)?xe.drivers:[])}else console.error("Failed to fetch hired drivers",H.status),D.error("Failed to fetch hired drivers")}catch(B){console.error("Error fetching hired drivers",B),D.error("Error fetching hired drivers")}finally{se(!1)}},Ct=async()=>{try{Ce(!0);const B=localStorage.getItem("token");if(!B)return;const H=await fetch("/api/job-offers/business",{headers:{Authorization:`Bearer ${B}`,"Content-Type":"application/json"}});if(H.ok){const ie=((await H.json()).jobOffers||[]).filter(Ne=>Ne.status==="pending");Re(ie)}else console.error("Failed to fetch pending offers",H.status),D.error("Failed to fetch pending offers")}catch(B){console.error("Error fetching pending offers",B),D.error("Error fetching pending offers")}finally{Ce(!1)}},Mt=async()=>{try{K(!0);const B=localStorage.getItem("token");if(!B){console.log("No token found, skipping vehicle fetch");return}const H=await fetch("/api/vehicles",{headers:{Authorization:`Bearer ${B}`,"Content-Type":"application/json"}});if(H.ok){const ie=(await H.json()).vehicles||[];u(ie);const Ne={total:ie.length,active:ie.filter(pe=>pe.status==="active").length,maintenance:ie.filter(pe=>pe.status==="maintenance").length,retired:ie.filter(pe=>pe.status==="retired").length};Q(Ne);const ze=ie.sort((pe,Oe)=>new Date(Oe.createdAt||Oe.addedAt)-new Date(pe.createdAt||pe.addedAt)).slice(0,3).map(pe=>({id:`vehicle-${pe._id}`,type:"vehicle_added",message:`Vehicle ${pe.registeredNumber} (${pe.makersName}) was added`,timestamp:pe.createdAt||pe.addedAt,vehicle:{registeredNumber:pe.registeredNumber,makersName:pe.makersName,status:pe.status}}));z(pe=>{const Oe=pe.filter(Be=>Be.type!=="vehicle_added");return[...ze,...Oe].sort((Be,rt)=>new Date(rt.timestamp)-new Date(Be.timestamp)).slice(0,10)}),console.log("Vehicles fetched successfully:",ie.length),console.log("Vehicle stats:",Ne)}else console.error("Failed to fetch vehicles:",H.status)}catch(B){console.error("Error fetching vehicles:",B),B.message.includes("Failed to fetch")&&console.log("Backend server is not running. Please start it with: cd backend && npm run dev")}finally{K(!1)}},xi=async()=>{var B;try{const H=localStorage.getItem("token");if(!H){console.log("No token found for drivers stats");return}console.log("Fetching drivers stats...");const[xe,ie]=await Promise.all([fetch("/api/drivers/available",{headers:{Authorization:`Bearer ${H}`,"Content-Type":"application/json"}}),fetch("/api/drivers/hired",{headers:{Authorization:`Bearer ${H}`,"Content-Type":"application/json"}})]);let Ne=0,ze=0,pe=[];if(console.log("Available drivers response status:",xe.status),console.log("Hired drivers response status:",ie.status),xe.ok?(Ne=((B=(await xe.json()).drivers)==null?void 0:B.length)||0,console.log("Available drivers count:",Ne)):console.error("Failed to fetch available drivers:",xe.status),ie.ok){const rt=(await ie.json()).drivers||[];ze=rt.length,console.log("Hired drivers count:",ze),console.log("Hired drivers data:",rt),pe=rt.sort((Qe,Ht)=>new Date(Ht.updatedAt||Ht.createdAt)-new Date(Qe.updatedAt||Qe.createdAt)).slice(0,3).map(Qe=>({id:`driver-${Qe._id}`,type:"driver_hired",message:`Driver ${Qe.name} was hired`,timestamp:Qe.updatedAt||Qe.createdAt,driver:{name:Qe.name,status:"hired"}}))}else console.error("Failed to fetch hired drivers:",ie.status);const Oe={hired:ze,available:Ne};console.log("Setting drivers stats:",Oe),X(Oe),pe.length>0&&z(Be=>{const rt=Be.filter(Qe=>Qe.type!=="driver_hired");return[...pe,...rt].sort((Qe,Ht)=>new Date(Ht.timestamp)-new Date(Qe.timestamp)).slice(0,10)})}catch(H){console.error("Error fetching drivers stats:",H)}},Ms=async()=>{try{const B=localStorage.getItem("token");if(!B){console.log("No token found for trips stats");return}console.log("Fetching trips stats...");const H=await fetch("/api/trips",{headers:{Authorization:`Bearer ${B}`,"Content-Type":"application/json"}});if(console.log("Trips response status:",H.status),H.ok){const ie=(await H.json()).trips||[];console.log("Trips data:",ie);const Ne={total:ie.length,active:ie.filter(pe=>pe.status==="active").length,completed:ie.filter(pe=>pe.status==="completed").length};console.log("Setting trips stats:",Ne),ye(Ne);const ze=ie.sort((pe,Oe)=>new Date(Oe.createdAt)-new Date(pe.createdAt)).slice(0,3).map(pe=>({id:`trip-${pe._id}`,type:"trip_created",message:`Trip from ${pe.startAddress} to ${pe.endAddress} was created`,timestamp:pe.createdAt,trip:{startAddress:pe.startAddress,endAddress:pe.endAddress,status:pe.status}}));z(pe=>{const Oe=pe.filter(Be=>Be.type!=="trip_created");return[...ze,...Oe].sort((Be,rt)=>new Date(rt.timestamp)-new Date(Be.timestamp)).slice(0,10)})}else console.error("Failed to fetch trips:",H.status)}catch(B){console.error("Error fetching trips stats:",B)}},as=async()=>{try{Ts(!0);const B=localStorage.getItem("token");if(!B){console.log("No token found for business profile");return}const H=await fetch("/api/business/profile",{headers:{Authorization:`Bearer ${B}`,"Content-Type":"application/json"}});if(H.ok){const xe=await H.json();is(xe.business),console.log("Business profile fetched:",xe.business)}else H.status===404?(console.log("Business profile not found - will be created when user opens profile modal"),is(null)):(console.error("Failed to fetch business profile:",H.status),D.error("Failed to load business profile"))}catch(B){console.error("Error fetching business profile:",B),D.error("Error loading business profile")}finally{Ts(!1)}},Ds=(B,H=800,xe=.8)=>new Promise(ie=>{const Ne=document.createElement("canvas"),ze=Ne.getContext("2d"),pe=new Image;pe.onload=()=>{let{width:Oe,height:Be}=pe;Oe>H&&(Be=Be*H/Oe,Oe=H),Ne.width=Oe,Ne.height=Be,ze.drawImage(pe,0,0,Oe,Be);const rt=Ne.toDataURL("image/jpeg",xe);ie(rt)},pe.src=URL.createObjectURL(B)}),Zt=async(B,H)=>{const xe=B.target.files[0];if(xe)try{const ie=await Ds(xe);J(Ne=>({...Ne,[H]:ie})),H==="rcImage"&&(y&&j(!0),await yi(ie),y&&j(!1))}catch(ie){console.error("Error processing image:",ie),D.error("Error processing image. Please try again.")}},yi=async B=>{try{E(!0);const H=localStorage.getItem("token");if(!H){alert("Please login first");return}console.log("Extracting RC data..."),console.log("Image data length:",B.length),console.log("Image data preview:",B.substring(0,100)+"...");const xe=await fetch("/api/vehicles/extract-rc",{method:"POST",headers:{Authorization:`Bearer ${H}`,"Content-Type":"application/json"},body:JSON.stringify({imageUrl:B})});if(xe.ok){const ie=await xe.json();if(console.log("RC extraction response:",ie),console.log("Raw RC data:",ie.data),ie.data){const Ne=[];J(ze=>{var Oe,Be;const pe={...ze,registeredNumber:ie.data.registeredNumber||"",makersName:ie.data.makersName||"",registeredOwnerName:ie.data.registeredOwnerName||"",vehicleClass:ie.data.vehicleClass||"",fuel:ie.data.fuel||"",seatingCapacity:ie.data.seatingCapacity||"",certificateOfFitnessFrom:((Oe=ie.data.certificateOfFitness)==null?void 0:Oe.validFrom)||"",certificateOfFitnessTo:((Be=ie.data.certificateOfFitness)==null?void 0:Be.validTo)||""};return ie.data.registeredNumber&&Ne.push("Registration Number"),ie.data.makersName&&Ne.push("Manufacturer"),ie.data.registeredOwnerName&&Ne.push("Owner Name"),ie.data.vehicleClass&&Ne.push("Vehicle Class"),ie.data.fuel&&Ne.push("Fuel Type"),ie.data.seatingCapacity&&ie.data.seatingCapacity!==null&&ie.data.seatingCapacity!=="null"?(console.log("Seating capacity found:",ie.data.seatingCapacity),Ne.push("Seating Capacity")):console.log("Seating capacity NOT found in RC data, will remain empty"),pe}),x(Ne),console.log("RC data extracted successfully"),D.success(`Updated: ${Ne.join(", ")}`),setTimeout(()=>{x([])},3e3)}else console.warn("No data extracted from RC image")}else{const ie=await xe.json();console.error("RC extraction failed:",ie),console.error("Response status:",xe.status),console.error("Response headers:",xe.headers),D.error("Failed to extract RC data: "+(ie.message||"Unknown error"))}}catch(H){console.error("Error extracting RC data:",H),H.message.includes("Failed to fetch")?alert("Cannot connect to server. Please make sure the backend is running on http://localhost:4000"):alert("Error extracting RC data: "+H.message)}finally{E(!1)}},dt=()=>{J({vehicleImage:null,rcImage:null,registeredNumber:"",makersName:"",registeredOwnerName:"",vehicleClass:"",fuel:"",certificateOfFitnessFrom:"",certificateOfFitnessTo:"",seatingCapacity:"",vehicleType:""}),Ve.current&&(Ve.current.value=""),Ue.current&&(Ue.current.value="")},Os=B=>{var H,xe;C(B),J({vehicleImage:null,rcImage:null,registeredNumber:B.registeredNumber||"",makersName:B.makersName||"",registeredOwnerName:B.registeredOwnerName||"",vehicleClass:B.vehicleClass||"",fuel:B.fuel||"",certificateOfFitnessFrom:(H=B.certificateOfFitness)!=null&&H.validFrom?new Date(B.certificateOfFitness.validFrom).toISOString().split("T")[0]:"",certificateOfFitnessTo:(xe=B.certificateOfFitness)!=null&&xe.validTo?new Date(B.certificateOfFitness.validTo).toISOString().split("T")[0]:"",seatingCapacity:B.seatingCapacity||"",vehicleType:B.vehicleType||""}),g(!0)},vi=B=>{M(B),w(!0)},vt=B=>A.includes(B),os=B=>{de(B),F(!0)},bi=async()=>{if(ee)try{const B=localStorage.getItem("token"),H=await fetch(`/api/vehicles/${ee}`,{method:"DELETE",headers:{Authorization:`Bearer ${B}`,"Content-Type":"application/json"}});if(H.ok)D.success("Vehicle deleted successfully!"),Mt();else{const xe=await H.json();D.error("Error deleting vehicle: "+xe.message)}}catch(B){console.error("Error deleting vehicle:",B),D.error("Error deleting vehicle: "+B.message)}finally{F(!1),de(null)}},_i=()=>{F(!1),de(null)},Rs=(B,H)=>{fe({url:B,alt:H}),be(!0)},wi=()=>{be(!1),fe(null)},at=async B=>{B.preventDefault();try{K(!0);const H=localStorage.getItem("token"),xe=await fetch(`/api/vehicles/${N._id}/images`,{method:"PUT",headers:{Authorization:`Bearer ${H}`,"Content-Type":"application/json"},body:JSON.stringify({vehicleImage:V.vehicleImage,rcImage:V.rcImage,registeredNumber:V.registeredNumber,makersName:V.makersName,registeredOwnerName:V.registeredOwnerName,vehicleClass:V.vehicleClass,fuel:V.fuel,certificateOfFitness:{validFrom:V.certificateOfFitnessFrom,validTo:V.certificateOfFitnessTo},seatingCapacity:parseInt(V.seatingCapacity),vehicleType:V.vehicleType})});if(xe.ok){const ie=await xe.json();console.log("Vehicle updated successfully:",ie),g(!1),C(null),dt(),Mt(),D.success("Vehicle updated successfully!")}else{const ie=await xe.json();D.error("Error updating vehicle: "+ie.message)}}catch(H){console.error("Error updating vehicle:",H),D.error("Error updating vehicle: "+H.message)}finally{K(!1)}},ae=async B=>{B.preventDefault();try{K(!0);const H=localStorage.getItem("token");console.log("=== FRONTEND DEBUG ==="),console.log("Token from localStorage:",H?`${H.substring(0,20)}...`:"Missing"),console.log("Authorization header:",`Bearer ${H}`),console.log("Vehicle form data:",V);const xe=await fetch("/api/vehicles",{method:"POST",headers:{Authorization:`Bearer ${H}`,"Content-Type":"application/json"},body:JSON.stringify({vehicleImage:V.vehicleImage,rcImage:V.rcImage,registeredNumber:V.registeredNumber,makersName:V.makersName,registeredOwnerName:V.registeredOwnerName,vehicleClass:V.vehicleClass,fuel:V.fuel,certificateOfFitness:{validFrom:V.certificateOfFitnessFrom,validTo:V.certificateOfFitnessTo},seatingCapacity:parseInt(V.seatingCapacity)||null,vehicleType:V.vehicleType})});if(xe.ok){const ie=await xe.json();console.log("Vehicle added successfully:",ie),f(!1),dt();const Ne={id:ie.vehicle.id,type:"vehicle_added",message:`Vehicle ${ie.vehicle.registeredNumber} (${ie.vehicle.makersName}) was added`,timestamp:new Date().toISOString(),vehicle:{registeredNumber:ie.vehicle.registeredNumber,makersName:ie.vehicle.makersName,status:ie.vehicle.status}};z(ze=>[Ne,...ze.slice(0,4)]),Q(ze=>({...ze,total:ze.total+1,active:ie.vehicle.status==="active"?ze.active+1:ze.active})),Mt(),D.success("Vehicle added successfully!")}else{const ie=await xe.json();D.error("Error adding vehicle: "+ie.message),dt()}}catch(H){console.error("Error adding vehicle:",H),D.error("Error adding vehicle: "+H.message),dt()}finally{K(!1)}};return t.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[t.jsxs("div",{className:"w-64 bg-white shadow-lg flex flex-col sticky top-0 h-screen",children:[t.jsx("div",{className:"p-6 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"h-8 w-8 bg-yellow-500 rounded-lg flex items-center justify-center mr-3",children:t.jsxs("svg",{className:"h-5 w-5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:[t.jsx("path",{d:"M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"}),t.jsx("path",{d:"M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1V5a1 1 0 00-1-1H3zM14 7a1 1 0 00-1 1v6.05A2.5 2.5 0 0115.95 14H17a1 1 0 001-1V8a1 1 0 00-1-1h-3z"})]})}),t.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"MobiTrak Business"})]})}),t.jsx("nav",{className:"flex-1 px-4 py-6 space-y-2",children:[{id:"overview",name:"Overview",icon:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"},{id:"fleet",name:"Fleet Management",icon:"M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"},{id:"enquiries",name:"Customer Enquiries",icon:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"},{id:"pending-trips",name:"Pending Trips",icon:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"},{id:"hire",name:"Hire Drivers",icon:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"},{id:"driver-management",name:"Driver Management",icon:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"},{id:"trips",name:"Trips",icon:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"},{id:"reports",name:"Reports",icon:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"},{id:"profile",name:"Profile",icon:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"}].map(B=>t.jsxs("button",{onClick:()=>o(B.id),className:`w-full flex items-center px-4 py-3 text-sm font-medium rounded-lg transition-colors ${a===B.id?"bg-yellow-100 text-yellow-700 border-r-2 border-yellow-500":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"}`,children:[t.jsx("svg",{className:"h-5 w-5 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:B.icon})}),B.name]},B.id))}),t.jsxs("div",{className:"p-4 border-t border-gray-200",children:[t.jsxs("div",{className:"flex items-center mb-4",children:[t.jsx("div",{className:"h-12 w-12 bg-gray-300 rounded-full flex items-center justify-center mr-3 overflow-hidden",children:Ge!=null&&Ge.profileIcon?t.jsx("img",{src:Ge.profileIcon,alt:"Profile",className:"h-full w-full object-cover"}):t.jsx("svg",{className:"h-6 w-6 text-gray-600",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:(Ge==null?void 0:Ge.companyName)||"Business Name"}),t.jsx("p",{className:"text-xs text-gray-500 truncate",children:(Ge==null?void 0:Ge.ownerName)||"Owner Name"}),(Ge==null?void 0:Ge.address)&&t.jsxs("p",{className:"text-xs text-gray-400 truncate",children:[Ge.address.city,", ",Ge.address.state]})]})]}),t.jsx("button",{onClick:Es,className:"w-full bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors",children:"Logout"})]})]}),t.jsx("div",{className:"flex-1 flex flex-col min-h-screen",children:t.jsx("main",{className:"flex-1 py-8 px-6",children:t.jsxs("div",{className:"max-w-7xl mx-auto",children:[a==="overview"&&t.jsx(Ec,{vehicleStats:G,recentActivity:$,formatTimeAgo:rs,driversStats:Y,tripsStats:ce}),a==="fleet"&&t.jsx(Ac,{vehicles:m,loading:W,clearVehicleForm:dt,setShowAddVehicle:f,handleViewVehicleDetails:vi,handleEditVehicle:Os,handleDeleteVehicle:os}),a==="enquiries"&&t.jsx(Fc,{}),a==="pending-trips"&&t.jsx(sa,{}),a==="hire"&&t.jsx(Mc,{activeSubTab:c,setActiveSubTab:d,drivers:ue,hiredDrivers:oe,pendingOffers:Le,driversLoading:I,hiredDriversLoading:te,pendingOffersLoading:Ee,fetchAvailableDrivers:ns,fetchHiredDrivers:As,fetchPendingOffers:Ct,selectedDriver:Ie,showDriverDetails:Xe,setSelectedDriver:Ae,setShowDriverDetails:nt,offerForm:Ps,setOfferForm:Ss,showOfferModal:Et,setShowOfferModal:At}),a==="driver-management"&&t.jsx(Dc,{}),a==="customers"&&t.jsx(Vc,{}),a==="reports"&&t.jsx(Oc,{}),a==="trips"&&t.jsx(zc,{activeSubTab:c,setActiveSubTab:d,vehicles:m,fetchVehicles:Mt}),a==="profile"&&t.jsx(Bc,{onProfileUpdate:as})]})})}),p&&t.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:t.jsx("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:t.jsxs("div",{className:"mt-3",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Add New Vehicle"}),t.jsx("button",{onClick:()=>{dt(),f(!1)},className:"text-gray-400 hover:text-gray-600",children:t.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("form",{onSubmit:ae,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vehicle Image (Optional)"}),t.jsx("input",{ref:Ve,type:"file",accept:"image/*",onChange:B=>Zt(B,"vehicleImage"),className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),V.vehicleImage&&t.jsx("div",{className:"mt-2",children:t.jsx("img",{src:V.vehicleImage,alt:"Vehicle preview",className:"h-32 w-32 object-cover rounded-lg"})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"RC Book Image (Required) *"}),t.jsx("input",{ref:Ue,type:"file",accept:"image/*",onChange:B=>Zt(B,"rcImage"),required:!0,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),V.rcImage&&t.jsx("div",{className:"mt-2",children:t.jsx("img",{src:V.rcImage,alt:"RC preview",className:"h-32 w-32 object-cover rounded-lg"})}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Upload a clear image of your vehicle's RC book. We'll automatically extract the details."}),k&&t.jsxs("div",{className:"mt-2 flex items-center text-blue-600",children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),t.jsx("span",{className:"text-sm",children:"Extracting RC data..."})]})]}),t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-3",children:"RC Book Information (Auto-filled)"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Registered Number"}),t.jsx("input",{type:"text",value:V.registeredNumber,onChange:B=>J(H=>({...H,registeredNumber:B.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",placeholder:"Auto-filled from RC"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Maker's Name"}),t.jsx("input",{type:"text",value:V.makersName,onChange:B=>J(H=>({...H,makersName:B.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",placeholder:"Auto-filled from RC"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name of Regd Owner"}),t.jsx("input",{type:"text",value:V.registeredOwnerName,onChange:B=>J(H=>({...H,registeredOwnerName:B.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",placeholder:"Auto-filled from RC"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Class of Vehicle"}),t.jsx("input",{type:"text",value:V.vehicleClass,onChange:B=>J(H=>({...H,vehicleClass:B.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",placeholder:"Auto-filled from RC"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fuel"}),t.jsx("input",{type:"text",value:V.fuel,onChange:B=>J(H=>({...H,fuel:B.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",placeholder:"Auto-filled from RC"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Certificate of Fitness Valid From"}),t.jsx("input",{type:"date",value:V.certificateOfFitnessFrom,onChange:B=>J(H=>({...H,certificateOfFitnessFrom:B.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Certificate of Fitness Valid To"}),t.jsx("input",{type:"date",value:V.certificateOfFitnessTo,onChange:B=>J(H=>({...H,certificateOfFitnessTo:B.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Seating Capacity"}),t.jsx("input",{type:"number",value:V.seatingCapacity,onChange:B=>J(H=>({...H,seatingCapacity:B.target.value})),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${vt("Seating Capacity")?"border-green-500 bg-green-50 text-green-800":"border-gray-300 bg-white"}`,placeholder:V.seatingCapacity?"Auto-filled from RC":"Not found in RC - Enter manually",min:"1",max:"100"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vehicle Type *"}),t.jsxs("select",{value:V.vehicleType,onChange:B=>J(H=>({...H,vehicleType:B.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",required:!0,children:[t.jsx("option",{value:"",children:"Select Vehicle Type"}),t.jsx("option",{value:"Logistics",children:"Logistics"}),t.jsx("option",{value:"Passenger",children:"Passenger"})]})]}),t.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[t.jsx("button",{type:"button",onClick:()=>{dt(),f(!1)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:W||!V.rcImage||k,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 rounded-md flex items-center",children:W?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Adding..."]}):k?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Extracting RC..."]}):"Add Vehicle"})]})]})]})})}),y&&t.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:t.jsx("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:t.jsxs("div",{className:"mt-3",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Edit Vehicle"}),t.jsx("button",{onClick:()=>{dt(),g(!1),C(null)},className:"text-gray-400 hover:text-gray-600",children:t.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("form",{onSubmit:at,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vehicle Image (Optional)"}),t.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Upload a new image to replace the current one, or leave empty to keep the existing image."}),t.jsx("input",{ref:Ve,type:"file",accept:"image/*",onChange:B=>Zt(B,"vehicleImage"),className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),V.vehicleImage&&t.jsx("div",{className:"mt-2",children:t.jsx("img",{src:V.vehicleImage,alt:"Vehicle preview",className:"h-32 w-32 object-cover rounded-lg"})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"RC Document (Required)"}),t.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Upload a new RC document to replace the current one, or leave empty to keep the existing document."}),t.jsx("input",{ref:Ue,type:"file",accept:"image/*",onChange:B=>Zt(B,"rcImage"),className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),V.rcImage&&t.jsx("div",{className:"mt-2",children:t.jsx("img",{src:V.rcImage,alt:"RC preview",className:"h-32 w-32 object-cover rounded-lg"})}),S&&t.jsxs("div",{className:"mt-2 flex items-center text-blue-600",children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),t.jsx("span",{className:"text-sm",children:"Extracting RC data..."})]})]}),t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-3",children:"RC Book Information (Auto-filled)"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Registered Number"}),t.jsx("input",{type:"text",value:V.registeredNumber,onChange:B=>J(H=>({...H,registeredNumber:B.target.value})),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${vt("Registration Number")?"border-green-500 bg-green-50 text-green-800":"border-gray-300 bg-white"}`,placeholder:"Auto-filled from RC"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Maker's Name"}),t.jsx("input",{type:"text",value:V.makersName,onChange:B=>J(H=>({...H,makersName:B.target.value})),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${vt("Manufacturer")?"border-green-500 bg-green-50 text-green-800":"border-gray-300 bg-white"}`,placeholder:"Auto-filled from RC"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name of Regd Owner"}),t.jsx("input",{type:"text",value:V.registeredOwnerName,onChange:B=>J(H=>({...H,registeredOwnerName:B.target.value})),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${vt("Owner Name")?"border-green-500 bg-green-50 text-green-800":"border-gray-300 bg-white"}`,placeholder:"Auto-filled from RC"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Class of Vehicle"}),t.jsx("input",{type:"text",value:V.vehicleClass,onChange:B=>J(H=>({...H,vehicleClass:B.target.value})),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${vt("Vehicle Class")?"border-green-500 bg-green-50 text-green-800":"border-gray-300 bg-white"}`,placeholder:"Auto-filled from RC"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fuel"}),t.jsx("input",{type:"text",value:V.fuel,onChange:B=>J(H=>({...H,fuel:B.target.value})),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${vt("Fuel Type")?"border-green-500 bg-green-50 text-green-800":"border-gray-300 bg-white"}`,placeholder:"Auto-filled from RC"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Certificate of Fitness Valid From"}),t.jsx("input",{type:"date",value:V.certificateOfFitnessFrom,onChange:B=>J(H=>({...H,certificateOfFitnessFrom:B.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Certificate of Fitness Valid To"}),t.jsx("input",{type:"date",value:V.certificateOfFitnessTo,onChange:B=>J(H=>({...H,certificateOfFitnessTo:B.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Seating Capacity"}),t.jsx("input",{type:"number",value:V.seatingCapacity,onChange:B=>J(H=>({...H,seatingCapacity:B.target.value})),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${vt("Seating Capacity")?"border-green-500 bg-green-50 text-green-800":"border-gray-300 bg-white"}`,placeholder:V.seatingCapacity?"Auto-filled from RC":"Not found in RC - Enter manually",min:"1",max:"100"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vehicle Type *"}),t.jsxs("select",{value:V.vehicleType,onChange:B=>J(H=>({...H,vehicleType:B.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",required:!0,children:[t.jsx("option",{value:"",children:"Select Vehicle Type"}),t.jsx("option",{value:"Logistics",children:"Logistics"}),t.jsx("option",{value:"Passenger",children:"Passenger"})]})]}),t.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[t.jsx("button",{type:"button",onClick:()=>{dt(),g(!1),C(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:W,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 rounded-md flex items-center",children:W?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Updating..."]}):"Update Vehicle"})]})]})]})})}),Z&&P&&t.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:t.jsx("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:t.jsxs("div",{className:"mt-3",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Vehicle Details"}),t.jsx("button",{onClick:()=>{w(!1),M(null)},className:"text-gray-400 hover:text-gray-600",children:t.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[((ls=P.vehicleImage)==null?void 0:ls.url)&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Vehicle Image"}),t.jsx("img",{src:P.vehicleImage.url,alt:"Vehicle",className:"w-full h-48 object-cover rounded-md cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>Rs(P.vehicleImage.url,"Vehicle")})]}),((cs=P.rcImage)==null?void 0:cs.url)&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"RC Document"}),t.jsx("img",{src:P.rcImage.url,alt:"RC Document",className:"w-full h-48 object-cover rounded-md cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>Rs(P.rcImage.url,"RC Document")})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Registration Number"}),t.jsx("p",{className:"mt-1 text-sm text-gray-900",children:P.registeredNumber})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Maker's Name"}),t.jsx("p",{className:"mt-1 text-sm text-gray-900",children:P.makersName})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Registered Owner"}),t.jsx("p",{className:"mt-1 text-sm text-gray-900",children:P.registeredOwnerName})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Vehicle Class"}),t.jsx("p",{className:"mt-1 text-sm text-gray-900",children:P.vehicleClass})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Fuel Type"}),t.jsx("p",{className:"mt-1 text-sm text-gray-900",children:P.fuel})]})]}),t.jsxs("div",{className:"space-y-4",children:[P.vehicleType&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Vehicle Type"}),t.jsx("p",{className:"mt-1 text-sm text-gray-900",children:P.vehicleType})]}),P.seatingCapacity&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Seating Capacity"}),t.jsxs("p",{className:"mt-1 text-sm text-gray-900",children:[P.seatingCapacity," seats"]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Added On"}),t.jsx("p",{className:"mt-1 text-sm text-gray-900",children:P.createdAt?new Date(P.createdAt).toLocaleString():"N/A"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Last Updated"}),t.jsx("p",{className:"mt-1 text-sm text-gray-900",children:P.lastUpdated?new Date(P.lastUpdated).toLocaleString():"N/A"})]})]})]}),P.certificateOfFitness&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Certificate of Fitness"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-500",children:"Valid From"}),t.jsx("p",{className:"text-sm text-gray-900",children:P.certificateOfFitness.validFrom?new Date(P.certificateOfFitness.validFrom).toLocaleDateString():"N/A"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-500",children:"Valid To"}),t.jsx("p",{className:"text-sm text-gray-900",children:P.certificateOfFitness.validTo?new Date(P.certificateOfFitness.validTo).toLocaleDateString():"N/A"})]})]})]})]}),t.jsxs("div",{className:"flex justify-end space-x-3 mt-6 pt-4 border-t",children:[t.jsx("button",{onClick:()=>{w(!1),M(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Close"}),t.jsx("button",{onClick:()=>{w(!1),M(null),Os(P)},className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md",children:"Edit Vehicle"})]})]})})}),ve&&ge&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 overflow-y-auto h-full w-full z-50 flex items-center justify-center",children:t.jsxs("div",{className:"relative max-w-4xl max-h-full p-4",children:[t.jsx("button",{onClick:wi,className:"absolute top-4 right-4 text-white hover:text-gray-300 z-10",children:t.jsx("svg",{className:"h-8 w-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),t.jsx("img",{src:ge.url,alt:ge.alt,className:"max-w-full max-h-full object-contain rounded-lg"})]})}),b&&t.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:t.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:t.jsxs("div",{className:"mt-3 text-center",children:[t.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100",children:t.jsx("svg",{className:"h-6 w-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mt-4",children:"Delete Vehicle"}),t.jsx("div",{className:"mt-2 px-7 py-3",children:t.jsx("p",{className:"text-sm text-gray-500",children:"Are you sure you want to delete this vehicle? This action cannot be undone and will permanently remove the vehicle and all associated images."})}),t.jsxs("div",{className:"flex justify-center space-x-3 mt-4",children:[t.jsx("button",{onClick:_i,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Cancel"}),t.jsx("button",{onClick:bi,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500",children:"Delete Vehicle"})]})]})})}),t.jsx(dr,{position:"top-right"})]})},Hc=({isOpen:n,onClose:a,vehicle:o,onSubmit:c})=>{var ye,V,J,k,E,S;const d=v.useRef(null),m=v.useRef(null),u=v.useRef(null),p=v.useRef([]),[f,y]=v.useState({waypoints:[{address:"",coords:null},{address:"",coords:null}],startDate:"",endDate:"",message:"",route:[],distanceKm:0}),[g,N]=v.useState({}),[C,Z]=v.useState(!1);v.useEffect(()=>{n&&!m.current&&d.current&&(m.current=Ye.map(d.current,{zoomControl:!0,scrollWheelZoom:!1,preferCanvas:!0}).setView([20.5937,78.9629],5),Ye.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:" OpenStreetMap"}).addTo(m.current))},[n]),v.useEffect(()=>{n?(y({waypoints:[{address:"",coords:null},{address:"",coords:null}],startDate:"",endDate:"",message:"",route:[],distanceKm:0}),N({})):(u.current&&m.current&&(m.current.removeLayer(u.current),u.current=null),p.current.forEach(j=>{m.current&&m.current.removeLayer(j)}),p.current=[])},[n]);const w=async j=>{if(!j||j.length<3)return[];try{const A=`/api/maps/search-places?q=${encodeURIComponent(j)}&limit=5&countrycodes=IN`,x=await fetch(A,{headers:{Accept:"application/json","Content-Type":"application/json"}});if(!x.ok){console.error("Search service error:",x.status,x.statusText);try{const F=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(j)}&limit=5&countrycodes=IN`,ee=await fetch(F,{headers:{"User-Agent":"Mobitrak/1.0","Accept-Language":"en"}});if(ee.ok)return(await ee.json()).map(ve=>({display:ve.display_name,lat:parseFloat(ve.lat),lng:parseFloat(ve.lon)}))}catch(F){console.error("Fallback search also failed:",F)}throw new Error("Search service unavailable")}return(await x.json()).map(F=>({display:F.display,lat:F.lat,lng:F.lng}))}catch(A){return console.error("Search error:",A),[]}},P=async(j,A)=>{y(x=>{const b={...x};return b.waypoints[j]={...b.waypoints[j]||{},address:A},b});try{const x=await w(A);N(b=>({...b,[j]:x}))}catch(x){console.error("Search error:",x)}},M=(j,A)=>{if(y(x=>{const b={...x};return b.waypoints[j]={address:A.display,coords:{lat:A.lat,lng:A.lng}},b}),m.current&&m.current.setView([A.lat,A.lng],12),N(x=>({...x,[j]:[]})),m.current){const x=Ye.icon({iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",iconSize:[25,41],iconAnchor:[12,41],shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png"}),b=Ye.marker([A.lat,A.lng],{icon:x}).bindPopup(A.display);p.current[j]&&m.current.removeLayer(p.current[j]),b.addTo(m.current),p.current[j]=b}},W=()=>{y(j=>({...j,waypoints:[...j.waypoints||[],{address:"",coords:null}]}))},K=j=>{y(A=>{const x={...A};return x.waypoints=x.waypoints.filter((b,F)=>F!==j),x})},$=(j,A)=>{y(x=>{const b={...x},F=[...b.waypoints],ee=F.splice(j,1)[0];return F.splice(A,0,ee),b.waypoints=F,b})},z=j=>{if(!m.current)return;u.current&&(m.current.removeLayer(u.current),u.current=null),u.current=Ye.polyline(j.map(x=>[x.lat,x.lng]),{color:"blue",weight:4}).addTo(m.current);const A=u.current.getBounds();m.current.fitBounds(A,{padding:[20,20]})},G=async()=>{if(!f.waypoints||f.waypoints.length<2)return;const j=f.waypoints.filter(A=>A==null?void 0:A.coords).map(A=>`${A.coords.lng},${A.coords.lat}`);if(!(j.length<2))try{const A=`/api/maps/osrm?coords=${encodeURIComponent(j.join(";"))}`,x=await fetch(A);if(x.ok){const b=await x.json();if(b.routes&&b.routes[0]){const F=b.routes[0],ee=F.geometry.coordinates.map(([ve,be])=>({lat:be,lng:ve})),de=+(F.distance/1e3).toFixed(2);y(ve=>({...ve,route:ee,distanceKm:de})),z(ee)}}else throw new Error("Backend route failed")}catch{try{const x=`https://router.project-osrm.org/route/v1/driving/${j.join(";")}?overview=full&geometries=geojson`,b=`https://corsproxy.io/?${encodeURIComponent(x)}`,F=await fetch(b);if(F.ok){const ee=await F.json();if(ee.routes&&ee.routes[0]){const de=ee.routes[0],ve=de.geometry.coordinates.map(([ge,fe])=>({lat:fe,lng:ge})),be=+(de.distance/1e3).toFixed(2);y(ge=>({...ge,route:ve,distanceKm:be})),z(ve)}}}catch(x){console.error("Route calculation failed:",x),D.error("Failed to calculate route")}}};v.useEffect(()=>{G()},[JSON.stringify(f.waypoints)]);const Q=async j=>{var F,ee,de,ve;if(j.preventDefault(),!((F=f.waypoints[0])!=null&&F.address)||!((ee=f.waypoints[1])!=null&&ee.address)||!f.startDate||!f.endDate){D.error("Please fill in all required fields");return}if(!((de=f.waypoints[0])!=null&&de.coords)||!((ve=f.waypoints[1])!=null&&ve.coords)){D.error("Please select valid locations from the suggestions");return}const A=new Date(f.startDate),x=new Date(f.endDate),b=new Date;if(b.setHours(0,0,0,0),A<b){D.error("Start date cannot be in the past");return}if(x<A){D.error("End date cannot be before start date");return}if(f.distanceKm>=350&&x.getTime()===A.getTime()){D.error("For distances 350km or more, end date must be after start date");return}if(x.getTime()===A.getTime()&&f.distanceKm===0){D.error("Please calculate the route first to determine if same-day trip is allowed");return}try{Z(!0);const be={vehicleId:o._id,startingPoint:f.waypoints[0].address,destination:f.waypoints[f.waypoints.length-1].address,startDate:f.startDate,endDate:f.endDate,message:f.message,startCoords:f.waypoints[0].coords,endCoords:f.waypoints[f.waypoints.length-1].coords,route:f.route,distanceKm:f.distanceKm};await c(be),a()}catch(be){console.error("Submit error:",be),D.error("Failed to submit enquiry")}finally{Z(!1)}},Y=()=>new Date().toISOString().split("T")[0],X=()=>{const j=new Date;return j.setMonth(j.getMonth()+2),j.toISOString().split("T")[0]},ce=()=>f.distanceKm>=350&&f.startDate||Y();return n?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full h-[90vh] overflow-hidden flex flex-col",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Send Enquiry"}),t.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 text-2xl",children:""})]}),o&&t.jsxs("div",{className:"bg-gray-50 p-4 border-b",children:[t.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Vehicle Information"}),t.jsxs("div",{className:"text-sm text-gray-600",children:[t.jsxs("div",{className:"font-medium",children:[o.registeredNumber," - ",o.makersName]}),t.jsxs("div",{children:[o.vehicleClass,"  ",o.vehicleType,"  Seating: ",o.seatingCapacity]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 p-6 flex-1 overflow-hidden",children:[t.jsx("div",{className:"space-y-4 overflow-y-auto",children:t.jsxs("form",{onSubmit:Q,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Route"}),t.jsx("button",{type:"button",onClick:W,className:"text-yellow-600 hover:text-yellow-800 text-sm",children:"Add destination"})]}),t.jsxs("div",{className:"space-y-3",children:[f.waypoints.map((j,A)=>t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{value:j.address||"",onChange:x=>P(A,x.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500",placeholder:A===0?"Choose starting point...":A===f.waypoints.length-1?"Choose destination...":`Stop ${A}`}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{type:"button",onClick:()=>$(A,Math.max(0,A-1)),disabled:A===0,className:"p-2 rounded border disabled:opacity-40",title:"Move up",children:""}),t.jsx("button",{type:"button",onClick:()=>$(A,Math.min(f.waypoints.length-1,A+1)),disabled:A===f.waypoints.length-1,className:"p-2 rounded border disabled:opacity-40",title:"Move down",children:""}),t.jsx("button",{type:"button",onClick:()=>K(A),disabled:f.waypoints.length<=2&&(A===0||A===f.waypoints.length-1),className:"p-2 rounded border disabled:opacity-40",title:"Remove",children:""})]})]}),Array.isArray(g[A])&&g[A].length>0&&t.jsx("div",{className:"absolute z-20 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-40 overflow-auto",children:g[A].map((x,b)=>t.jsx("button",{type:"button",onClick:()=>M(A,x),className:"w-full text-left px-3 py-2 hover:bg-yellow-50 hover:text-yellow-800",children:x.display},`wg-${A}-${b}`))})]},A)),f.waypoints.length<2&&t.jsx("p",{className:"text-xs text-gray-500",children:"Add at least a start and a destination."})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date *"}),t.jsx("input",{type:"date",min:Y(),max:X(),value:f.startDate,onChange:j=>y(A=>({...A,startDate:j.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date *"}),t.jsx("input",{type:"date",min:ce(),max:X(),value:f.endDate,onChange:j=>y(A=>({...A,endDate:j.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500",required:!0})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Message (Optional)"}),t.jsx("textarea",{value:f.message,onChange:j=>y(A=>({...A,message:j.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500",placeholder:"Any additional requirements or questions...",rows:3,maxLength:500}),t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[f.message.length,"/500 characters"]})]}),f.distanceKm>0&&t.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-3",children:t.jsxs("div",{className:"text-sm text-yellow-800",children:[t.jsx("div",{className:"font-medium",children:"Route Information"}),t.jsxs("div",{children:["Distance: ",f.distanceKm," km"]}),t.jsxs("div",{children:["Route: ",(ye=f.waypoints[0])==null?void 0:ye.address,"  ",(V=f.waypoints[f.waypoints.length-1])==null?void 0:V.address]}),f.distanceKm<350&&t.jsx("div",{className:"text-xs mt-1 text-yellow-600",children:"* Same day trips allowed for distances under 350km"})]})}),t.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[t.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:C||!((J=f.waypoints[0])!=null&&J.address)||!((k=f.waypoints[1])!=null&&k.address)||!f.startDate||!f.endDate||!((E=f.waypoints[0])!=null&&E.coords)||!((S=f.waypoints[1])!=null&&S.coords),className:"px-4 py-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700 disabled:bg-gray-400",children:C?"Sending...":"Send Enquiry"})]})]})}),t.jsx("div",{className:"bg-gray-100 rounded-lg overflow-hidden h-full",children:t.jsx("div",{ref:d,className:"w-full h-full"})})]})]})}):null},$c=()=>{const[n,a]=v.useState([]),[o,c]=v.useState(!1),[d,m]=v.useState({search:"",vehicleClass:"",vehicleType:"",minSeatingCapacity:"",maxSeatingCapacity:"",startDate:"",endDate:""}),[u,p]=v.useState(null),[f,y]=v.useState(!1),g=async()=>{try{c(!0);const w=new URLSearchParams;Object.entries(d).forEach(([W,K])=>{K&&w.append(W,K)});const P=await fetch(`/api/enquiries/vehicles?${w}`);if(!P.ok)throw new Error("Failed to load vehicles");const M=await P.json();a(M.vehicles||[])}catch(w){console.error("Error fetching vehicles:",w),D.error("Failed to load vehicles")}finally{c(!1)}},N=async w=>{try{const P=localStorage.getItem("token"),M=await fetch("/api/enquiries/submit",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${P}`},body:JSON.stringify({vehicleId:u._id,...w})});if(!M.ok){const K=await M.json();throw console.error("Enquiry submission error:",K),new Error(K.message||"Failed to submit enquiry")}const W=await M.json();console.log("Enquiry submitted successfully:",W),D.success("Enquiry submitted successfully"),y(!1),p(null)}catch(P){throw console.error("Error submitting enquiry:",P),D.error("Failed to submit enquiry"),P}},C=(w,P)=>{m(M=>({...M,[w]:P}))},Z=w=>{p(w),y(!0)};return v.useEffect(()=>{g()},[]),v.useEffect(()=>{const w=setTimeout(()=>{g()},500);return()=>clearTimeout(w)},[d]),t.jsxs("div",{className:"space-y-6",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Find Vehicles"}),t.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-7 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search"}),t.jsx("input",{type:"text",value:d.search,onChange:w=>C("search",w.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Vehicle number, make, class..."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vehicle Class"}),t.jsxs("select",{value:d.vehicleClass,onChange:w=>C("vehicleClass",w.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500",children:[t.jsx("option",{value:"",children:"All Classes"}),t.jsx("option",{value:"LMV",children:"LMV"}),t.jsx("option",{value:"HMV",children:"HMV"}),t.jsx("option",{value:"MCWG",children:"MCWG"}),t.jsx("option",{value:"MCC",children:"MCC"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vehicle Type"}),t.jsxs("select",{value:d.vehicleType,onChange:w=>C("vehicleType",w.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500",children:[t.jsx("option",{value:"",children:"All Types"}),t.jsx("option",{value:"Logistics",children:"Logistics"}),t.jsx("option",{value:"Passenger",children:"Passenger"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Min Seating"}),t.jsx("input",{type:"number",value:d.minSeatingCapacity,onChange:w=>C("minSeatingCapacity",w.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Min capacity"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Seating"}),t.jsx("input",{type:"number",value:d.maxSeatingCapacity,onChange:w=>C("maxSeatingCapacity",w.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Max capacity"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),t.jsx("input",{type:"date",value:d.startDate,onChange:w=>C("startDate",w.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500",min:new Date().toISOString().split("T")[0]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date"}),t.jsx("input",{type:"date",value:d.endDate,onChange:w=>C("endDate",w.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500",min:d.startDate||new Date().toISOString().split("T")[0]})]})]}),t.jsx("div",{className:"mt-4 text-sm text-gray-600",children:t.jsxs("p",{children:[" ",t.jsx("strong",{children:"Tip:"})," Select start and end dates to see only vehicles available for your trip dates."]})})]}),t.jsxs("div",{className:"bg-white shadow rounded-lg",children:[t.jsx("div",{className:"p-4 border-b",children:t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Available Vehicles (",n.length,")"]})}),o?t.jsx("div",{className:"p-6",children:"Loading vehicles..."}):n.length===0?t.jsx("div",{className:"p-6 text-gray-600",children:"No vehicles found matching your criteria."}):t.jsx("div",{className:"p-4 space-y-4",children:n.map(w=>{var P,M,W;return t.jsxs("div",{className:"border rounded-lg p-4 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[((P=w.vehicleImage)==null?void 0:P.url)&&t.jsx("img",{src:w.vehicleImage.url,alt:"Vehicle",className:"w-16 h-16 object-cover rounded-lg"}),t.jsxs("div",{children:[t.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[w.registeredNumber," - ",w.makersName]}),t.jsxs("div",{className:"text-xs text-gray-600",children:["Class: ",w.vehicleClass,"  Type: ",w.vehicleType||"N/A","  Seating: ",w.seatingCapacity||"N/A"]}),t.jsxs("div",{className:"text-xs text-gray-500",children:["Business: ",((M=w.businessId)==null?void 0:M.name)||((W=w.businessId)==null?void 0:W.email)||"N/A"]})]})]}),t.jsx("button",{onClick:()=>Z(w),className:"bg-primary-500 hover:bg-primary-600 text-white px-4 py-2 rounded-lg text-sm font-medium",children:"Send Enquiry"})]},w._id)})})]}),t.jsx(Hc,{isOpen:f,onClose:()=>{y(!1),p(null)},vehicle:u,onSubmit:N})]})},ia=({isOpen:n,onClose:a,trip:o,onSubmit:c})=>{var y,g,N,C;const[d,m]=v.useState(!1),[u,p]=v.useState(!1);v.useEffect(()=>{const Z=document.createElement("script");return Z.src="https://checkout.razorpay.com/v1/checkout.js",Z.onload=()=>p(!0),Z.onerror=()=>{D.error("Failed to load Razorpay"),p(!1)},document.body.appendChild(Z),()=>{document.body.removeChild(Z)}},[]);const f=async()=>{if(!u){D.error("Razorpay is still loading, please wait");return}if(!o){D.error("No trip selected");return}try{m(!0);const Z=localStorage.getItem("token");console.log("Creating payment order for trip:",o._id);const w=await fetch("/api/trips/create-payment-order",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Z}`},body:JSON.stringify({tripId:o._id})});if(console.log("Payment order response status:",w.status),!w.ok){let $="Failed to create payment order";try{$=(await w.json()).message||$}catch{const G=await w.text();console.error("Non-JSON response:",G),$=`Server error: ${w.status}`}throw new Error($)}const{order:P,amount:M}=await w.json(),W={key:"rzp_test_RVL3dTzHqSRYTV",amount:P.amount,currency:P.currency,name:"MobiTrak",description:"Full Payment for Trip",order_id:P.id,handler:async $=>{try{const z=await fetch("/api/trips/verify-payment",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Z}`},body:JSON.stringify({tripId:o._id,razorpay_order_id:$.razorpay_order_id,razorpay_payment_id:$.razorpay_payment_id,razorpay_signature:$.razorpay_signature})});if(!z.ok){const Q=await z.json();throw new Error(Q.message||"Payment verification failed")}const G=await z.json();D.success(G.message),c&&c(G),a()}catch(z){console.error("Payment verification error:",z),D.error("Payment verification failed: "+z.message)}},prefill:{name:o.customerName||"",email:o.customerEmail||""},theme:{color:"#3B82F6"},modal:{ondismiss:()=>{m(!1)}}};new window.Razorpay(W).open()}catch(Z){console.error("Payment error:",Z),D.error("Payment failed: "+Z.message)}finally{m(!1)}};return!n||!o?null:t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Pay Now"}),t.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Trip Details"}),t.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[t.jsxs("div",{children:["Route: ",o.startAddress,"  ",o.endAddress]}),t.jsxs("div",{children:["Dates: ",new Date(o.startDate).toLocaleDateString()," - ",new Date(o.endDate).toLocaleDateString()]}),t.jsxs("div",{children:["Vehicle: ",(y=o.vehicleId)==null?void 0:y.registeredNumber," - ",(g=o.vehicleId)==null?void 0:g.makersName]})]})]}),t.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Payment Summary"}),t.jsx("div",{className:"text-sm",children:t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Total Amount:"}),t.jsxs("span",{className:"font-medium text-lg",children:["",(N=o.totalAmount)==null?void 0:N.toLocaleString()]})]})})]}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("button",{onClick:a,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),t.jsx("button",{onClick:f,disabled:d||!u,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Processing...":u?`Pay ${(C=o.totalAmount)==null?void 0:C.toLocaleString()}`:"Loading..."})]})]})]})})},Uc=()=>{const[n,a]=v.useState([]),[o,c]=v.useState(!1),[d,m]=v.useState(!1),[u,p]=v.useState(null),f=lr(),y=async()=>{try{c(!0);const C=localStorage.getItem("token");if(console.log("fetchEnquiries - Starting fetch with token:",C?"Present":"Missing"),!C){console.log("fetchEnquiries - No token, redirecting to login"),D.error("Please log in to view your enquiries"),f("/login");return}console.log("fetchEnquiries - Making request to /api/enquiries/customer");const Z=await fetch("/api/enquiries/customer",{headers:{Authorization:`Bearer ${C}`,"Content-Type":"application/json"}});if(console.log("fetchEnquiries - Response status:",Z.status),!Z.ok){const P=await Z.json();if(console.log("fetchEnquiries - Error response:",P),Z.status===401){console.log("fetchEnquiries - 401 error, redirecting to login"),D.error("Session expired. Please log in again."),f("/login");return}throw new Error(P.message||"Failed to load enquiries")}const w=await Z.json();console.log("fetchEnquiries - Success response:",w),a(w.enquiries||[])}catch(C){console.error("fetchEnquiries - Error:",C),D.error(C.message||"Failed to load enquiries")}finally{c(!1)}},g=C=>{p(C),m(!0)},N=C=>{console.log("Payment completed:",C),y()};return v.useEffect(()=>{const C=localStorage.getItem("token"),Z=localStorage.getItem("user");if(console.log("EnquiriesPage - Token:",C?"Present":"Missing"),console.log("EnquiriesPage - User:",Z?JSON.parse(Z):"Missing"),!C||!Z){console.log("EnquiriesPage - No auth data, redirecting to login"),D.error("Please log in to view your enquiries"),f("/login");return}console.log("EnquiriesPage - Auth data present, fetching enquiries"),y()},[f]),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"My Enquiries"}),t.jsx("button",{onClick:y,className:"text-sm px-3 py-1.5 rounded-md bg-blue-600 text-white hover:bg-blue-700",children:"Refresh"})]}),t.jsxs("div",{className:"bg-white shadow rounded-lg",children:[t.jsx("div",{className:"p-4 border-b",children:t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Enquiry History"})}),o?t.jsx("div",{className:"p-6",children:"Loading enquiries..."}):n.length===0?t.jsx("div",{className:"p-6 text-gray-600",children:"No enquiries yet."}):t.jsx("div",{className:"p-4 space-y-4",children:n.map(C=>{var Z,w,P,M,W;return t.jsxs("div",{className:"border rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[(Z=C.vehicleId)==null?void 0:Z.registeredNumber," - ",(w=C.vehicleId)==null?void 0:w.makersName]}),t.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${C.status==="confirmed"?"bg-green-100 text-green-800":C.status==="trip_created"?"bg-blue-100 text-blue-800":C.status==="responded"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:C.status.replace("_"," ")})]}),t.jsxs("div",{className:"text-sm text-gray-600",children:["Route: ",C.startingPoint,"  ",C.destination]}),t.jsxs("div",{className:"text-sm text-gray-600",children:["Dates: ",new Date(C.startDate).toLocaleDateString()," - ",new Date(C.endDate).toLocaleDateString()]}),((P=C.businessResponse)==null?void 0:P.message)&&t.jsxs("div",{className:"mt-2 p-2 bg-gray-50 rounded text-sm",children:[t.jsx("strong",{children:"Business Response:"})," ",C.businessResponse.message]}),C.status==="trip_created"&&t.jsxs("div",{className:"mt-2 p-2 bg-blue-50 rounded text-sm",children:[t.jsx("strong",{children:"Trip Created!"})," Total: ",(M=C.totalAmount)==null?void 0:M.toLocaleString(),"  Advance Required: ",(W=C.advanceAmount)==null?void 0:W.toLocaleString(),t.jsxs("div",{className:"mt-2 space-x-2",children:[t.jsx("button",{onClick:()=>g(C),className:"bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm",children:"Pay Now"}),t.jsx("span",{className:"text-xs text-gray-600",children:"Choose to pay advance or full amount"})]})]})]},C._id)})})]}),t.jsx(ia,{isOpen:d,onClose:()=>{m(!1),p(null)},enquiry:u,onSubmit:N})]})},Wc=()=>{const[n,a]=v.useState([]),[o,c]=v.useState(!1),[d,m]=v.useState(!1),[u,p]=v.useState(null),f=lr(),y=async()=>{try{c(!0);const C=localStorage.getItem("token");if(console.log("fetchTrips - Starting fetch with token:",C?"Present":"Missing"),!C){console.log("fetchTrips - No token, redirecting to login"),D.error("Please log in to view your trips"),f("/login");return}console.log("fetchTrips - Making request to /api/trips/customer");const Z=await fetch("/api/trips/customer",{headers:{Authorization:`Bearer ${C}`,"Content-Type":"application/json"}});if(console.log("fetchTrips - Response status:",Z.status),!Z.ok){const P=await Z.json();if(console.log("fetchTrips - Error response:",P),Z.status===401){console.log("fetchTrips - 401 error, redirecting to login"),D.error("Session expired. Please log in again."),f("/login");return}throw new Error(P.message||"Failed to load trips")}const w=await Z.json();console.log("fetchTrips - Success response:",w),a(w.trips||[])}catch(C){console.error("fetchTrips - Error:",C),D.error(C.message||"Failed to load trips")}finally{c(!1)}};v.useEffect(()=>{const C=localStorage.getItem("token"),Z=localStorage.getItem("user");if(console.log("MyTripsPage - Token:",C?"Present":"Missing"),console.log("MyTripsPage - User:",Z?JSON.parse(Z):"Missing"),!C||!Z){console.log("MyTripsPage - No auth data, redirecting to login"),D.error("Please log in to view your trips"),f("/login");return}console.log("MyTripsPage - Auth data present, fetching trips"),y()},[f]);const g=C=>{p(C),m(!0)},N=C=>{D.success("Payment completed successfully!"),y(),m(!1),p(null)};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"My Trips"}),t.jsx("button",{onClick:y,className:"text-sm px-3 py-1.5 rounded-md bg-blue-600 text-white hover:bg-blue-700",children:"Refresh"})]}),t.jsxs("div",{className:"bg-white shadow rounded-lg",children:[t.jsx("div",{className:"p-4 border-b",children:t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Trip History"})}),o?t.jsx("div",{className:"p-6",children:"Loading trips..."}):n.length===0?t.jsx("div",{className:"p-6 text-gray-600",children:"No trips yet."}):t.jsx("div",{className:"p-4 space-y-4",children:n.map(C=>{var Z,w;return t.jsxs("div",{className:"border rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[C.startAddress,"  ",C.endAddress]}),t.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${C.status==="completed"?"bg-green-100 text-green-800":C.status==="in_progress"?"bg-blue-100 text-blue-800":C.status==="scheduled"?"bg-yellow-100 text-yellow-800":C.status==="pending_payment"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:C.status.replace("_"," ")})]}),t.jsxs("div",{className:"text-sm text-gray-600",children:["Dates: ",new Date(C.startDate).toLocaleDateString()," - ",new Date(C.endDate).toLocaleDateString(),"  ",C.numDays||1," day(s)"]}),t.jsxs("div",{className:"text-sm text-gray-600",children:["Distance: ",C.distanceKm," km  Total: ",Number(C.totalAmount||0).toLocaleString()]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["Vehicle: ",((Z=C.vehicleId)==null?void 0:Z.registeredNumber)||C.vehicleId,"  Driver: ",((w=C.driverId)==null?void 0:w.name)||C.driverId]}),C.paymentStatus&&t.jsxs("div",{className:"text-sm text-gray-500",children:["Payment Status: ",C.paymentStatus==="paid"?"Fully Paid":C.paymentStatus==="advance_paid"?"Advance Paid":"Pending Payment"]}),C.status==="pending_payment"&&t.jsxs("div",{className:"mt-2 p-2 bg-red-50 rounded text-sm",children:[t.jsx("strong",{children:"Payment Required:"})," Please complete payment to confirm your trip.",t.jsx("button",{onClick:()=>g(C),className:"ml-2 px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700",children:"Pay Now"})]})]},C._id)})})]}),t.jsx(ia,{isOpen:d,onClose:()=>{m(!1),p(null)},trip:u,onSubmit:N})]})},qc=()=>{const[n,a]=v.useState(null),[o,c]=v.useState(!1),[d,m]=v.useState(!1),[u,p]=v.useState(null),[f,y]=v.useState(null),g=lr(),[N,C]=v.useState({name:"",phone:"",address:""}),Z=async()=>{try{c(!0);const W=localStorage.getItem("token");if(!W){D.error("Please log in to view your profile"),g("/login");return}const K=await fetch("/api/auth/profile",{headers:{Authorization:`Bearer ${W}`,"Content-Type":"application/json"}});if(!K.ok){if(K.status===401){D.error("Session expired. Please log in again."),g("/login");return}throw new Error("Failed to load profile")}const $=await K.json();a($.profile),C({name:$.profile.name||"",phone:$.profile.phone||"",address:$.profile.address||""}),y($.profile.profilePicture)}catch(W){console.error("Fetch profile error:",W),D.error(W.message||"Failed to load profile")}finally{c(!1)}},w=W=>{const K=W.target.files[0];if(K){p(K);const $=new FileReader;$.onload=z=>{y(z.target.result)},$.readAsDataURL(K)}},P=async W=>{try{const K=localStorage.getItem("token"),$=await new Promise((Q,Y)=>{const X=new FileReader;X.onload=()=>Q(X.result),X.onerror=Y,X.readAsDataURL(W)}),z=await fetch("/api/auth/upload-profile-picture",{method:"POST",headers:{Authorization:`Bearer ${K}`,"Content-Type":"application/json"},body:JSON.stringify({imageData:$})});if(!z.ok)throw new Error("Failed to upload image");return(await z.json()).imageUrl}catch(K){throw console.error("Upload error:",K),K}},M=async()=>{try{m(!0);const W=localStorage.getItem("token");let K=n==null?void 0:n.profilePicture;u&&(K=await P(u));const $=await fetch("/api/auth/profile",{method:"PUT",headers:{Authorization:`Bearer ${W}`,"Content-Type":"application/json"},body:JSON.stringify({...N,profilePicture:K})});if(!$.ok){if($.status===401){D.error("Session expired. Please log in again."),g("/login");return}throw new Error("Failed to update profile")}const z=await $.json();a(z.profile),y(z.profile.profilePicture),p(null),D.success("Profile updated successfully!")}catch(W){console.error("Save profile error:",W),D.error(W.message||"Failed to update profile")}finally{m(!1)}};return v.useEffect(()=>{Z()},[]),o?t.jsxs("div",{className:"space-y-6",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Profile Settings"}),t.jsx("div",{className:"bg-white shadow rounded-lg p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-4"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Profile Settings"}),t.jsx("div",{className:"bg-white shadow rounded-lg p-6",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center space-x-6",children:[t.jsx("div",{className:"flex-shrink-0",children:f?t.jsx("img",{className:"h-24 w-24 rounded-full object-cover",src:f,alt:"Profile"}):t.jsx("div",{className:"h-24 w-24 rounded-full bg-gray-300 flex items-center justify-center",children:t.jsx("svg",{className:"h-12 w-12 text-gray-500",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})})})}),t.jsxs("div",{children:[t.jsxs("label",{className:"block",children:[t.jsx("span",{className:"sr-only",children:"Choose profile photo"}),t.jsx("input",{type:"file",accept:"image/*",onChange:w,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary-50 file:text-primary-700 hover:file:bg-primary-100"})]}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"JPG, PNG or GIF. Max size 5MB."})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),t.jsx("input",{type:"email",value:(n==null?void 0:n.email)||"",disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500 cursor-not-allowed"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Email cannot be changed"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),t.jsx("input",{type:"text",value:N.name,onChange:W=>C({...N,name:W.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Enter your full name"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Number"}),t.jsx("input",{type:"tel",value:N.phone,onChange:W=>C({...N,phone:W.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Enter your contact number"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address"}),t.jsx("textarea",{value:N.address,onChange:W=>C({...N,address:W.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Enter your address"})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{onClick:M,disabled:d,className:"bg-primary-500 hover:bg-primary-600 disabled:bg-gray-400 text-white px-6 py-2 rounded-lg font-medium transition-colors",children:d?"Saving...":"Save Changes"})})]})})]})},Gc=({onLogout:n})=>{const[a,o]=v.useState("vehicles"),c=()=>{n()};return t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsx("header",{className:"bg-white shadow-sm border-b",children:t.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:t.jsxs("div",{className:"flex justify-between items-center h-16",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"h-8 w-8 bg-primary-400 rounded-lg flex items-center justify-center mr-3",children:t.jsxs("svg",{className:"h-5 w-5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:[t.jsx("path",{d:"M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"}),t.jsx("path",{d:"M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1V5a1 1 0 00-1-1H3zM14 7a1 1 0 00-1 1v6.05A2.5 2.5 0 0115.95 14H17a1 1 0 001-1V8a1 1 0 00-1-1h-3z"})]})}),t.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"MobiTrak Customer"})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("span",{className:"text-sm text-gray-600",children:"Customer"}),t.jsx("button",{onClick:c,className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-medium",children:"Logout"})]})]})})}),t.jsx("nav",{className:"bg-white shadow-sm",children:t.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:t.jsx("div",{className:"flex space-x-8",children:[{id:"vehicles",name:"Find Vehicles"},{id:"enquiries",name:"My Enquiries"},{id:"trips",name:"My Trips"},{id:"profile",name:"Profile"}].map(d=>t.jsx("button",{onClick:()=>o(d.id),className:`py-4 px-1 border-b-2 font-medium text-sm ${a===d.id?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:d.name},d.id))})})}),t.jsx("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:t.jsxs("div",{className:"px-4 py-6 sm:px-0",children:[a==="vehicles"&&t.jsx($c,{}),a==="enquiries"&&t.jsx(Uc,{}),a==="trips"&&t.jsx(Wc,{}),a==="profile"&&t.jsx(qc,{})]})})]})},Kc=({driverProfile:n,setDriverProfile:a,profileForm:o,setProfileForm:c,licenseImages:d,setLicenseImages:m,handleImageUpload:u,extractLicenseInfo:p,handleSubmitProfile:f,loading:y})=>{const[g,N]=v.useState(!1),[C,Z]=v.useState(!1),[w,P]=v.useState(null),[M,W]=v.useState({line1:"",line2:"",city:"",state:"",pincode:"",country:"India"}),[K,$]=v.useState({front:!1,back:!1}),[z,G]=v.useState(null),Q=v.useRef(null);v.useEffect(()=>{n&&(P(n.profileIcon||null),W(n.address||{line1:"",line2:"",city:"",state:"",pincode:"",country:"India"}))},[n]);const Y=S=>{const j=S.target.files[0];if(j){const A=new FileReader;A.onload=x=>{P(x.target.result)},A.readAsDataURL(j)}},X=S=>{const{name:j,value:A}=S.target;W(x=>({...x,[j]:A}))},ce=async S=>{S.preventDefault();try{Z(!0);const j=localStorage.getItem("token");if(!d.front||!d.back){D.error("Please upload both front and back images of your driving license first");return}const A=d.front.split(",")[1],x=d.back.split(",")[1],b={...o,frontImageBase64:A,backImageBase64:x};console.log("Sending profile data with license images:",b);const F=await fetch("/api/drivers/upload-license",{method:"POST",headers:{Authorization:`Bearer ${j}`,"Content-Type":"application/json"},body:JSON.stringify(b)});if(console.log("Response status:",F.status),F.ok){const ee=await F.json();console.log("Profile saved successfully:",ee),a(ee.driver),N(!1),D.success("Driver profile saved successfully!")}else{const ee=await F.json();console.error("Error response:",ee),D.error("Error saving profile: "+(ee.message||"Server error"))}}catch(j){console.error("Error saving driver profile:",j),D.error("Error saving driver profile: "+j.message)}finally{Z(!1)}},ye=async()=>{try{Z(!0);const S=localStorage.getItem("token"),j={...o,profileIcon:w,address:M,frontImageBase64:d.front?d.front.split(",")[1]:null,backImageBase64:d.back?d.back.split(",")[1]:null};console.log("Sending profile update data:",j),console.log("Profile Icon data:",w),console.log("Address data:",M);const A=await fetch("/api/drivers/upload-license",{method:"POST",headers:{Authorization:`Bearer ${S}`,"Content-Type":"application/json"},body:JSON.stringify(j)});if(console.log("Response status:",A.status),A.ok){const x=await A.json();console.log("Profile updated successfully:",x),a(x.driver),N(!1),D.success("Driver profile updated successfully!")}else{const x=await A.json();console.error("Error response:",x),D.error("Error updating profile: "+(x.message||"Server error"))}}catch(S){console.error("Error updating driver profile:",S),D.error("Error updating driver profile: "+S.message)}finally{Z(!1)}},V=async S=>{S.preventDefault(),n&&n.profileCompleted?await ye():await ce(S)},J=(S,j)=>{G(j),$(A=>({...A,[S]:!0}))},k=()=>{$({front:!1,back:!1}),G(null)},E=S=>{m(j=>({...j,[S]:null})),D.success(`${S==="front"?"Front":"Back"} license image removed`)};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Driver Profile"}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your personal information and address"})]}),n&&t.jsx("div",{className:"bg-white shadow rounded-lg p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Profile Status"}),t.jsx("p",{className:"text-sm text-gray-500",children:n.profileCompleted?"Profile Completed":"Profile Incomplete"})]}),t.jsx("div",{className:"flex items-center space-x-2",children:t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${n.status==="Hired"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:n.status})})]})}),n&&!n.profileCompleted&&t.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:t.jsxs("div",{className:"flex items-start",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("svg",{className:"h-6 w-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),t.jsxs("div",{className:"ml-3",children:[t.jsx("h3",{className:"text-lg font-medium text-yellow-800",children:"Complete Your Profile"}),t.jsxs("div",{className:"mt-2 text-sm text-yellow-700",children:[t.jsx("p",{children:"Your profile is incomplete. Please fill out all the required information below to:"}),t.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[t.jsx("li",{children:"Make yourself visible to businesses"}),t.jsx("li",{children:"Receive job offers"}),t.jsx("li",{children:"Complete your driver verification"})]})]})]})]})}),t.jsx("form",{onSubmit:V,className:"space-y-6",noValidate:!0,children:t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-primary-200 overflow-hidden",children:[t.jsx("div",{className:"bg-gradient-to-r from-primary-500 to-primary-600 px-6 py-8",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"h-20 w-20 bg-white rounded-full flex items-center justify-center overflow-hidden shadow-lg",children:w?t.jsx("img",{src:w,alt:"Profile",className:"h-full w-full object-cover"}):t.jsx("svg",{className:"h-10 w-10 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})})}),t.jsxs("div",{className:"ml-6 text-white",children:[t.jsx("h2",{className:"text-2xl font-bold",children:o.name||"Driver Name"}),t.jsx("p",{className:"text-primary-100 text-lg",children:o.dlNumber||"License Number"}),M.city&&t.jsxs("p",{className:"text-primary-200 text-sm mt-1",children:[M.city,", ",M.state]})]})]})}),t.jsxs("div",{className:"p-6 space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Profile Icon"}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("div",{className:"h-16 w-16 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden",children:w?t.jsx("img",{src:w,alt:"Profile",className:"h-full w-full object-cover"}):t.jsx("svg",{className:"h-8 w-8 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})})}),t.jsx("input",{ref:Q,type:"file",accept:"image/*",onChange:Y,className:"block text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary-50 file:text-primary-700 hover:file:bg-primary-100"})]})]}),t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[t.jsx("svg",{className:"h-5 w-5 mr-2 text-primary-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Personal Information"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name"}),t.jsx("input",{type:"text",value:o.name,onChange:S=>c(j=>({...j,name:S.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date of Birth"}),t.jsx("input",{type:"date",value:o.dateOfBirth,onChange:S=>c(j=>({...j,dateOfBirth:S.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Blood Group"}),t.jsx("input",{type:"text",value:o.bloodGroup,onChange:S=>c(j=>({...j,bloodGroup:S.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Blood Group (e.g., A+, B-, O+)",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vehicle Classes"}),t.jsx("div",{className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50",children:o.vehicleClass.length>0?t.jsx("div",{className:"flex flex-wrap gap-2",children:o.vehicleClass.map((S,j)=>t.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:S},j))}):t.jsx("span",{className:"text-gray-500",children:"Vehicle classes will be extracted from license back"})})]})]})]}),t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[t.jsx("svg",{className:"h-5 w-5 mr-2 text-primary-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Driving License Information"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Driving License Front"}),t.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4",children:d.front?t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"relative",children:[t.jsx("img",{src:d.front,alt:"License Front",className:"w-full h-32 object-cover rounded cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>J("front",d.front)}),t.jsx("button",{onClick:()=>E("front"),className:"absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white rounded-full p-1 transition-colors",title:"Remove image",children:t.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),y&&t.jsx("div",{className:"text-center text-sm text-blue-600",children:"Extracting data automatically..."}),t.jsxs("div",{className:"text-center",children:[t.jsx("input",{type:"file",accept:"image/*",onChange:S=>u("front",S.target.files[0]),className:"hidden",id:"front-upload-new"}),t.jsx("label",{htmlFor:"front-upload-new",className:"cursor-pointer text-sm text-blue-600 hover:text-blue-800 underline",children:"Upload different image"})]})]}):t.jsxs("div",{className:"text-center",children:[t.jsx("input",{type:"file",accept:"image/*",onChange:S=>u("front",S.target.files[0]),className:"hidden",id:"front-upload"}),t.jsxs("label",{htmlFor:"front-upload",className:"cursor-pointer text-gray-500 hover:text-gray-700",children:[t.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:t.jsx("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})}),t.jsx("p",{className:"mt-2 text-sm",children:"Click to upload front image"})]})]})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Driving License Back"}),t.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4",children:d.back?t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"relative",children:[t.jsx("img",{src:d.back,alt:"License Back",className:"w-full h-32 object-cover rounded cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>J("back",d.back)}),t.jsx("button",{onClick:()=>E("back"),className:"absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white rounded-full p-1 transition-colors",title:"Remove image",children:t.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),y&&t.jsx("div",{className:"text-center text-sm text-blue-600",children:"Extracting vehicle class..."}),t.jsxs("div",{className:"text-center",children:[t.jsx("input",{type:"file",accept:"image/*",onChange:S=>u("back",S.target.files[0]),className:"hidden",id:"back-upload-new"}),t.jsx("label",{htmlFor:"back-upload-new",className:"cursor-pointer text-sm text-blue-600 hover:text-blue-800 underline",children:"Upload different image"})]})]}):t.jsxs("div",{className:"text-center",children:[t.jsx("input",{type:"file",accept:"image/*",onChange:S=>u("back",S.target.files[0]),className:"hidden",id:"back-upload"}),t.jsxs("label",{htmlFor:"back-upload",className:"cursor-pointer text-gray-500 hover:text-gray-700",children:[t.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:t.jsx("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})}),t.jsx("p",{className:"mt-2 text-sm",children:"Click to upload back image"})]})]})})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Driving License Number"}),t.jsx("input",{type:"text",value:o.dlNumber,onChange:S=>c(j=>({...j,dlNumber:S.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Issue Date"}),t.jsx("input",{type:"date",value:o.dlIssueDate,onChange:S=>c(j=>({...j,dlIssueDate:S.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Validity Date"}),t.jsx("input",{type:"date",value:o.dlValidity,onChange:S=>c(j=>({...j,dlValidity:S.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Permanent Address"}),t.jsx("textarea",{value:o.permanentAddress,onChange:S=>c(j=>({...j,permanentAddress:S.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",required:!0})]})]})]}),t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[t.jsxs("svg",{className:"h-5 w-5 mr-2 text-primary-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Current Address"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City"}),t.jsx("input",{type:"text",name:"city",value:M.city,onChange:X,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"City"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"State"}),t.jsx("input",{type:"text",name:"state",value:M.state,onChange:X,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"State"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pincode"}),t.jsx("input",{type:"text",name:"pincode",value:M.pincode,onChange:X,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"123456"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Country"}),t.jsx("input",{type:"text",name:"country",value:M.country,onChange:X,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Country"})]})]})]}),t.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t",children:[t.jsx("button",{type:"button",onClick:()=>N(!1),className:"px-6 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:C,className:"px-6 py-2 text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 disabled:bg-gray-400 rounded-md flex items-center",children:C?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):"Save Profile"})]})]})]})}),(K.front||K.back)&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",onClick:k,children:t.jsxs("div",{className:"relative max-w-4xl max-h-full p-4",children:[t.jsx("button",{onClick:k,className:"absolute top-4 right-4 bg-white hover:bg-gray-100 text-gray-800 rounded-full p-2 z-10 transition-colors",children:t.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),t.jsx("img",{src:z,alt:"License Image",className:"max-w-full max-h-full object-contain rounded-lg",onClick:S=>S.stopPropagation()})]})})]})},Jc=({jobOffers:n,offersLoading:a,respondToOffer:o})=>t.jsxs("div",{className:"space-y-6",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Job Offers"}),t.jsx("div",{className:"bg-white shadow rounded-lg p-6",children:a?t.jsxs("div",{className:"text-center py-6",children:[t.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),t.jsx("p",{className:"mt-2 text-gray-600",children:"Loading job offers..."})]}):n.length===0?t.jsxs("div",{className:"text-center py-6",children:[t.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),t.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No job offers"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"You haven't received any job offers yet."})]}):t.jsx("div",{className:"space-y-4",children:n.map(c=>{var d,m;return t.jsxs("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:[t.jsx("div",{className:"flex justify-between items-start",children:t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:((d=c.business)==null?void 0:d.companyName)||((m=c.business)==null?void 0:m.email)||"Unknown Business"}),t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${c.status==="pending"?"bg-yellow-100 text-yellow-800":c.status==="accepted"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:c.status})]}),t.jsx("p",{className:"text-sm text-gray-600 mb-2",children:c.message}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-sm text-gray-500",children:[t.jsx("span",{className:"font-medium",children:"Salary:"})," ",c.salaryPerDay,"/day"]}),t.jsxs("div",{className:"text-sm text-gray-500",children:[t.jsx("span",{className:"font-medium",children:"Sent:"})," ",new Date(c.sentAt).toLocaleDateString()]})]})]})}),c.status==="pending"&&t.jsxs("div",{className:"mt-4 flex justify-end space-x-3",children:[t.jsx("button",{onClick:()=>o(c.id,"rejected"),className:"px-4 py-2 text-sm font-medium text-red-700 bg-red-100 hover:bg-red-200 rounded-md",children:"Reject"}),t.jsx("button",{onClick:()=>o(c.id,"accepted"),className:"px-4 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700 rounded-md",children:"Accept"})]})]},c.id)})})})]}),Yc=({onLogout:n})=>{const[a,o]=v.useState("overview"),[c,d]=v.useState(null),[m,u]=v.useState(!1),[p,f]=v.useState({dlNumber:"",dlIssueDate:"",dlValidity:"",name:"",dateOfBirth:"",bloodGroup:"",permanentAddress:"",vehicleClass:[]}),[y,g]=v.useState({front:null,back:null}),[N,C]=v.useState([]),[Z,w]=v.useState(!1),P=()=>{n()};v.useEffect(()=>{M()},[]),v.useEffect(()=>{a==="offers"&&W()},[a]);const M=async()=>{try{const Q=localStorage.getItem("token"),Y=await fetch("/api/drivers/profile",{headers:{Authorization:`Bearer ${Q}`,"Content-Type":"application/json"}});if(Y.ok){const X=await Y.json();d(X.driver),X.driver&&f({dlNumber:X.driver.dlNumber||"",dlIssueDate:X.driver.dlIssueDate?new Date(X.driver.dlIssueDate).toISOString().split("T")[0]:"",dlValidity:X.driver.dlValidity?new Date(X.driver.dlValidity).toISOString().split("T")[0]:"",name:X.driver.name||"",dateOfBirth:X.driver.dateOfBirth?new Date(X.driver.dateOfBirth).toISOString().split("T")[0]:"",bloodGroup:X.driver.bloodGroup||"",permanentAddress:X.driver.permanentAddress||"",vehicleClass:X.driver.vehicleClass||[]})}}catch(Q){console.error("Error loading driver profile:",Q)}},W=async()=>{try{w(!0);const Q=localStorage.getItem("token"),Y=await fetch("/api/job-offers/driver",{headers:{Authorization:`Bearer ${Q}`,"Content-Type":"application/json"}});if(Y.ok){const X=await Y.json();console.log("Job offers response:",X),console.log("Job offers data:",X.jobOffers),C(X.jobOffers||[])}else console.error("Failed to load job offers:",Y.status),D.error("Failed to load job offers")}catch(Q){console.error("Error loading job offers:",Q),D.error("Error loading job offers")}finally{w(!1)}},K=async(Q,Y)=>{try{const X=localStorage.getItem("token"),ce=await fetch(`/api/job-offers/${Q}/status`,{method:"PUT",headers:{Authorization:`Bearer ${X}`,"Content-Type":"application/json"},body:JSON.stringify({status:Y})});if(ce.ok)D.success(`Job offer ${Y} successfully!`),W();else{const ye=await ce.json();D.error(ye.message||`Failed to ${Y} offer`)}}catch(X){console.error(`Error ${Y}ing offer:`,X),D.error(`Error ${Y}ing offer`)}},$=(Q,Y)=>{const X=new FileReader;X.onload=async ce=>{const ye=ce.target.result;g(V=>({...V,[Q]:ye})),await z(Q,ye)},X.readAsDataURL(Y)},z=async(Q,Y=null)=>{const X=Y||y[Q];if(!X){alert("Please upload an image first");return}u(!0);try{const ce=localStorage.getItem("token"),ye=X.split(",")[1],V=await fetch("/api/drivers/extract-license-info",{method:"POST",headers:{Authorization:`Bearer ${ce}`,"Content-Type":"application/json"},body:JSON.stringify({imageBase64:ye,mimeType:"image/jpeg",side:Q})});if(V.ok){const J=await V.json();if(J.success){const k=J.data;if(Q==="front"){f(S=>({...S,dlNumber:k.dlNumber!=="Not Available"?k.dlNumber:S.dlNumber,dlIssueDate:k.dlIssueDate?k.dlIssueDate:S.dlIssueDate,dlValidity:k.dlValidity?k.dlValidity:S.dlValidity,name:k.name!=="Not Available"?k.name:S.name,dateOfBirth:k.dateOfBirth?k.dateOfBirth:S.dateOfBirth,bloodGroup:k.bloodGroup!=="Not Available"?k.bloodGroup:S.bloodGroup,permanentAddress:k.permanentAddress!=="Not Available"?k.permanentAddress:S.permanentAddress}));const E=[];k.dlNumber!=="Not Available"&&E.push("DL Number"),k.name!=="Not Available"&&E.push("Name"),k.dlIssueDate&&E.push("Issue Date"),k.dlValidity&&E.push("Validity"),k.dateOfBirth&&E.push("Date of Birth"),k.bloodGroup!=="Not Available"&&E.push("Blood Group"),k.permanentAddress!=="Not Available"&&E.push("Address"),console.log(`Front side extracted: ${E.join(", ")}`)}else{const S=(Array.isArray(k.vehicleClass)?k.vehicleClass:[k.vehicleClass]).filter(j=>j!=="Not Available");S.length>0&&(f(j=>({...j,vehicleClass:S})),console.log(`Back side extracted: Vehicle Classes - ${S.join(", ")}`))}}}else{const J=await V.json();console.error(`Failed to extract information: ${J.message||"Unknown error"}`)}}catch(ce){console.error("Error extracting license info:",ce),alert("Error extracting information from image")}finally{u(!1)}},G=async Q=>{if(Q.preventDefault(),!y.front||!y.back){alert("Please upload both front and back images of your driving license");return}u(!0);try{const Y=localStorage.getItem("token"),X=y.front.split(",")[1],ce=y.back.split(",")[1],ye=await fetch("/api/drivers/upload-license",{method:"POST",headers:{Authorization:`Bearer ${Y}`,"Content-Type":"application/json"},body:JSON.stringify({...p,frontImageBase64:X,backImageBase64:ce})});if(ye.ok){const V=await ye.json();alert("Profile updated successfully!"),M()}else{const V=await ye.json();alert(V.message||"Failed to update profile")}}catch(Y){console.error("Error updating profile:",Y),alert("Error updating profile")}finally{u(!1)}};return t.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[t.jsxs("div",{className:"w-64 bg-white shadow-lg flex flex-col sticky top-0 h-screen",children:[t.jsx("div",{className:"p-6 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"h-8 w-8 bg-primary-400 rounded-lg flex items-center justify-center mr-3",children:t.jsxs("svg",{className:"h-5 w-5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:[t.jsx("path",{d:"M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"}),t.jsx("path",{d:"M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1V5a1 1 0 00-1-1H3zM14 7a1 1 0 00-1 1v6.05A2.5 2.5 0 0115.95 14H17a1 1 0 001-1V8a1 1 0 00-1-1h-3z"})]})}),t.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"MobiTrak Driver"})]})}),t.jsx("nav",{className:"flex-1 px-4 py-6 space-y-2",children:[{id:"overview",name:"Overview",icon:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"},{id:"profile",name:"Profile",icon:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"},{id:"offers",name:"Job Offers",icon:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"}].map(Q=>t.jsxs("button",{onClick:()=>o(Q.id),className:`w-full flex items-center px-4 py-3 text-sm font-medium rounded-lg transition-colors ${a===Q.id?"bg-primary-100 text-primary-700 border-r-2 border-primary-500":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"}`,children:[t.jsx("svg",{className:"h-5 w-5 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:Q.icon})}),t.jsx("span",{className:"flex-1 text-left",children:Q.name}),Q.id==="profile"&&c&&!c.profileCompleted&&t.jsx("div",{className:"flex items-center",children:t.jsxs("div",{className:"relative",children:[t.jsx("svg",{className:"h-4 w-4 text-yellow-500",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),t.jsx("div",{className:"absolute -top-1 -right-1 h-2 w-2 bg-red-500 rounded-full animate-pulse"})]})})]},Q.id))}),t.jsxs("div",{className:"p-4 border-t border-gray-200",children:[t.jsxs("div",{className:"flex items-center mb-4",children:[t.jsx("div",{className:"h-12 w-12 bg-gray-300 rounded-full flex items-center justify-center mr-3 overflow-hidden",children:c!=null&&c.profileIcon?t.jsx("img",{src:c.profileIcon,alt:"Profile",className:"h-full w-full object-cover"}):t.jsx("svg",{className:"h-6 w-6 text-gray-600",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:(c==null?void 0:c.name)||"Driver Name"}),t.jsx("p",{className:"text-xs text-gray-500 truncate",children:(c==null?void 0:c.dlNumber)||"License Number"}),(c==null?void 0:c.status)&&t.jsx("span",{className:`inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium ${c.status==="Hired"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:c.status})]})]}),c&&!c.profileCompleted&&t.jsx("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("svg",{className:"h-4 w-4 text-yellow-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),t.jsx("p",{className:"text-xs text-yellow-800",children:"Complete your profile to receive job offers"})]})}),t.jsx("button",{onClick:P,className:"w-full bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors",children:"Logout"})]})]}),t.jsx("div",{className:"flex-1 flex flex-col min-h-screen",children:t.jsx("main",{className:"flex-1 py-8 px-6",children:t.jsxs("div",{className:"max-w-7xl mx-auto",children:[a==="overview"&&t.jsx("div",{className:"space-y-6",children:t.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Driver Overview"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-blue-900",children:"Profile Status"}),t.jsx("p",{className:"text-blue-700",children:c!=null&&c.profileCompleted?"Complete":"Incomplete"})]}),t.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-green-900",children:"Job Offers"}),t.jsxs("p",{className:"text-green-700",children:[N.length," available"]})]}),t.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-purple-900",children:"Driver Status"}),t.jsx("p",{className:"text-purple-700",children:(c==null?void 0:c.status)||"Pending"})]})]})]})}),a==="profile"&&t.jsx(Kc,{driverProfile:c,setDriverProfile:d,profileForm:p,setProfileForm:f,licenseImages:y,setLicenseImages:g,handleImageUpload:$,extractLicenseInfo:z,handleSubmitProfile:G,loading:m}),a==="offers"&&t.jsx(Jc,{jobOffers:N,offersLoading:Z,respondToOffer:K})]})})}),t.jsx(dr,{position:"top-right"})]})};function Xc(){const[n,a]=v.useState(null),[o,c]=v.useState(!0);v.useEffect(()=>{const u=localStorage.getItem("token"),p=localStorage.getItem("user");u&&p&&a(JSON.parse(p)),c(!1)},[]);const d=(u,p)=>{a(u),localStorage.setItem("user",JSON.stringify(u)),localStorage.setItem("token",p)},m=()=>{a(null),localStorage.removeItem("user"),localStorage.removeItem("token")};return o?t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-500"})}):t.jsx(lo,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsxs(co,{children:[t.jsx(Xt,{path:"/login",element:n?t.jsx(Qt,{to:`/${n.role}/dashboard`}):t.jsx(Pc,{onLogin:d})}),t.jsx(Xt,{path:"/register",element:n?t.jsx(Qt,{to:`/${n.role}/dashboard`}):t.jsx(Sc,{onLogin:d})}),t.jsx(Xt,{path:"/business/dashboard",element:(n==null?void 0:n.role)==="business"?t.jsx(Zc,{onLogout:m}):t.jsx(Qt,{to:"/login"})}),t.jsx(Xt,{path:"/customer/dashboard",element:(n==null?void 0:n.role)==="customer"?t.jsx(Gc,{onLogout:m}):t.jsx(Qt,{to:"/login"})}),t.jsx(Xt,{path:"/driver/dashboard",element:(n==null?void 0:n.role)==="driver"?t.jsx(Yc,{onLogout:m}):t.jsx(Qt,{to:"/login"})}),t.jsx(Xt,{path:"/",element:t.jsx(Qt,{to:"/login"})})]}),t.jsx(dr,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#363636",color:"#fff"},success:{duration:3e3,iconTheme:{primary:"#10B981",secondary:"#fff"}},error:{duration:4e3,iconTheme:{primary:"#EF4444",secondary:"#fff"}}}})]})})}Yi.createRoot(document.getElementById("root")).render(t.jsx(oo.StrictMode,{children:t.jsx(Xc,{})}));
